<!DOCTYPE HTMP PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Spline clamps and k-weight in background removal</title>
    <link rel="stylesheet" href=../ab.css />
    <link rel="stylesheet" href=../ppi.css />
    <meta http-equiv="Content-Type" content="text/html"; charset=iso-8859-15 />
    <meta name="robots" contents="all" />
  </head>

  <body>
    <div class=topbar>
  <div class=navbar>
  <a class=navhead href="../index.html">The Athena Users' Guide</a>
  <table class=navtable>
    <tr>
      <td align=left>
        &laquo;<a class=navtable href="http://bruceravel.github.io/demeter/"><span class=programlink>DEMETER</span></a>&raquo; &nbsp;
        &laquo;<a class=navtable href="http://cars9.uchicago.edu/iffwiki/Ifeffit"><span class=programlink>IFEFFIT</span></a>&raquo; &nbsp;
        <!-- [&nbsp;<a class=navtable href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"></a>&nbsp;] &nbsp; -->
        &laquo;<a class=navtable href="http://xafs.org">xafs.org</a>&raquo; &nbsp;
	<!-- [&nbsp;<a class=navtable href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;] -->
      </td>
      <td align=right>
        Back: <a class=navtable href="../bkg/rbkg.html" class="menu">The Rbkg parameter</a> &nbsp;&nbsp;
        &nbsp;&nbsp;
        Up: <a class=navtable href="../bkg/index.html" class="menu">Background Removal</a> &nbsp;&nbsp;
        Next: <a class=navtable href="../bkg/range.html" class="menu">Spline range</a>      </td>
    </tr>
  </table>
  </div>
</div>

<div class=sidebar>
  <a href="../pallas.html"><img src=../../images/pallas_athene_thumb.jpg
    width=90% border=0 alt='[Athena logo]'></a>
  <br />
  <a href="../index.html"  class="menu">Home</a><br />
<a href="../forward.html"  class="menu">Forward</a><br />
<a href="../intro.html"  class="menu">Introduction</a><br />
<a href="../import/index.html"  class="menu">Importing Data</a><br />
<a href="../bkg/index.html"  class="menuselect">Background Removal</a><br />
&nbsp;&#8618;&nbsp;<a href="../bkg/norm.html"  class="menu">Normalization</a><br />
&nbsp;&#8618;&nbsp;<a href="../bkg/rbkg.html"  class="menu">The Rbkg parameter</a><br />
&nbsp;&#8618;&nbsp;<span style="font-style: italic;">Spline clamps and k-weight</span><br />
&nbsp;&#8618;&nbsp;<a href="../bkg/range.html"  class="menu">Spline range</a><br /><a href="../plot/index.html"  class="menu">Plotting</a><br />
<a href="../ui/index.html"  class="menu">User Interface</a><br />
<a href="../params/index.html"  class="menu">Setting parameter values</a><br />
<a href="../output/index.html"  class="menu">Output files</a><br />
<a href="../process/index.html"  class="menu">Data processing</a><br />
<a href="../analysis/index.html"  class="menu">Data analysis</a><br />
<a href="../other/index.html"  class="menu">Other main window chores</a><br />
<a href="../examples/index.html"  class="menu">Worked examples</a><br />
</div>

<div class=contentarea>


<h1>
  Spline clamps and k-weight in background removal
</h1>

<hr class=hide />
<a name="splineclamps">

<h2>  Spline clamps</h2>
</a>

<p>

One of the shortcomings of the use of piece-wise splines to
approximate the background function is that the ends of spline are
somewhat ill-defined by virtue of not having more data preceding or
following.  At times, this can result in the end of the spline
splaying up or down, away from the &mu;(E) data.  This results in
significant distortion to &chi;(k) data.
</p>

<p>
<span class=program>IFEFFIT</span> provides a tool called
<em>spline clamps</em>.  These work by adding an
additional term to the &chi;&sup2; metric used to fit the spline to
the &mu;(E) data.  The difference between the spline and the data is
computed for the first and last five data points.  This sum of
differences computed in energy is multiplied by a user-chosen scaling
factor and added to the &chi;&sup2; computed from the R-range below
<span class=param>&laquo;rbkg&raquo;</span>.  This has the effect of
&ldquo;clamping&rdquo; the spline to the ends of the
data range.  In other words, we use the prior knowledge that &mu;&#8320;(E)
is a smooth function through the oscillatory structure of &mu;(E) to
put a restraint on the fit used to determine &mu;&#8320;(E).
</p>

<p>
The user-selected multiplicative coefficient takes one of six
predefined values: 
&ldquo;none&rdquo;,
&ldquo;slight&rdquo;,
&ldquo;weak&rdquo;,
&ldquo;medium&rdquo;,
&ldquo;strong&rdquo;, or
&ldquo;rigid&rdquo;.  These
have values of 0, 3, 6, 12, 24, and 96, respectively and serve to set
the strength of the clamp in the evaluation of &chi;&sup2;.
</p>


<div class=figure style="max-width: 100%; min-width: 7em;">
<a name=clamp_mu>&nbsp;</a><br><a href=../../images/clamp_mu.png><img src="../../images/clamp_mu.png" width=49%></a>
&nbsp;&nbsp;<a href=../../images/clamp_chi.png><img src="../../images/clamp_chi.png" alt="foo" width=49%></a>
<br></a>
<p>
(Left)
EuTiO<sub>3</sub> Ti K-edge data with the background subtracted using a
<span class=param>&laquo;k-weight&raquo;</span> of 1 and a
high-end spline clamp of &ldquo;none&rdquo;.  Note that
the end of the spline deviates significantly from the end of the data.
(Right)
Comparing the effects of different values of the high-end spline clamp
on the EuTiO<sub>3</sub> data with all other parameters equal.  The data using the
&ldquo;rigid&rdquo; clamp show the most physically
reasonable behavior at the end of the data range.
</p>
</div>

<p>

The default value of the clamp is &ldquo;none&rdquo; at
the low end of the energy range and &ldquo;strong&rdquo;
at the high end.  Clamps tend not to help at the low energy end of the
data.  Since the &mu;(E) data is changing so quickly near the edge,
biasing the spline to follow the data closely rarely helps improve the
quality of the &chi;(k) data.  A strong clamp at the high energy
frequently improves the behavior of the spline near the end of the data.
</p>

<p>
The behavior of the clamping mechanism can be configured using the
<a href="../other/prefs.html">preference tool</a>.
The <span class=pref>&diams;Bkg&nbsp;&rarr;&nbsp;nclamp</span> preference
changes the number of points at the end of the data range included in
the calculation of the effect of the clamp.  The
<span class=pref>&diams;Bkg&nbsp;&rarr;&nbsp;clamp1</span> and
<span class=pref>&diams;Bkg&nbsp;&rarr;&nbsp;clamp2</span> parameters set
the strengths of the two clamps.  The strengths of the clamps can be
fine tuned by changing the numeric values.  The parameter
<span class=pref>&diams;Clamp&nbsp;&rarr;&nbsp;weak</span> sets the the weak
clamp value, and so on.</p>


<hr class=hide />
<a name="theeffectofk-weightonbackgroundremoval">

<h2>  The effect of k-weight on background removal</h2>
</a>

<p>

The background removal section has its own <span class=param>&laquo;k-weight&raquo;</span>
parameter which is distinct from the k-weight used for
<a href="../ui/kweight.html">plotting and Fourier transforms</a>.  The background removal
<span class=param>&laquo;k-weight&raquo;</span> is the value used to evaluate the
Fourier transform performed to determine the background spline.  By
varying the value of this <span class=param>&laquo;k-weight&raquo;</span>, you
can emphasize the lower or upper end of the data in the determination
of the background.
</p>

<p>
For clean data with oscillatory structure at high energy that is small
but observable, you may find that a larger value of the background
removal <span class=param>&laquo;k-weight&raquo;</span> produces a better
&chi;(k) spectrum.  In fact, setting this parameter to 2 or 3 can
have a similar impact on the data as the highest value of the spline
clamp shown in the image above.
</p>

<p>
However, in data which are quite noisy, amplifying the noise by a
large value of <span class=param>&laquo;k-weight&raquo;</span> can have a
dramatic effect leading to a very poor evaluation of &mu;&#8320;(E).
Indeed, the &mu;&#8320;(E) evaluated from noisy data with a large value of
<span class=param>&laquo;k-weight&raquo;</span> will sometimes oscillate
wildly, as shown in
the example below.</p>



<div class=figure style="max-width: 644px; min-width: 7em;">
<a name=bkg_badkw>
<img src=../../images/bkg_badkw.png width=100%>
</a>
<p align=center>
Noisy data with &mu;&#8320;(E) computed using the default
<span class=param>&laquo;k-weight&raquo;</span> of 2.  With a
<span class=param>&laquo;k-weight&raquo;</span> of 1, the data are still noisy
(of course!) but the background function properly follows the data.
</p>
</div>


<hr class=hide />
<a name="theinteractionbetweensplineclampsandk-weight">

<h2>  The interaction between spline clamps and k-weight</h2>
</a>

The spline clamp and <span class=param>&laquo;k-weight&raquo;</span> parameters
sometimes interact strongly.  The criterion that &mu;&#8320;(E) follow
closely to the end of the data that is imposed by the spline clamp can
have a surprising effect on noisy, heavily k-weighted data.  This is
what happened in the data shown in the previous section.  Reducing the
strength of the spline clamp can sometimes help.

<div class=figure style="max-width: 644px; min-width: 7em;">
<a name=bkg_badkw_clamp0>
<img src=../../images/bkg_badkw_clamp0.png width=100%>
</a>
<p align=center>
The same noisy data as in the last figure, also with a background
<span class=param>&laquo;k-weight&raquo;</span> of 2.  However, this time the
high-end spline clamp was set to &ldquo;none&rdquo;.
</p>
</div>

Sometimes your data are well served by a low
<span class=param>&laquo;k-weight&raquo;</span> and a strong spline clamp.
Other times, a large <span class=param>&laquo;k-weight&raquo;</span> and a
weak clamp work better.  Still other times, a strong
<span class=param>&laquo;k-weight&raquo;</span>
<em>and</em>
a strong clamp work best.  How do you know what to do?  There are no
hard and fast rules, although you will develop an intuition for how
different data will respond to different parameter values.
Don't be shy about trying different combinations.

</div>

<br />
<hr class=hide />
<hr class=bottomdivider />

<div class=bottombar>
  <div class=copyright>
  <table>
    <tr>
      <td colspan=2>
        <span class=program>DEMETER</span> is copyright &copy; 2009-2014 Bruce Ravel
        &mdash;
        This document is copyright &copy; 2014 Bruce Ravel
        <br />
      </td>
    </tr>
    <tr valign=middle>
      <td> 
           <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../images/somerights20.png" width="88" height="31" alt="" border="0" /></a> &nbsp;&nbsp;&nbsp;
      </td>
      <td>
  	This document is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">
  	The Creative Commons Attribution-ShareAlike License</a>.
  	<br />
  	If <span class=program>DEMETER</span> and this document are useful to you, please consider
  	<a href="http://creativecommons.org/support/">supporting The Creative Commons</a>.
      </td>
    </tr>
  </table>
</div>
</div>
  </body>
</html>