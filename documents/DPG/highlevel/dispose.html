<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.1. Command disposal and command templates &#8212; Demeter Programming Guide 0.9.26 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.26',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/wheat.ico"/>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.2. Demeter&#39;s templating system" href="templates.html" />
    <link rel="prev" title="4. High level actions of the object model" href="index.html" />

    <link rel="stylesheet" type="text/css" href="../_static/demeter.css" />
    <link rel="stylesheet" type="text/css" href="../_static/keys.css" />
    <link rel="stylesheet" type="text/css" href="../_static/program.css" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="templates.html" title="4.2. Demeter&#39;s templating system"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="index.html" title="4. High level actions of the object model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Demeter Programming Guide 0.9.26 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. High level actions of the object model</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="command-disposal-and-command-templates">
<h1>4.1. Command disposal and command templates<a class="headerlink" href="#command-disposal-and-command-templates" title="Permalink to this headline">¶</a></h1>
<p><font size=-1 color="#8C4112">DEMETER</font> uses a highly abstract system for communicating
with <font size=-1 color="#8C4112">FEFF</font>, <font size=-1 color="#8C4112">IFEFFIT</font>, and the plotting
backend. The <a class="reference external" href="https://metacpan.org/pod/Text::Template">Text::Template</a> module is used along with
a large number of small, external template files. The idea behind
<a class="reference external" href="https://metacpan.org/pod/Text::Template">Text::Template</a> is quite
simple.  Perl code is interspersed with normal text.  A pass over the
text is made and the perl code is evaluated.  In this way, a bit of
text is made that is specifically relevant to a particular situation.
As an example, here is the template that <font size=-1 color="#8C4112">DEMETER</font> uses to
construct the <font size=-1 color="#8C4112">IFEFFIT</font> command used to normalize the
μ(E) data associated with a Data object.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>{ # -*- ifm -*-
  # pre-edge template
  #   {$D-&gt;group} returns the ifeffit group name
  #   {$D-&gt;parameter} returns the value of that parameter
}

pre_edge(&quot;{$D-&gt;group}.energy+{$D-&gt;bkg_eshift}&quot;,
         {$D-&gt;group}.xmu,
         e0         = {$D-&gt;bkg_e0},
         pre1       = {$D-&gt;bkg_pre1},
         pre2       = {$D-&gt;bkg_pre2},
         norm_order = {$D-&gt;bkg_nnorm},
         norm1      = {$D-&gt;bkg_nor1},
         norm2      = {$D-&gt;bkg_nor2})
</pre></div>
</div>
<p>In this example, <code class="docutils literal"><span class="pre">$D</span></code> represents the Data object. Thus
<font size=-1 color="#8C4112">IFEFFIT</font>'s <code class="docutils literal"><span class="pre">pre-edge</span></code> command is filled in with attribute
values appropriate to the current Data object.</p>
<p>The text generated from the processing of the template is then
disposed of via one or more avenues, one of which may include sending
the text to <font size=-1 color="#8C4112">IFEFFIT</font> for processing.</p>
<p>This section explains all of the disposal and templating options
available to a <font size=-1 color="#8C4112">DEMETER</font> program.</p>
<div class="section" id="command-disposal">
<h2>4.1.1. Command disposal<a class="headerlink" href="#command-disposal" title="Permalink to this headline">¶</a></h2>
<p>Once commands have been processed using the templating system, there are
seevral avenues for disposing of those commands. The most obvious avenue
is to send the commands to <font size=-1 color="#8C4112">IFEFFIT</font> so that the actual data can be
processed. However, several other options are possible.</p>
<p>The <code class="docutils literal"><span class="pre">dispose</span></code> method is a method of the base class and inherited by
all objects. It is used all throughout <font size=-1 color="#8C4112">DEMETER</font> to get things done and is
available for explicit use in <font size=-1 color="#8C4112">DEMETER</font> programs. The syntax is quite
simple:</p>
<div class="highlight-perl"><div class="highlight"><pre><span></span><span class="nv">$any_object</span> <span class="o">-&gt;</span> <span class="n">dispose</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>
<span class="nv">$any_object</span> <span class="o">-&gt;</span> <span class="n">dispose</span><span class="p">(</span><span class="nv">$text</span><span class="p">,</span> <span class="s">&#39;plotting&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The first line is used for any data processing command. The second form,
with the second argument to the method, is used to identify command text
which is explicitly used to make plots. When using the PGPLOT plotting
back end, there is not actually a significant difference between
plotting and non-plotting commands since <font size=-1 color="#8C4112">IFEFFIT</font> is used to send command
to PGPLOT. However, when using other plotting backends, it is essential
that plotting commands be apprpriately flagged. Plotting backends are
discussed in more detail in <a class="reference external" href="../ui.html">the user interface chapter</a>.</p>
<p>The <code class="docutils literal"><span class="pre">$text</span></code> given as an argument to the <code class="docutils literal"><span class="pre">dispose</span></code> method typically
comes from the evaluation of a template, but can be any text generated
in any fashion. Thus, it is a completely generic way for a program to
communicate with <font size=-1 color="#8C4112">DEMETER</font>'s backends.</p>
<p>The targets of the <code class="docutils literal"><span class="pre">dispose</span></code> method are set using the <code class="docutils literal"><span class="pre">set_mode</span></code>
method, another method of the base class which is inherited by all
objects. The syntax of <code class="docutils literal"><span class="pre">set_mode</span></code> is consistent with other methods in
<font size=-1 color="#8C4112">DEMETER</font>:</p>
<div class="highlight-perl"><div class="highlight"><pre><span></span><span class="nv">$any_object</span> <span class="o">-&gt;</span> <span class="n">set_mode</span><span class="p">(</span><span class="n">screen</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="n">backend</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Any command can be sent to multiple targets. The disposal targets which
can be set using <code class="docutils literal"><span class="pre">set_mode</span></code> are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">backend</span></code></dt>
<dd>When true, commands will be sent to <font size=-1 color="#8C4112">IFEFFIT</font> or
<font size=-1 color="#8C4112">LARCH</font>. It is often useful to turn this disposal target
off when debugging <font size=-1 color="#8C4112">DEMETER</font> programs.  <code class="docutils literal"><span class="pre">ifeffit</span></code> and
<code class="docutils literal"><span class="pre">larch</span></code> are aliases for <code class="docutils literal"><span class="pre">backend</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">screen</span></code></dt>
<dd>When true, commands will be sent to standard output (usually the
screen). Turning this disposal target on is often useful when
debugging <font size=-1 color="#8C4112">DEMETER</font> programs.</dd>
<dt><code class="docutils literal"><span class="pre">plotscreen</span></code></dt>
<dd>When true, plotting commands will be sent to standard output
(usually the screen). Turning this disposal target on is often
useful when debugging <font size=-1 color="#8C4112">DEMETER</font> programs.</dd>
<dt><code class="docutils literal"><span class="pre">repscreen</span></code></dt>
<dd>When true, the reprocessed commands (<a class="reference external" href="#reprocessed-commands">discussed below</a>) will be sent to standard output
(usually the screen).</dd>
<dt><code class="docutils literal"><span class="pre">file</span></code></dt>
<dd>When set to a string value, that string will be interpretted as a
file name to be opened for writing and the commands will then be
written to that file. To append text to a file, the <code class="docutils literal"><span class="pre">file</span></code> mode
string should begin with the <code class="docutils literal"><span class="pre">&gt;</span></code> character.</dd>
<dt><code class="docutils literal"><span class="pre">plotfile</span></code></dt>
<dd>When set to a string value, that string will be interpretted as a
file name to be opened for writing and the plotting commands will
then be written to that file. To append text to a file, the <code class="docutils literal"><span class="pre">file</span></code>
mode string should begin with the <code class="docutils literal"><span class="pre">&gt;</span></code> character.</dd>
<dt><code class="docutils literal"><span class="pre">repfile</span></code></dt>
<dd>When set to a string value, that string will be interpretted as a
file name to be opened for writing and the reprocessed commands
(<a class="reference external" href="#reprocessed-commands">discussed below</a>) will then be written
to that file. To append text to a file, the <code class="docutils literal"><span class="pre">file</span></code> mode string
should begin with the <code class="docutils literal"><span class="pre">&gt;</span></code> character.</dd>
<dt><code class="docutils literal"><span class="pre">buffer</span></code></dt>
<dd>When set to an array reference, commands will be pushed onto that
array. When set to a scalar reference, commands will be concatinated
to the end of the strings held by the scalar.</dd>
<dt><code class="docutils literal"><span class="pre">plotbuffer</span></code></dt>
<dd>When set to an array reference, plotting commands will be pushed
onto that array. When set to a scalar reference, plotting commands
will be concatinated to the end of the strings held by the scalar.</dd>
<dt><code class="docutils literal"><span class="pre">callback</span></code></dt>
<dd>When set to a code reference, the text of the command will be sent
to that code reference as the sole argument. This is useful for user
interfaces that want to post-process the commands. For example, this
disposal mode is used by <font size=-1 color="#8C4112">ARTEMIS</font> to display colorized text in its
command buffer.</dd>
<dt><code class="docutils literal"><span class="pre">plotcallback</span></code></dt>
<dd>When set to a code reference, the text of the plotting command will
be sent to that code reference as the sole argument. This is useful
for user interfaces that want to post-process the commands. For
example, this disposal mode is used by <font size=-1 color="#8C4112">ARTEMIS</font> to display colorized
text in its plotting buffer.</dd>
<dt><code class="docutils literal"><span class="pre">feedback</span></code></dt>
<dd>When set to a code reference, the text of <font size=-1 color="#8C4112">IFEFFIT</font>'s (or
<font size=-1 color="#8C4112">LARCH</font>'s) response to commands will be sent to that code
reference as the sole argument.  This is useful for user
interfaces that want to post-process the commands. For example,
this disposal mode is used by <font size=-1 color="#8C4112">ARTEMIS</font> to display
colorized text in its command buffer.</dd>
</dl>
</div>
<div class="section" id="reprocessed-commands">
<h2>4.1.2. Reprocessed commands<a class="headerlink" href="#reprocessed-commands" title="Permalink to this headline">¶</a></h2>
<p><font size=-1 color="#8C4112">DEMETER</font> tries to use <font size=-1 color="#8C4112">IFEFFIT</font> as efficiently as
possibly. On one hand, <font size=-1 color="#8C4112">IFEFFIT</font> the one of the things that
makes <font size=-1 color="#8C4112">DEMETER</font> go and so is indispensible. On the other
hand, the business of communicating between perl code and the
<font size=-1 color="#8C4112">IFEFFIT</font> library is (<a class="reference external" href="../feff/pathfinder.html">with one exception</a>) always the slowest thing that
<font size=-1 color="#8C4112">DEMETER</font> does. One of the optimizations implemented by
<font size=-1 color="#8C4112">DEMETER</font> is the reprocessing of commands targeted for
disposal to <font size=-1 color="#8C4112">IFEFFIT</font>.</p>
<p>Command strings in <font size=-1 color="#8C4112">IFEFFIT</font> can be quite long – up to 2048
characters as it is normally compiled. A command that is split over
multiple lines, as the example at the beginning of this section is,
will be processed much faster if <font size=-1 color="#8C4112">DEMETER</font> pre-processes the
command to remove unnecessary line breaks. Basically this means that
everything between parentheses will be sent to <font size=-1 color="#8C4112">IFEFFIT</font> as a
single string. This is accomplished within the <code class="docutils literal"><span class="pre">dispose</span></code> method via
the application of a few regular expressions. The reprocessed string
is then sent to <font size=-1 color="#8C4112">IFEFFIT</font>.</p>
<p>As a small example of how reprocessing works, this human-friendly
command:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>pre_edge(&quot;data0.energy+0&quot;,
         data0.xmu,
         e0         = -9999999,
         pre1       = -150,
         pre2       = -30,
         norm_order = 3,
         norm1      = 150,
         norm2      = 1800)
</pre></div>
</div>
<p>will be reprocessed into this one-line command before being shuffled off
to <font size=-1 color="#8C4112">IFEFFIT</font>.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>pre_edge(&quot;data0.energy+0&quot;, data0.xmu, e0=-9999999, pre1=-150, pre2=-30, norm_order=3, norm1=150, norm2=1800)
</pre></div>
</div>
<p>which, when summed over dozens or hundreds of <font size=-1 color="#8C4112">IFEFFIT</font> commands, results
in a substantial performance improvement.</p>
<p>The <code class="docutils literal"><span class="pre">repscreen</span></code> and <code class="docutils literal"><span class="pre">repfile</span></code> disposal targets are provided to
debug the behavior of this optimization. Reprocessing is quite well
tested.  However, if you suspect that reprocessing is damaging the
commands sent to <font size=-1 color="#8C4112">IFEFFIT</font>, use one of those disposal
channels to see the text that is actually being sent.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><font size=-1 color="#8C4112">LARCH</font> does not use reprocessed commands.  When
<font size=-1 color="#8C4112">LARCH</font> is the backend, the reprocessing step is skipped.</p>
</div>
</div>
<div class="section" id="command-templates">
<h2>4.1.3. Command templates<a class="headerlink" href="#command-templates" title="Permalink to this headline">¶</a></h2>
<p><font size=-1 color="#8C4112">DEMETER</font> ships with <strong>a lot</strong> of templates. Each template
encapsulates a small bit of functionality and <font size=-1 color="#8C4112">DEMETER</font> does
many things. The templates are organized into “template sets”,
which are written for specific backend targets, and “template
groups” which, are groups of templates which serve related
functions. All template sets must have a complete representation of
template groups to be fully functional.</p>
<p>The templates are found in <code class="file docutils literal"><span class="pre">lib/templates/</span></code> directory underneath
the installation location of the <font size=-1 color="#8C4112">DEMETER</font> package. One of
the reasons for explaining the templating system in this level of
detail is to underscore that it is quite possible to add new template
sets. By following the model of the existing template sets, new output
types can be created for <font size=-1 color="#8C4112">DEMETER</font>. Indeed, when finally
makes its appearence, it should be relatively simple to extend
<font size=-1 color="#8C4112">DEMETER</font> to use it simply by creating an apprporiate
template set.</p>
<p>Choosing between template sets is one of the topics of <a class="reference external" href="mode.html">the next
section</a>.</p>
<div class="section" id="template-sets">
<h3>4.1.3.1. Template sets<a class="headerlink" href="#template-sets" title="Permalink to this headline">¶</a></h3>
<p><font size=-1 color="#8C4112">DEMETER</font> currently ships with five different sets in the
data processing, XANES analysis, EXAFS fitting, and plugin categories:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">ifeffit</span></code>, templates which write the syntax of <font size=-1 color="#8C4112">IFEFFIT</font>
in a compact form</li>
<li><code class="docutils literal"><span class="pre">larch</span></code>, templates which write the syntax of <font size=-1 color="#8C4112">LARCH</font></li>
<li><code class="docutils literal"><span class="pre">iff_columns</span></code>, templates which write the syntax of
<font size=-1 color="#8C4112">IFEFFIT</font> is a more human-readable form</li>
<li><code class="docutils literal"><span class="pre">feffit</span></code>, templates which write the syntax of input files for the
old <font size=-1 color="#8C4112">FEFFIT</font> program.  <em>incomplete</em></li>
<li><code class="docutils literal"><span class="pre">demeter</span></code>, templates which write out perl syntax using
<font size=-1 color="#8C4112">DEMETER</font>.  <em>incomplete</em></li>
</ol>
<p>The <code class="docutils literal"><span class="pre">demeter</span></code> category might seem a bit strange. Its purpose is to
allow <font size=-1 color="#8C4112">DEMETER</font> programs to write <font size=-1 color="#8C4112">DEMETER</font>
programs.  The intent is to allow a GUI to export a file containing a
<font size=-1 color="#8C4112">DEMETER</font> program that can be used to make a fit using the
same fitting model that was created using the GUI.</p>
<p>The possibility of having these different output targets is the main
reason for using a templating system.  Having command creation
contained in these small template files separate from the code may
seem like an unnecessary layer of abstraction and misdirection, but it
offers <font size=-1 color="#8C4112">DEMETER</font> a lot of flexibility and power.  This is even
more evident for the plotting backends.</p>
<p><font size=-1 color="#8C4112">DEMETER</font> currently ships with four sets in the plotting
category. More information about plotting backends can be found in
<a class="reference external" href="../ui.html">the user interface chapter</a>.</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">gnuplot</span></code>, templates which write <strong class="program">Gnuplot</strong> plotting
scripts.  This is the default plotting backend.  Using
<strong class="program">Gnuplot</strong> involves writing lots of temporary files which
contain the data to be plotted.  It also requires that
<strong class="program">Gnuplot</strong> be installed on your computer, which is
something that you have to do separate from the installation of
<font size=-1 color="#8C4112">DEMETER</font>.</li>
<li><code class="docutils literal"><span class="pre">pgplot</span></code>, templates which write the syntax of <font size=-1 color="#8C4112">IFEFFIT</font> plotting
commands, which talk directly to <strong class="program">PGPLOT</strong>.</li>
<li><code class="docutils literal"><span class="pre">singlefile</span></code>, this set of templates is used to export the data to
be plotted to a single column file.  The main use of this is in a
GUI to exprt a file that can be used to replicate an interesting
plot – with offsets, energy shifts, and scaling factors – in
an external plotting program.</li>
<li><code class="docutils literal"><span class="pre">demeter</span></code>, templates which write out perl syntax using
<font size=-1 color="#8C4112">DEMETER</font>.  <em>incomplete</em></li>
</ol>
<p>In the future, there might be more plotting backends.  A backend for
<font size=-1 color="#8C4112">LARCH</font>'s matplotlib interface would make sense.</p>
<p><font size=-1 color="#8C4112">DEMETER</font> currently ships with two different sets in the
<font size=-1 color="#8C4112">FEFF</font> input template category, one for <font size=-1 color="#8C4112">FEFF6</font> and
one for <font size=-1 color="#8C4112">FEFF8</font>. (Actually the <font size=-1 color="#8C4112">FEFF8</font> set has not
yet been written at the time this document is being written.  In fact,
<font size=-1 color="#8C4112">DEMETER</font>'s <font size=-1 color="#8C4112">FEFF8</font> interface has not yet been
started.  Support for <font size=-1 color="#8C4112">FEFF8</font> will use <a class="reference external" href="https://github.com/xraypy/feff85exafs">feff85exafs</a>.</p>
<p>There is only one set in the <font size=-1 color="#8C4112">ATOMS</font> input template
category. It seems unlikely that other sets will actually be required.</p>
</div>
<div class="section" id="template-groups">
<h3>4.1.3.2. Template groups<a class="headerlink" href="#template-groups" title="Permalink to this headline">¶</a></h3>
<p>Template groups define related chores. These chores are</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">process</span></code>: all data processing chores that do not involve fitting
χ(k) data or doing any other sort of data analysis.</li>
<li><code class="docutils literal"><span class="pre">fit</span></code>: all chores associated with fitting χ(k) data.</li>
<li><code class="docutils literal"><span class="pre">analysis</span></code>: XANES analysis chores.  This includes things
like linear combination fitting. principle component analysis, or
log-ratio/phase-difference analysis.</li>
<li><code class="docutils literal"><span class="pre">plot</span></code>: all chores associated with plotting data</li>
<li><code class="docutils literal"><span class="pre">report</span></code>: generation of textual reports</li>
<li><code class="docutils literal"><span class="pre">plugin</span></code>: data processing chores performed by filetype or other
plugins</li>
<li><code class="docutils literal"><span class="pre">feff</span></code>: <font size=-1 color="#8C4112">FEFF</font> input templates</li>
<li><code class="docutils literal"><span class="pre">atoms</span></code>: <font size=-1 color="#8C4112">ATOMS</font> input templates</li>
</ol>
<p>The first four groups must be provided completely by any template set.
Although if a template is missing from a template set,
<font size=-1 color="#8C4112">DEMETER</font> will fall back to using the template for that chore
found in the <code class="docutils literal"><span class="pre">ifeffit</span></code> set.</p>
</div>
<div class="section" id="the-template-method">
<h3>4.1.3.3. The template method<a class="headerlink" href="#the-template-method" title="Permalink to this headline">¶</a></h3>
<p>When the <code class="docutils literal"><span class="pre">template</span></code> method is called, a number of variables are set
for use in the template. These variables are set appropriately for the
contect in which the <code class="docutils literal"><span class="pre">template</span></code> method is called. You can see one
example of this in the example at the beginning of this section. The
<code class="docutils literal"><span class="pre">$D</span></code> variable represents the Data object relevant to the context in
which that template is evaluated. Some more examples will be seen below.</p>
<p>Here is the complete list of these special variables.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">$S</span></code></dt>
<dd>This is the “self” object, i.e. the object that called the
<code class="docutils literal"><span class="pre">template</span></code> method.</dd>
<dt><code class="docutils literal"><span class="pre">$D</span></code></dt>
<dd>The is the Data object of the calling object. When a Data object is
the caller, <code class="docutils literal"><span class="pre">$S</span></code> and <code class="docutils literal"><span class="pre">$D</span></code> are the same thing. For a Path object
as <code class="docutils literal"><span class="pre">$S</span></code>, <code class="docutils literal"><span class="pre">$D</span></code> is its associated Data object.</dd>
<dt><code class="docutils literal"><span class="pre">$P</span></code></dt>
<dd>This is the Plot object.</dd>
<dt><code class="docutils literal"><span class="pre">$C</span></code></dt>
<dd>This is the Config object.</dd>
<dt><code class="docutils literal"><span class="pre">$F</span></code></dt>
<dd>This is the currently active Fit object.</dd>
<dt><code class="docutils literal"><span class="pre">$DS</span></code></dt>
<dd>This is the currently active Data standard.</dd>
<dt><code class="docutils literal"><span class="pre">$T</span></code></dt>
<dd>This is the currently active Feff (i.e. theory) object.</dd>
<dt><code class="docutils literal"><span class="pre">$PT</span></code></dt>
<dd>This is the currently active Path object.</dd>
</dl>
<p>The syntax of the <code class="docutils literal"><span class="pre">template</span></code> method is relatively simple. The method
takes two arguments, the first identifying the template group, the
second identifying the chore that the template performs. Identifying the
specific template also requires the template set, which is an attribute
of the <a class="reference external" href="mode.html">Mode group</a>.</p>
<div class="highlight-perl"><div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$string</span> <span class="o">=</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">template</span><span class="p">(</span><span class="s">&quot;process&quot;</span><span class="p">,</span> <span class="s">&quot;fft&quot;</span><span class="p">);</span>
<span class="nv">$self</span><span class="o">-&gt;</span><span class="n">dispose</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
</pre></div>
</div>
<p>In this example, the command to make a forward Fourier transform using
the current template set is generated by evaluating the appropriate
template. The text of this command is then passed to the <code class="docutils literal"><span class="pre">dispose</span></code>
method.</p>
<p>Some templates require data that is not normally available from any
attribute of any object. There are two ways of addressing that
situation. One is to store an arbitrarily named attribute in the Config
object. This is done like so:</p>
<div class="highlight-perl"><div class="highlight"><pre><span></span><span class="nv">$config</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">conv_type</span>  <span class="o">=&gt;</span> <span class="nv">$args</span><span class="p">{</span><span class="n">type</span><span class="p">},</span>
             <span class="n">conv_width</span> <span class="o">=&gt;</span> <span class="nv">$args</span><span class="p">{</span><span class="n">width</span><span class="p">},</span>
             <span class="n">conv_which</span> <span class="o">=&gt;</span> <span class="nv">$args</span><span class="p">{</span><span class="n">which</span><span class="p">},</span>
            <span class="p">);</span>
<span class="k">my</span> <span class="nv">$string</span> <span class="o">=</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">template</span><span class="p">(</span><span class="s">&quot;process&quot;</span><span class="p">,</span> <span class="s">&quot;convolve&quot;</span><span class="p">);</span>
<span class="nv">$self</span><span class="o">-&gt;</span><span class="n">dispose</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
</pre></div>
</div>
<p>Here three scalars related to data covolution are set in the Config
object. Here is how those scalars are used:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>{
  $x = ($C-&gt;get(&quot;conv_which&quot;) eq &#39;xmu&#39;) ? &#39;energy&#39; : &#39;k&#39;;
  $type = &#39;gconvolve&#39;;
  ($type = &#39;lconvolve&#39;) if (lc($C-&gt;get(&quot;conv_type&quot;)) =~ m{\Al});
  q{}
}
##|
##| convolution {$D-&gt;group}
set {$D-&gt;group}.{$C-&gt;get(&quot;conv_which&quot;)} = {$type}({$D-&gt;group}.{$x}, {$D-&gt;group}.{$C-&gt;get(&quot;conv_which&quot;)}, {$C-&gt;get(&quot;conv_width&quot;)})
##|
</pre></div>
</div>
<p>Note that this example uses the <code class="docutils literal"><span class="pre">$C</span></code> special template variable to
access the Config object and the Config object's <code class="docutils literal"><span class="pre">get</span></code> method to
oibjtain the values of these arbitrarily named scalars.</p>
<p>The other approach to passing arbitrary data to a template is to provide
a hash reference as the third argument of the <code class="docutils literal"><span class="pre">template</span></code> method.</p>
<div class="highlight-perl"><div class="highlight"><pre><span></span><span class="nv">$command</span> <span class="o">=</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">template</span><span class="p">(</span><span class="s">&quot;plot&quot;</span><span class="p">,</span> <span class="s">&quot;marker&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=&gt;</span> <span class="nv">$xx</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="o">=&gt;</span> <span class="nv">$y</span> <span class="p">});</span>
</pre></div>
</div>
<p>These user-defined parameters are then accessed by name in the template.
This example also shows the use of the <code class="docutils literal"><span class="pre">$P</span></code> special variable to make
reference to the Plot object.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>plot_marker({$x}, {$y}, marker={$P-&gt;markertype}, color={$P-&gt;markercolor})
</pre></div>
</div>

<br>

<br>
<hr class="docutils" />
<p><font size=-1 color="#8C4112">DEMETER</font> is copyright © 2009-2016 Bruce Ravel – This document is
copyright © 2016 Bruce Ravel</p>
<p>This document is licensed under <a class="reference external" href="https://creativecommons.org/licenses/by-sa/3.0/">The Creative Commons Attribution-ShareAlike License</a>.</p>
<p>If <font size=-1 color="#8C4112">DEMETER</font> and this document are useful to you, please
consider <a class="reference external" href="https://creativecommons.org/donate/">supporting The Creative Commons</a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/Isis-Sothis-Demeter_sm.jpg" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">2. The basics of data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mue/index.html">3. Processing μ(E) data</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. High level actions of the object model</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.1. Command disposal and command templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html">4.2. Demeter's templating system</a></li>
<li class="toctree-l2"><a class="reference internal" href="mode.html">4.3. Mode object</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot.html">4.4. Plot object</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">4.5. Config object</a></li>
<li class="toctree-l2"><a class="reference internal" href="methods.html">4.6. Other high level object methods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../xanes/index.html">5. Analysis of XANES data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../atoms.html">6. Atoms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feff/index.html">7. Feff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../paths/index.html">8. Scattering paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gds.html">9. Guess/Def/Set Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fit/index.html">10. Fitting EXAFS data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../perl.html">11. Using perl to structure a fit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lgcv.html">12. Local guess parameters and the characteristic value</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pathlike/index.html">13. Path-like objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui.html">14. User interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output.html">15. Output formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">16. Full examples</a></li>
</ul>
<h3>Helpful Links</h3>
<p>Current Demeter version: <b>0.9.26</b></p>

<ul>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/">Demeter homepage</a>
  <li>&nbsp; &nbsp; <a href="https://github.com/bruceravel/demeter/">Demeter @ github</a>
  <li>&nbsp; &nbsp; <a href="http://cars9.uchicago.edu/mailman/listinfo/ifeffit/">Ifeffit mailing list</a>
  <li>&nbsp; &nbsp; <a href="http://xraypy.github.io/xraylarch/">Larch homepage</a>
  <li>&nbsp; &nbsp; <a href="https://github.com/newville/ifeffit">Ifeffit @ github</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/XAS-Education/">Bruce's XAS Education page</a>
  <li>&nbsp; &nbsp; <a href="http://xafs.org/">xafs.org</a>
</ul>
<ul>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/Athena/index.html">Athena manual</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/Artemis/index.html">Artemis manual</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/SinglePage/bugs.html">Bug reporting hints</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/SinglePage/help.html">How to ask a good question</a>
</ul>
<p>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/highlevel/dispose.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="templates.html" title="4.2. Demeter&#39;s templating system"
             >next</a></li>
        <li class="right" >
          <a href="index.html" title="4. High level actions of the object model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Demeter Programming Guide 0.9.26 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. High level actions of the object model</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Bruce Ravel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>