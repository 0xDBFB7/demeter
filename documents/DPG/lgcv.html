<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>12. Local guess parameters and the characteristic value &mdash; Demeter Programming Guide 0.9.24 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9.24',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/wheat.ico"/>
    <link rel="top" title="Demeter Programming Guide 0.9.24 documentation" href="index.html" />
    <link rel="prev" title="11. Using perl to structure a fit" href="perl.html" />

    <link rel="stylesheet" type="text/css" href="_static/demeter.css" />
    <link rel="stylesheet" type="text/css" href="_static/keys.css" />
    <link rel="stylesheet" type="text/css" href="_static/program.css" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="perl.html" title="11. Using perl to structure a fit"
             accesskey="P">previous</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">Demeter Programming Guide 0.9.24 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="local-guess-parameters-and-the-characteristic-value">
<h1>12. Local guess parameters and the characteristic value<a class="headerlink" href="#local-guess-parameters-and-the-characteristic-value" title="Permalink to this headline">¶</a></h1>
<p><font size=-1 color="#8C4112">DEMETER</font> offers two very high level tools for efficiently
parametrizing fits, particularly multiple data set fits. These are
called “local guess parameters” and the
“characteristic value”. Here is the the multiple data set fit
to copper metal <a class="reference external" href="fit/collection.html">that we saw before</a>, but
modified to use these two tools.</p>
<div class="highlight-perl"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="highlight"><pre> <span class="c1">#!/usr/bin/perl</span>
 <span class="k">use</span> <span class="n">Demeter</span> <span class="sx">qw(:ui=screen)</span><span class="p">;</span>

 <span class="k">my</span> <span class="nv">@common</span> <span class="o">=</span> <span class="p">(</span><span class="n">fft_kmin</span>   <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>    <span class="n">fft_kmax</span>   <span class="o">=&gt;</span> <span class="mi">14</span><span class="p">,</span>
               <span class="n">bft_rmax</span>   <span class="o">=&gt;</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="n">bft_rmax</span>   <span class="o">=&gt;</span> <span class="mf">4.3</span><span class="p">,</span>
               <span class="n">fit_k1</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>    <span class="n">fit_k3</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,);</span>

 <span class="c1">## make a Data object and set the FT and fit parameters</span>
 <span class="k">my</span> <span class="p">(</span><span class="nv">$data_010k</span><span class="p">,</span> <span class="nv">$data_150k</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$prj</span><span class="o">-&gt;</span><span class="n">records</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
 <span class="nv">$data_010k</span> <span class="o">-&gt;</span> <span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="o">=&gt;</span><span class="s">&#39;10 K copper data&#39;</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=&gt;</span><span class="mi">10</span><span class="p">,</span>  <span class="nv">@common</span><span class="p">);</span>
 <span class="nv">$data_150k</span> <span class="o">-&gt;</span> <span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="o">=&gt;</span><span class="s">&#39;150 K copper data&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=&gt;</span><span class="mi">150</span><span class="p">,</span> <span class="nv">@common</span><span class="p">);</span>

 <span class="c1">## run a Feff calculation on copper metal</span>
 <span class="k">my</span> <span class="nv">$feff</span> <span class="o">=</span> <span class="nn">Demeter::</span><span class="n">Feff</span> <span class="o">-&gt;</span> <span class="k">new</span><span class="p">(</span><span class="n">file</span> <span class="o">=&gt;</span> <span class="s">&quot;cu_metal.inp&quot;</span><span class="p">);</span>
 <span class="nv">$feff</span> <span class="o">-&gt;</span> <span class="n">set</span><span class="p">(</span><span class="n">workspace</span> <span class="o">=&gt;</span> <span class="s">&quot;cu_workspace/&quot;</span><span class="p">,</span> <span class="n">screen</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,);</span>
 <span class="nv">$feff</span> <span class="o">-&gt;</span> <span class="n">potph</span> <span class="o">-&gt;</span> <span class="n">pathfinder</span><span class="p">;</span>
 <span class="k">my</span> <span class="nv">@list_of_paths</span> <span class="o">=</span> <span class="nv">$feff</span> <span class="o">-&gt;</span> <span class="n">list_of_paths</span><span class="p">;</span>

 <span class="c1">## define a set of parameters</span>
 <span class="k">my</span> <span class="nv">@gds</span> <span class="o">=</span>  <span class="p">(</span><span class="nn">Demeter::</span><span class="n">GDS</span> <span class="o">-&gt;</span> <span class="k">new</span><span class="p">(</span><span class="n">gds</span> <span class="o">=&gt;</span> <span class="s">&#39;lguess&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=&gt;</span> <span class="s">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">mathexp</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">),</span>
             <span class="nn">Demeter::</span><span class="n">GDS</span> <span class="o">-&gt;</span> <span class="k">new</span><span class="p">(</span><span class="n">gds</span> <span class="o">=&gt;</span> <span class="s">&#39;guess&#39;</span><span class="p">,</span>  <span class="n">name</span> <span class="o">=&gt;</span> <span class="s">&#39;amp&#39;</span><span class="p">,</span>   <span class="n">mathexp</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">),</span>
             <span class="nn">Demeter::</span><span class="n">GDS</span> <span class="o">-&gt;</span> <span class="k">new</span><span class="p">(</span><span class="n">gds</span> <span class="o">=&gt;</span> <span class="s">&#39;guess&#39;</span><span class="p">,</span>  <span class="n">name</span> <span class="o">=&gt;</span> <span class="s">&#39;enot&#39;</span><span class="p">,</span>  <span class="n">mathexp</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">),</span>
             <span class="nn">Demeter::</span><span class="n">GDS</span> <span class="o">-&gt;</span> <span class="k">new</span><span class="p">(</span><span class="n">gds</span> <span class="o">=&gt;</span> <span class="s">&#39;guess&#39;</span><span class="p">,</span>  <span class="n">name</span> <span class="o">=&gt;</span> <span class="s">&#39;theta&#39;</span><span class="p">,</span> <span class="n">mathexp</span> <span class="o">=&gt;</span> <span class="mi">500</span><span class="p">),</span>
             <span class="nn">Demeter::</span><span class="n">GDS</span> <span class="o">-&gt;</span> <span class="k">new</span><span class="p">(</span><span class="n">gds</span> <span class="o">=&gt;</span> <span class="s">&#39;set&#39;</span><span class="p">,</span>    <span class="n">name</span> <span class="o">=&gt;</span> <span class="s">&#39;sigmm&#39;</span><span class="p">,</span> <span class="n">mathexp</span> <span class="o">=&gt;</span> <span class="mf">0.0005</span><span class="p">),</span>
            <span class="p">);</span>

 <span class="c1">## assign paths to the first data set</span>
 <span class="k">my</span> <span class="nv">@paths_010k</span> <span class="o">=</span> <span class="p">();</span>
 <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$i</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">my</span> <span class="nv">$j</span> <span class="o">=</span> <span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
   <span class="nv">$paths_010k</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nn">Demeter::</span><span class="n">Path</span> <span class="o">-&gt;</span> <span class="k">new</span><span class="p">();</span>
   <span class="nv">$paths_010k</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">data</span>     <span class="o">=&gt;</span> <span class="nv">$data_010k</span><span class="p">,</span>
                        <span class="n">sp</span>       <span class="o">=&gt;</span> <span class="nv">$list_of_paths</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
                        <span class="n">name</span>     <span class="o">=&gt;</span> <span class="s">&quot;[cv]K, path $j&quot;</span><span class="p">,</span>
                        <span class="n">s02</span>      <span class="o">=&gt;</span> <span class="s">&#39;amp&#39;</span><span class="p">,</span>
                        <span class="n">e0</span>       <span class="o">=&gt;</span> <span class="s">&#39;enot&#39;</span><span class="p">,</span>
                        <span class="n">delr</span>     <span class="o">=&gt;</span> <span class="s">&#39;alpha*reff&#39;</span><span class="p">,</span>
                        <span class="n">sigma2</span>   <span class="o">=&gt;</span> <span class="s">&#39;debye([cv], theta) + sigmm&#39;</span><span class="p">,</span>
                       <span class="p">);</span>
 <span class="p">};</span>

 <span class="c1">## clone all the paths from the first data set and assign them to the second</span>
 <span class="k">my</span> <span class="nv">@paths_150k</span> <span class="o">=</span> <span class="p">();</span>
 <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$i</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">my</span> <span class="nv">$j</span> <span class="o">=</span> <span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
   <span class="nv">$paths_150k</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$paths_010k</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">Clone</span><span class="p">(</span><span class="n">data</span> <span class="o">=&gt;</span> <span class="nv">$data_150k</span><span class="p">);</span>
 <span class="p">};</span>

 <span class="c1">## do the fit</span>
 <span class="k">my</span> <span class="nv">$fitobject</span> <span class="o">=</span> <span class="nn">Demeter::</span><span class="n">Fit</span> <span class="o">-&gt;</span> <span class="k">new</span><span class="p">(</span><span class="n">gds</span>   <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@gds</span><span class="p">,</span>
                                     <span class="n">data</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="nv">$data_010k</span><span class="p">,</span> <span class="nv">$data_150k</span><span class="p">],</span>
                                     <span class="n">paths</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nv">@paths_010k</span><span class="p">,</span> <span class="nv">@paths_150k</span><span class="p">],</span>
                                    <span class="p">);</span>
 <span class="nv">$fitobject</span> <span class="o">-&gt;</span> <span class="n">fit</span><span class="p">;</span>
 <span class="c1">## after-fit chores follow ...</span>
</pre></div>
</td></tr></table></div>
<p>At lines 10 and 11, the <code class="docutils literal"><span class="pre">cv</span></code> attribute is set for each Data object.
This is the “characteristic value” for each data set, a
user-defined number that somehow relates to the XAS data contained in
the Data object. In this case, it is the temperature at which each
data were measured. In general, the <code class="docutils literal"><span class="pre">cv</span></code> should be something that is
meaningful to you within the context of your fitting model. It need
not be a number. The <code class="docutils literal"><span class="pre">cv</span></code> could be used, for instance, to assign
different parameters to different data sets. It's a simple tool, but
it can be used creatively to do interesting things in a fitting model.</p>
<p>The <code class="docutils literal"><span class="pre">cv</span></code> is then used at line 32 as part of each Path's name and at
line 36 as the temperature argument to the <code class="docutils literal"><span class="pre">debye</span></code> function. As
<font size=-1 color="#8C4112">DEMETER</font> digs through the collection of Paths in the Fit
object, it will notice the use of the characteristic value and
substitute in the value of <code class="docutils literal"><span class="pre">cv</span></code> of the associated Data object.</p>
<p>This is not only useful for multile data set fits, it is also useful
when applying a specific fitting model to a sequence of data sets. Each
data set can have a characteristic value that will then be used
correctly by the fitting model for each fit in the sequence.</p>
<p>At lines 19, a new kind of GDS parameter is defined. An
<span class="lguess">lguess</span>, or “local guess”, is a token that tells
<font size=-1 color="#8C4112">DEMETER</font> to create a <span class="guess">guess</span> parameter for every Data
object which has a Path which uses the <span class="lguess">lguess</span> parameter.  In
this example, <code class="docutils literal"><span class="pre">alpha</span></code> is intended to represent the volumetric
expansion coefficient of the copper lattice at each temperature. We
want to allow this volumetric coefficient to float freely for each
data set.</p>
<p>As <font size=-1 color="#8C4112">DEMETER</font> digs through the Fit object, a uniquely named
<span class="guess">guess</span> parameter will be created for each data set and any
path parameter math expressions will be rewritten to use that
<span class="guess">guess</span> parameter. in this example, the <span class="lguess">lguess</span>
<code class="docutils literal"><span class="pre">alpha</span></code> will be expaneded into two <span class="guess">guess</span> parameters called
<code class="docutils literal"><span class="pre">alpha_10</span></code> and <code class="docutils literal"><span class="pre">alpha_150</span></code>. (The <code class="docutils literal"><span class="pre">cv</span></code> is used if it is defined,
otherwise the <code class="docutils literal"><span class="pre">group</span></code> attribute is used after the underscore.) The
generated <span class="guess">guess</span> parameters will be reported in the log file.</p>
<p>In the <a class="reference external" href="fit/collection.html">earlier multiple data set example</a>, it
was necessary to redefine the <code class="docutils literal"><span class="pre">delr</span></code> and <code class="docutils literal"><span class="pre">sigma2</span></code> path parameters
after cloning Paths for use with the data set at 150 K. Using these two
tools, those redefinitions were not necessary.</p>
<p>Obviously, both the <span class="lguess">lguess</span> and the characteristic value are
efficiency tools.  They are intended to make fitting models easier to
write and more flexile to reuse.  Neither adds new functionality that
would be unavailable in other ways, but both should make the use of
<font size=-1 color="#8C4112">DEMETER</font> easier and less error-prone.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">An “ldef” or “local def” parameter has
not yet been implemented. Thus, <span class="lguess">lguess</span> parameters can
only be used in path parameter math expressions. Attempting to use
an <span class="lguess">lguess</span> parameter in the math expression for another
GDS parameter will result in an error which will stop your program.</p>
</div>

<br>

<br>
<hr class="docutils" />
<p><font size=-1 color="#8C4112">DEMETER</font> is copyright © 2009-2016 Bruce Ravel – This document is
copyright © 2016 Bruce Ravel</p>
<p>This document is licensed under <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/">The Creative Commons Attribution-ShareAlike License</a>.</p>
<p>If <font size=-1 color="#8C4112">DEMETER</font> and this document are useful to you, please
consider <a class="reference external" href="http://creativecommons.org/support/">supporting The Creative Commons</a>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/Isis-Sothis-Demeter_sm.jpg" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="data/index.html">2. The basics of data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="mue/index.html">3. Processing μ(E) data</a></li>
<li class="toctree-l1"><a class="reference internal" href="xanes/index.html">4. Analysis of XANES data</a></li>
<li class="toctree-l1"><a class="reference internal" href="highlevel/index.html">5. High level actions of the object model</a></li>
<li class="toctree-l1"><a class="reference internal" href="atoms.html">6. Atoms</a></li>
<li class="toctree-l1"><a class="reference internal" href="feff/index.html">7. Feff</a></li>
<li class="toctree-l1"><a class="reference internal" href="paths/index.html">8. Scattering paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="gds.html">9. Guess/Def/Set Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="fit/index.html">10. Fitting EXAFS data</a></li>
<li class="toctree-l1"><a class="reference internal" href="perl.html">11. Using perl to structure a fit</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">12. Local guess parameters and the characteristic value</a></li>
</ul>
<h3>Helpful Links</h3>
<p>Current version: <b>0.9.24</b></p>

<ul>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/">Demeter homepage</a>
  <li>&nbsp; &nbsp; <a href="https://github.com/bruceravel/demeter/">Demeter @ github</a>
  <li>&nbsp; &nbsp; <a href="https://github.com/newville/ifeffit">Ifeffit</a>
  <li>&nbsp; &nbsp; <a href="http://xraypy.github.io/xraylarch/">Larch</a>
  <li>&nbsp; &nbsp; <a href="http://xafs.org/">xafs.org</a>
</ul>
<ul>
  <li>&nbsp; &nbsp; <a href="http://cars9.uchicago.edu/mailman/listinfo/ifeffit/">Ifeffit mailing list</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.com/demeter/pods/bugs.pod.html">Bug reporting hints</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.com/demeter/pods/help.pod.html">How to ask a good question</a>
</ul>
<p>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/lgcv.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="perl.html" title="11. Using perl to structure a fit"
             >previous</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">Demeter Programming Guide 0.9.24 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Bruce Ravel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
  </body>
</html>