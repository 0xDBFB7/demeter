<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.3. Spline clamps and k-weight in background removal &#8212; Athena 0.9.26 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.26',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/wheat.ico"/>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.4. Spline range in background removal" href="range.html" />
    <link rel="prev" title="4.2. The AUTOBK Algorithm and the Rbkg Parameter" href="rbkg.html" />

    <link rel="stylesheet" type="text/css" href="../_static/demeter.css" />
    <link rel="stylesheet" type="text/css" href="../_static/keys.css" />
    <link rel="stylesheet" type="text/css" href="../_static/program.css" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="range.html" title="4.4. Spline range in background removal"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="rbkg.html" title="4.2. The AUTOBK Algorithm and the Rbkg Parameter"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Athena 0.9.26 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. Normalization and background removal</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="spline-clamps-and-k-weight-in-background-removal">
<span id="clamps-sec"></span><h1>4.3. Spline clamps and k-weight in background removal<a class="headerlink" href="#spline-clamps-and-k-weight-in-background-removal" title="Permalink to this headline">¶</a></h1>
<div class="section" id="spline-clamps">
<h2>4.3.1. Spline clamps<a class="headerlink" href="#spline-clamps" title="Permalink to this headline">¶</a></h2>
<p>One of the shortcomings of the use of piece-wise splines to approximate
the background function is that the ends of spline are somewhat
ill-defined by virtue of not having more data preceding or following. At
times, this can result in the end of the spline splaying up or down,
away from the μ(E) data. This results in significant distortion to χ(k)
data.</p>
<p><font size=-1 color="#8C4112">IFEFFIT</font> provides a tool called <em>spline clamps</em>. These work
by adding an additional term to the χ<sup>2</sup> metric used to fit
the spline to the μ(E) data. The difference between the spline and
the data is computed for the first and last five data points. This sum
of differences computed in energy is multiplied by a user-chosen
scaling factor and added to the χ<sup>2</sup>  computed from the R-range
below <tt><font color="#387A38">«rbkg»</font></tt>. This has the effect of “clamping” the
spline to the ends of the data range. In other words, we use the prior
knowledge that μ<sub>0</sub>(E) is a smooth function through the
oscillatory structure of μ(E) to put a restraint on the fit used
to determine μ<sub>0</sub>(E).</p>
<p>The user-selected multiplicative coefficient takes one of six
predefined values: <span class="guilabel">none</span>, <span class="guilabel">slight</span>,
<span class="guilabel">weak</span>, <span class="guilabel">medium</span>, <span class="guilabel">strong</span>, or
<span class="guilabel">rigid</span>. These have values of 0, 3, 6, 12, 24, and 96,
respectively and serve to set the strength of the clamp in the
evaluation of χ<sup>2</sup>.</p>
<div class="figure compound align-center" id="_fig-clamp">
<div style="width: 45%" class="subfigure" id="id1">
<span id="fig-clamp-mu"></span><a class="reference external image-reference" href="../_images/clamp_mu.png"><img alt="../_images/clamp_mu.png" src="../_images/clamp_mu.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 4.21 </span><span class="caption-text">EuTiO<sub>3</sub> Ti K-edge data with the background subtracted using
a <tt><font color="#387A38">«kweight»</font></tt> of 1 and a high-end spline clamp of
<span class="guilabel">none</span>. Note that the end of the spline deviates
significantly from the end of the data.</span></p>
</div>
<div style="width: 45%" class="subfigure" id="id2">
<span id="fig-clamp-chi"></span><a class="reference external image-reference" href="../_images/clamp_chi.png"><img alt="../_images/clamp_chi.png" src="../_images/clamp_chi.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 4.22 </span><span class="caption-text">Comparing the effects of different values of the high-end spline
clamp on the EuTiO<sub>3</sub> data with all other parameters
equal. The data using the <span class="guilabel">rigid</span> clamp show the most
physically reasonable behavior at the end of the data range.</span></p>
</div>
</div><p id="_fig-clamp">The default value of the clamp is <span class="guilabel">none</span> at the low end of the energy
range and <span class="guilabel">strong</span> at the high end. Clamps tend not to help at the low
energy end of the data. Since the μ(E) data is changing so quickly near
the edge, biasing the spline to follow the data closely rarely helps
improve the quality of the χ(k) data. A strong clamp at the high energy
frequently improves the behavior of the spline near the end of the data.</p>
<p>The behavior of the clamping mechanism can be configured using the
<a class="reference external" href="../other/prefs.html">preference tool</a>. The
<font color="#636A24">♦Bkg→nclamp</font> preference changes the number of points at
the end of the data range included in the calculation of the effect of
the clamp. The <font color="#636A24">♦Bkg→clamp1</font> and <font color="#636A24">♦Bkg→clamp2</font>
parameters set the strengths of the two clamps. The strengths of the
clamps can be fine tuned by changing the numeric values. The parameter
<font color="#636A24">♦Clamp→weak</font> sets the the weak clamp value, and so on.</p>
</div>
<div class="section" id="the-effect-of-k-weight-on-background-removal">
<h2>4.3.2. The effect of k-weight on background removal<a class="headerlink" href="#the-effect-of-k-weight-on-background-removal" title="Permalink to this headline">¶</a></h2>
<p>The background removal section has its own <tt><font color="#387A38">«kweight»</font></tt> parameter which is
distinct from the k-weight used for <a class="reference external" href="../ui/kweight.html">plotting and Fourier
transforms</a>. The background removal <tt><font color="#387A38">«kweight»</font></tt> is
the value used to evaluate the Fourier transform performed to determine
the background spline. By varying the value of this <tt><font color="#387A38">«kweight»</font></tt>, you can
emphasize the lower or upper end of the data in the determination of the
background.</p>
<p>For clean data with oscillatory structure at high energy that is small
but observable, you may find that a larger value of the background
removal <tt><font color="#387A38">«kweight»</font></tt> produces a better χ(k) spectrum. In fact, setting
this parameter to 2 or 3 can have a similar impact on the data as the
highest value of the spline clamp shown in the image above.</p>
<p>However, in data which are quite noisy, amplifying the noise by a
large value of <tt><font color="#387A38">«kweight»</font></tt> can have a dramatic effect leading to a very
poor evaluation of μ<sub>0</sub>(E). Indeed, the μ<sub>0</sub>(E)
evaluated from noisy data with a large value of <tt><font color="#387A38">«kweight»</font></tt> will
sometimes oscillate wildly, as shown in the example below.</p>
<div class="figure align-center" id="id3">
<span id="fig-bkgbadkw"></span><a class="reference external image-reference" href="../_images/bkg_badkw.png"><img alt="../_images/bkg_badkw.png" src="../_images/bkg_badkw.png" /></a>
<p class="caption"><span class="caption-number">Fig. 4.23 </span><span class="caption-text">Noisy data with μ<sub>0</sub>(E) computed using the default
<tt><font color="#387A38">«kweight»</font></tt> of 2. With a <tt><font color="#387A38">«kweight»</font></tt> of 1, the
data are still noisy (of course!)  but the background function
properly follows the data.</span></p>
</div>
</div>
<div class="section" id="the-interaction-between-spline-clamps-and-k-weight">
<h2>4.3.3. The interaction between spline clamps and k-weight<a class="headerlink" href="#the-interaction-between-spline-clamps-and-k-weight" title="Permalink to this headline">¶</a></h2>
<p>The spline clamp and <tt><font color="#387A38">«kweight»</font></tt> parameters sometimes interact strongly.
The criterion that μ<sub>0</sub>(E) follow closely to the end of the data that is
imposed by the spline clamp can have a surprising effect on noisy,
heavily k-weighted data. This is what happened in the data shown in the
previous section. Reducing the strength of the spline clamp can
sometimes help.</p>
<div class="figure align-center" id="id4">
<span id="fig-bkg-badkw-clamp0"></span><a class="reference external image-reference" href="../_images/bkg_badkw_clamp0.png"><img alt="../_images/bkg_badkw_clamp0.png" src="../_images/bkg_badkw_clamp0.png" /></a>
<p class="caption"><span class="caption-number">Fig. 4.24 </span><span class="caption-text">The same noisy data as in the last figure, also with a background
<tt><font color="#387A38">«kweight»</font></tt> of 2. However, this time the high-end spline clamp was
set to <cite>none</cite>.</span></p>
</div>
<p>Sometimes your data are well served by a low <tt><font color="#387A38">«kweight»</font></tt> and a strong
spline clamp. Other times, a large <tt><font color="#387A38">«kweight»</font></tt> and a weak clamp work
better. Still other times, a strong <tt><font color="#387A38">«kweight»</font></tt> <em>and</em> a strong clamp work
best. How do you know what to do? There are no hard and fast rules,
although you will develop an intuition for how different data will
respond to different parameter values. Don't be shy about trying
different combinations.</p>

<br>

<br>
<hr class="docutils" />
<p><font size=-1 color="#8C4112">DEMETER</font> is copyright © 2009-2016 Bruce Ravel – This document is
copyright © 2016 Bruce Ravel</p>
<p>This document is licensed under <a class="reference external" href="https://creativecommons.org/licenses/by-sa/3.0/">The Creative Commons Attribution-ShareAlike License</a>.</p>
<p>If <font size=-1 color="#8C4112">DEMETER</font> and this document are useful to you, please
consider <a class="reference external" href="https://creativecommons.org/donate/">supporting The Creative Commons</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/pallas_athene_thumb.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../forward.html">1. Forward</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">2. Introduction to ATHENA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../import/index.html">3. Data import</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. Normalization and background removal</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="norm.html">4.1. Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="rbkg.html">4.2. The AUTOBK Algorithm and the Rbkg Parameter</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.3. Spline clamps and k-weight in background removal</a></li>
<li class="toctree-l2"><a class="reference internal" href="range.html">4.4. Spline range in background removal</a></li>
<li class="toctree-l2"><a class="reference internal" href="ednorm.html">4.5. Energy-dependent normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="short.html">4.6. Data measured over a very short energy range</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plot/index.html">5. Plotting Your Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui/index.html">6. User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../params/index.html">7. Setting parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output/index.html">8. Data export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">9. Data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis/index.html">10. Data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/index.html">11. Other main window chores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">12. Worked examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hephaestus.html">13. Hephaestus</a></li>
</ul>
<h3>Helpful Links</h3>
<p>Current Demeter version: <b>0.9.26</b></p>

<ul>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/">Demeter homepage</a>
  <li>&nbsp; &nbsp; <a href="https://github.com/bruceravel/demeter/">Demeter @ github</a>
  <li>&nbsp; &nbsp; <a href="http://cars9.uchicago.edu/mailman/listinfo/ifeffit/">Ifeffit mailing list</a>
  <li>&nbsp; &nbsp; <a href="http://xraypy.github.io/xraylarch/">Larch homepage</a>
  <li>&nbsp; &nbsp; <a href="https://github.com/newville/ifeffit">Ifeffit @ github</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/XAS-Education/">Bruce's XAS Education page</a>
  <li>&nbsp; &nbsp; <a href="http://xafs.org/">xafs.org</a>
</ul>
<ul>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/Athena/index.html">Athena manual</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/Artemis/index.html">Artemis manual</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/SinglePage/bugs.html">Bug reporting hints</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/SinglePage/help.html">How to ask a good question</a>
</ul>
<p>
<h3>Translations</h3>
<ul>
  <li>&nbsp; &nbsp; <a href="http://www.moleng.kyoto-u.ac.jp/~moleng_04/asakura/ja/others/aug/index.html">日本語 (Japanese)</a>
</ul>
<p>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/bkg/kweight.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="range.html" title="4.4. Spline range in background removal"
             >next</a></li>
        <li class="right" >
          <a href="rbkg.html" title="4.2. The AUTOBK Algorithm and the Rbkg Parameter"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Athena 0.9.26 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. Normalization and background removal</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Bruce Ravel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>