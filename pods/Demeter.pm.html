<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
<title>Demeter &mdash; Demeter</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="podstyle.css" type="text/css" />
</head>
<body><div class="box">
  <h1 class="t1">Demeter</h1>
  <table>
    <tr>
      <td class="label">Description</td>
      <td class="cell">Perl tools for X-ray Absorption Spectroscopy</td>
    </tr>
  </table>
</div>
<div class="path">
  <a href="index.html">Demeter</a> &gt; Perl Modules &gt;
  Demeter
</div>
<div>

<a href="src/Demeter.pm">Source</a>

</div>

<div class="pod">


<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#IMPORT">IMPORT</a></li>
  <li><a href="#PRAGMATA">PRAGMATA</a></li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#Main-methods">Main methods</a></li>
      <li><a href="#Convenience-methods">Convenience methods</a></li>
      <li><a href="#Utility-methods-and-common-attribute-accessors">Utility methods and common attribute accessors</a></li>
    </ul>
  </li>
  <li><a href="#CONFIGURATION-AND-ENVIRONMENT">CONFIGURATION AND ENVIRONMENT</a></li>
  <li><a href="#DEPENDENCIES">DEPENDENCIES</a></li>
  <li><a href="#BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Demeter - A comprehensive XAS data analysis system using Feff and Ifeffit or Larch</p>

<h1 id="VERSION">VERSION</h1>

<p>This documentation refers to Demeter version 0.9.26</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>Import Demeter components into your program:</p>

<pre><code>  use Demeter;</code></pre>

<p>This will import all Demeter components into your program. Using Demeter automatically turns on <a href="http://metacpan.org/module/strict">strict</a> and <a href="http://metacpan.org/module/warnings">warnings</a>.</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This module provides an object oriented interface to the EXAFS data analysis capabilities of the popular and powerful Ifeffit package and its successor Larch. Given that the Ifeffit and Larch APIs involve streams of text commands, this package is, at heart, a code generator. Many methods of this package return text. All actual interaction with Ifeffit or Larch is handled through a single method, <code>dispose</code>, which is described below. The internal structure of this package involves accumulating text in a scalar variable through successive calls to the various code generating methods. This text is then disposed to Ifeffit, to Larch, to a file, or elsewhere. The outward looking methods organize all of the complicated interactions of your data with Ifeffit or Larch.</p>

<p>This package is aimed at many targets. It can be the back-end of a graphical data analysis program, providing the glue between the on-screen representation of the fit and the actual command executed by Ifeffit or Larch. It can be used for one-off data analysis chores -- indeed most of the examples that come with the package can be reworked into useful one-off scripts. It can also be the back-end to sophisticated data analysis chores such as high-throughout data processing and analysis or complex physical modeling.</p>

<p>Demeter is a parent class for the objects that are directly manipulated in any real program using Demeter. Each of these objects is implemented using Moose, the amazing meta-object system for Perl. Although Moose adds some overhead at start-up for any application using Demeter, its benefits are legion. See <a href="http://metacpan.org/module/Moose">Moose</a> and <a href="http://moose.iinteractive.com">http://moose.iinteractive.com</a> for more information.</p>

<h1 id="IMPORT">IMPORT</h1>

<p>Subsets of Demeter can be imported to shorten loading time.</p>

<dl>

<dt id="data"><code>:data</code></dt>
<dd>

<p>Import just enough of Demeter to perform data processing chores like those of Athena.</p>

<pre><code>  use Demeter qw(:data)</code></pre>

</dd>
<dt id="analysis"><code>:analysis</code></dt>
<dd>

<p>Import all the data processing chores as well as non-Feff data analysis modules for things like linear combination fitting and peak fitting.</p>

<pre><code>  use Demeter qw(:analysis)</code></pre>

</dd>
<dt id="hephaestus"><code>:hephaestus</code></dt>
<dd>

<p>Import a bare bones set of data processing modules. This will not allow much more than the plotting of mu(E) data.</p>

<pre><code>  use Demeter qw(:hephaestus)</code></pre>

</dd>
<dt id="xes"><code>:xes</code></dt>
<dd>

<p>Import the XES processing and peak fitting modules.</p>

<pre><code>  use Demeter qw(:xes)</code></pre>

</dd>
<dt id="fit"><code>:fit</code></dt>
<dd>

<p>Import everything needed to do data analysis with Feff.</p>

<pre><code>  use Demeter qw(:fit)</code></pre>

</dd>
</dl>

<h1 id="PRAGMATA">PRAGMATA</h1>

<p>Demeter &quot;pragmata&quot; are ways of affecting the run-time behavior of a Demeter program by specfying that behavior at compile-time.</p>

<pre><code>     use Demeter qw(:plotwith=gnuplot)
   or
     use Demeter qw(:ui=screen)
   or
     use Demeter qw(:plotwith=gnuplot :ui=screen)</code></pre>

<dl>

<dt id="p-XX-or-:plotwith-XX"><code>:p=XX</code> or <code>:plotwith=XX</code></dt>
<dd>

<p>Specify the plotting backend. The default is <code>pgplot</code>. The other option is <code>gnuplot</code>. A <code>demeter</code> option will be available soon for generating perl scripts which plot.</p>

<p>This can also be set during run-time using the <code>plot_with</code> method.</p>

</dd>
<dt id="ui-XX"><code>:ui=XX</code></dt>
<dd>

<p>Specify the user interface. Currently the only option is <code>screen</code>. Setting the UI to screen does four things:</p>

<ol>

<li><p>Provides <a href="Demeter/UI/Screen/Interview.pm.html">Demeter::UI::Screen::Interview</a> as a role for the Fit object. This imports the <code>interview</code> method for use with the Fit object, offering a CLI interface to the results of a fit.</p>

</li>
<li><p>Uses <a href="http://metacpan.org/module/Term::Twiddle">Term::Twiddle</a> or <a href="http://metacpan.org/module/Term::Sk">Term::Sk</a> to provide some visual feedback on the screen while something time consuming is happening.</p>

</li>
<li><p>Makes the CLI prompting tool from <a href="Demeter/UI/Screen/Pause.pm.html">Demeter::UI::Screen::Pause</a> available.</p>

</li>
<li><p>Turns on colorization of output using <a href="http://metacpan.org/module/Term::ASCIIColor">Term::ASCIIColor</a>.</p>

</li>
</ol>

<p>The interview method uses <a href="http://metacpan.org/module/Term::ReadLine">Term::ReadLine</a>. This is made into a pragmatic interaction in Demeter in case you want to use <a href="http://metacpan.org/module/Term::ReadLine">Term::ReadLine</a> in some other way in your program. Not importing the interview method by default allows you to avoid this error message from Term::ReadLine when you are using it in some other capacity: <code>Cannot create second readline interface, falling back to dumb.</code></p>

<p>Also <a href="http://metacpan.org/module/Term::Twiddle">Term::Twiddle</a> is not imported until it is needed, allowing this dependeny to be relaxed from a requirement to a suggestion.</p>

<p>Future UI options might include <code>tk</code>, <code>wx</code>, or <code>rpc</code>.</p>

</dd>
<dt id="t-XX-or-:template-XX"><code>:t=XX</code> or <code>:template=XX</code></dt>
<dd>

<p>Specify the template set to use for data processing and fitting chores. See <a href="http://metacpan.org/module/Demeter::templates">Demeter::templates</a>.</p>

<p>These can also be set during run-time using the <code>set_mode</code> method -- see <a href="Demeter/Mode.pm.html">Demeter::Mode</a>.</p>

</dd>
</dl>

<h1 id="METHODS">METHODS</h1>

<p>An object of this class represents a part of the problem of EXAFS data processing and analysis. That component might be data, a path from Feff, a parameter, a fit, or a plot. Moose provides a sane, solid, and consistent way of interacting with these objects.</p>

<p>Not every method shown in the example above is described here. You need to see the subclass documentation for methods specific to those subclasses.</p>

<h2 id="Main-methods">Main methods</h2>

<p>These are the basic methods for constructing objects and accessing their attributes.</p>

<dl>

<dt id="new"><code>new</code></dt>
<dd>

<p>This the constructor method. It builds and initializes new objects.</p>

<pre><code>  use Demeter;
  my $data_object = Demeter::Data -&gt; new;
  my $path_object = Demeter::Path -&gt; new;
  my $gds_object  = Demeter::GDS  -&gt; new;
    ## and so on ...</code></pre>

<p>New can optionally take an array of attributes and values with the same syntax as the <code>set</code> method.</p>

</dd>
<dt id="Clone"><code>Clone</code></dt>
<dd>

<p>This method clones an object, returning the reference to the new object.</p>

<pre><code>  $newobject = $oldobject-&gt;Clone(@new_arguments);</code></pre>

<p>Cloning returns the reference and sets all attributes of the new object to the values for the old object. The optional argument is a reference to a hash of those attributes which you wish to change for the new object. Passing this hash reference is equivalent to cloning the object, then calling the <code>set</code> method on the new object with that hash reference.</p>

<p>Note the capital <code>C</code>, which distinguishes this method from the one provided by the <a href="http://metacpan.org/module/MooseX::Clone">MooseX::Clone</a> role.</p>

</dd>
<dt id="set"><code>set</code></dt>
<dd>

<p>This method sets object attributes. This is a convenience wrapper around the accessors provided by <a href="http://metacpan.org/module/Moose">Moose</a>.</p>

<pre><code>  $data_object -&gt; set(fft_kmin=&gt;3.1, fft_kmax=&gt;12.7);
  $path_object -&gt; set(file=&gt;&#39;feff0123.dat&#39;, s0=&gt;&#39;amp&#39;);
  $gds_object  -&gt; set(Type=&gt;&#39;set&#39;, name=&gt;&#39;foo&#39;, mathexp=&gt;7);</code></pre>

<p>The set method of each subclass behaves slightly differently for each subclass in the sense that error checking is performed appropriately for each subclass. Each subclass takes a hash reference as its argument, as shown above. An exception is thrown is you attempt to <code>set</code> an undefined attribute for every subclass except for the Config subclass.</p>

<p>The argument are simply a list (remember that the =&gt; symbol is sytactically equivalent to a comma in this context). The following are equivalent:</p>

<pre><code>    $data_object -&gt; set(file =&gt; &quot;my.data&quot;, kmin =&gt; 2.5);
  and
    @atts = (file =&gt; &quot;my.data&quot;, kmin =&gt; 2.5);
    $data_object -&gt; set(@atts);</code></pre>

<p>The sense in which this is a convenience wrapper is that the following are equivalent:</p>

<pre><code>    $data_object -&gt; set(fft_kmin=&gt;3.1, fft_kmax=&gt;12.7);
  and
    $data_object -&gt; fft_kmin(3.1);
    $data_object -&gt; fft_kmax(12.7);</code></pre>

<p>The latter two lines use the accessors auto-generated by Moose. With Moose, accessors to attributes have names that are the same as the attributes. The <code>set</code> method simply loops over its arguments, calling the appropriate accessor.</p>

</dd>
<dt id="get"><code>get</code></dt>
<dd>

<p>This is the accessor method. It &quot;does the right thing&quot; in both scalar and list context.</p>

<pre><code>  $kmin = $data_object -&gt; get(&#39;fft_kmin&#39;);
  @window_params = $data_object -&gt; get(qw(fft_kmin fft_kmax fft_dk fft_kwindow));</code></pre>

<p>See the documentation for each subclass for complete lists of what attributes are available for each subclass. An exception is thrown if you attempt to <code>get</code> an undefined attribute for all subclasses except for the Config subclass, which is specifically intended to store user-defined parameters.</p>

</dd>
<dt id="serialize"><code>serialize</code></dt>
<dd>

<p>Write the serialization of an object to a file. <code>freeze</code> is an alias for <code>serialize</code>. More complex objects override this method. For instance, see the Fit objects serialize method for complete details of serialization of a fitting model.</p>

<pre><code>  $object -&gt; freeze(&#39;save.yaml&#39;);</code></pre>

</dd>
<dt id="serialization"><code>serialization</code></dt>
<dd>

<p>Returns the YAML serialization string for the object as text.</p>

</dd>
<dt id="matches"><code>matches</code></dt>
<dd>

<p>This is a generalized way of testing to see if an attribute value matches a regular expression. By default it tries to match the supplied regular expression against the <code>name</code> attribute.</p>

<pre><code>  $is_match = $object-&gt;matches($regexp);</code></pre>

<p>You can supply a second argument to match against some other attribute. For instance, to match the <code>group</code> attribute against a regular expression:</p>

<pre><code>  $group_matches = $object-&gt;matches($regexp, &#39;group&#39;);</code></pre>

</dd>
<dt id="template-dispose-dispatch-chart"><code>template</code>, <code>dispose</code>, <code>dispatch</code>, <code>chart</code></dt>
<dd>

<p>These methods generate data processing and plotting commands and send them off to their eventual destinations. See the document page for <a href="Demeter/Dispose.pm.html">Demeter::Dispose</a> for complete details.</p>

</dd>
<dt id="set_mode"><code>set_mode</code></dt>
<dd>

<p>This is the method used to set the attributes described in <a href="Demeter/Dispose.pm.html">Demeter::Dispose</a>. Any Demeter object can call this method.</p>

<pre><code>   $object -&gt; set_mode(backend =&gt; 1,
                       screen  =&gt; 1,
                       buffer  =&gt; \@buffer_array
                      );</code></pre>

</dd>
<dt id="get_mode"><code>get_mode</code></dt>
<dd>

<p>When called with no arguments, this method returns a hash of all attributes their values. When called with an argument (which must be one of the attributes), it returns the value of that attribute. Any Demeter object can call this method.</p>

<pre><code>   %hash = $object -&gt; get_mode;
   $value = $object -&gt; get_mode(&quot;screen&quot;);</code></pre>

<p>See <a href="Demeter:Dispose">Demeter:Dispose</a> for more details.</p>

</dd>
</dl>

<h2 id="Convenience-methods">Convenience methods</h2>

<dl>

<dt id="co-config"><code>co</code>, <code>config</code></dt>
<dd>

<p>This returns the Config object. This is a wrapper around <code>get_mode</code> and is intended to be used in a method call chain with any Demeter object. The following are equivalent:</p>

<pre><code>  my $config = Demeter-&gt;get_mode(&quot;params&quot;);
  $config -&gt; set_default(&quot;clamp&quot;, &quot;medium&quot;, 20);</code></pre>

<p>and</p>

<pre><code>  Demeter -&gt; co -&gt; set_default(&quot;clamp&quot;, &quot;medium&quot;, 20);</code></pre>

<p>The latter involves much less typing!</p>

</dd>
<dt id="po-plot_object"><code>po</code>, <code>plot_object</code></dt>
<dd>

<p>This returns the Plot object. Like the <code>co</code> method, this is a wrapper around <code>get_mode</code> and is intended to be used in a method call chain with any Demeter object.</p>

<pre><code>  Demeter -&gt; po -&gt; set(&quot;c9&quot;, &#39;yellowchiffon3&#39;);</code></pre>

</dd>
<dt id="mo-mode_object"><code>mo</code>, <code>mode_object</code></dt>
<dd>

<p>This returns the Mode object. This is intended to be used in a method call chain with any Demeter object.</p>

<pre><code>  print &quot;on screen!&quot; if (Demeter -&gt; mo -&gt; ui eq &#39;screen&#39;);</code></pre>

</dd>
<dt id="dd-data_default"><code>dd</code>, <code>data_default</code></dt>
<dd>

<p>This returns the default Data object. When a Path object is created, if it is created without having its <code>data</code> attribute set to an existing Data object, a new Data object with sensible default values for all of its attributs is created and stored as the <code>datadefault</code> attribute of the Mode object.</p>

<p>Path objects always rely on their associated Data objects for plotting and processing parameters. So every Path object <b>must</b> have an associated Data object. If the <code>data</code> attribute is not specified by the user, the default Data object will be used.</p>

<pre><code>  print ref(Demeter-&gt;dd);
       ===prints===&gt; Demeter::Data</code></pre>

</dd>
<dt id="fd-feff_default"><code>fd</code>, <code>feff_default</code></dt>
<dd>

<p>This returns the default Feff object.</p>

</dd>
</dl>

<h2 id="Utility-methods-and-common-attribute-accessors">Utility methods and common attribute accessors</h2>

<p>Here are a number of methods used internally, but which are available for your use.</p>

<dl>

<dt id="hashes"><code>hashes</code></dt>
<dd>

<p>This returns a string which can be used as a comment character in Ifeffit or Larch. The idea is that every comment included in the commands generated by methods of this class use this string. That provides a way of distinguishing comments generated by the methods of this class from other comment lines sent to Ifeffit or Larch. This is a user interface convenience.</p>

<pre><code>   print $object-&gt;hashes, &quot;\n&quot;;
       ===prints===&gt; ###___</code></pre>

</dd>
<dt id="group"><code>group</code></dt>
<dd>

<p>This returns a unique five-character string for the object. For Data and Path objects, this is used as the Ifeffit or Larch group name for this object.</p>

</dd>
<dt id="name"><code>name</code></dt>
<dd>

<p>This returns a short, user-supplied, string identifying the object. For a GDS object, this is the parameter name. For Data, Path, Path-like objects, and other plottable objects this is the string that will be put in a plot legend.</p>

</dd>
<dt id="data1"><code>data</code></dt>
<dd>

<p>Path and Path-like objects are associated with Data objects for chores like Fourier transforming. That is, the Path or Path-like object will use the processing parameters of the associated Data object. This method returns the reference to the associated Data object. For Data objects, this returns a reference to itself. For other object types this returns a false value.</p>

</dd>
<dt id="plottable"><code>plottable</code></dt>
<dd>

<p>This returns a true value if the object is one that can be plotted. Currently, Data, Path, the various Path-like objects, and objects associated with various analysis chores (peak fitting, difference spectra, etc) return a true value. All others return false.</p>

<pre><code>   $can_plot = $object -&gt; plottable;</code></pre>

</dd>
<dt id="sentinal"><code>sentinal</code></dt>
<dd>

<p>This attribute is inherited by all Demeter objects and provides a completely generic way for interactivity to be built into any process that a Demeter program undertakes. It is used, for example, in the <a href="Demeter/LCF.pm.html">Demeter::LCF</a> <code>combi</code> method and in several of the histogram processing methods. This attribute takes a code reference. At the beginning of each fit in the combinatorial sequence, this is dereference and called. This allows a GUI to provide status updates during a potentially long-running process and in a manner that does not require Demeter to know what kind of UI is in use.</p>

<p>The dereferencing and calling of the sentinal is handled by <code>call</code></p>

<pre><code>  $object -&gt; call_sentinal;</code></pre>

</dd>
</dl>

<p>Demeter provides a generic mechanism for reporting on errors in a fitting model. When using Demeter non-interactively, useful messages about problems in the fitting model will be written to standard output. Critical problems in a non-interactive mode will be cause the script to croak (see <a href="http://metacpan.org/module/Carp">Carp</a>).</p>

<p>In an interactive mode (such as with the Wx interface), the <code>add_trouble</code> method is used to fill the <code>trouble</code> attribute, which is inherited by all Demeter objects. In the default, untroubled state, an object will have the <code>trouble</code> attribute set to an empty string (i.e. something logically false). As problems are found in the fitting model (see <a href="Demeter/Fit/Sanity.pm.html">Demeter::Fit::Sanity</a>), the <code>trouble</code> attribute gets short text strings appended to it. The list of problems an object has are separated by pipe characters (<code>|</code>).</p>

<p>See <a href="Demeter/Fit/Sanity.pm.html">Demeter::Fit::Sanity</a> for a complete description of these problem codes. The Fit, Data, Path, and GDS objects each have their own set of problem codes.</p>

<h1 id="CONFIGURATION-AND-ENVIRONMENT">CONFIGURATION AND ENVIRONMENT</h1>

<p>See <a href="Demeter/Config.pm.html">Demeter::Config</a> for details about the configuration system.</p>

<h1 id="DEPENDENCIES">DEPENDENCIES</h1>

<p>The dependencies of the Demeter system are in the <i>Build.PL</i> file.</p>

<h1 id="BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</h1>

<ul>

<li><p>Template evaluation is a potential security hole in the sense that someone could put something like <code>{system &#39;rm -rf *&#39;}</code> in one of the templates. <a href="http://metacpan.org/module/Text::Template">Text::Template</a> supports using a <a href="http://metacpan.org/module/Safe">Safe</a> compartment.</p>

</li>
<li><p>Serialization is incompletely implemented at this time.</p>

</li>
</ul>

<p>Please report problems to the Ifeffit Mailing List (<a href="http://cars9.uchicago.edu/mailman/listinfo/ifeffit/">http://cars9.uchicago.edu/mailman/listinfo/ifeffit/</a>)</p>

<p>Patches are welcome.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Bruce Ravel (<a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a>)</p>

<p><a href="http://bruceravel.github.io/demeter/">http://bruceravel.github.io/demeter/</a></p>

<h1 id="LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</h1>

<p>Copyright (c) 2006-2018 Bruce Ravel (<a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a>). All rights reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See <a href="http://metacpan.org/module/perlgpl">perlgpl</a>.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

</div><div class="footer">generated by <a href="http://metacpan.org/module/Pod::ProjectDocs">Pod::ProjectDocs</a></div></body></html>

