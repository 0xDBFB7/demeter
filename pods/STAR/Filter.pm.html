<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>STAR::Filter</title>
<link rel="stylesheet" type="text/css" href="../podstyle.css" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <script type="text/javascript">

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;

    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  </script></head>
<body>
<div class="box">
  <h1 class="t1">Demeter</h1>
  <table>
    <tr>
      <td class="label">Description</td>
      <td class="cell">Perl tools for X-ray Absorption Spectroscopy</td>
    </tr>
  </table>
</div>
<div class="path">
  <a href="../index.html">Demeter</a> &gt; Perl Modules &gt;
  STAR-Filter
</div>
<div>
<a href="../src/STAR/Filter.pm">Source</a>
</div>


<div class="pod">
<!-- INDEX START -->
<h3 id="TOP">Index</h3>
<ul>
	<li><a href="#NAME">NAME</a><br />
<ul>
	<li><a href="#Version">Version</a></li>
</ul>
</li>
	<li><a href="#SYNOPSIS">SYNOPSIS</a></li>
	<li><a href="#DESCRIPTION">DESCRIPTION</a></li>
	<li><a href="#CLASS_METHODS">CLASS METHODS</a><br />
<ul>
	<li><a href="#filter_dict">filter_dict</a></li>
	<li><a href="#filter_through_dict">filter_through_dict</a></li>
</ul>
</li>
	<li><a href="#AUTHOR">AUTHOR</a><br />
<ul>
	<li><a href="#Acknowledgments">Acknowledgments</a></li>
</ul>
</li>
	<li><a href="#COPYRIGHT">COPYRIGHT</a></li>
	<li><a href="#SEE_ALSO">SEE ALSO</a></li>
</ul>
<hr />
<!-- INDEX END -->

<h1 id="NAME">NAME <a href="#TOP" class="toplink"><img alt="^" src="../up.gif" /></a></h1>

<p>STAR::Filter - Perl extension for filtering DataBlock objects</p>

<h2 id="Version">Version</h2>

<p>This documentation refers to version 0.01 of this module.</p>

<h1 id="SYNOPSIS">SYNOPSIS <a href="#TOP" class="toplink"><img alt="^" src="../up.gif" /></a></h1>

<pre>  use STAR::Filter;

</pre><h1 id="DESCRIPTION">DESCRIPTION <a href="#TOP" class="toplink"><img alt="^" src="../up.gif" /></a></h1>

<p>Contains the filter object for filtering DataBlock objects.
DataBlock objects are created by Parser and modified by DataBlock.</p>

<h1 id="CLASS_METHODS">CLASS METHODS <a href="#TOP" class="toplink"><img alt="^" src="../up.gif" /></a></h1>

<h2 id="filter_dict">filter_dict</h2>

<p><a href="#" onclick="toggleCode('method_filter_dict');return false;">[Source]</a></p>
                                        <div class="method-source-code" id="method_filter_dict">
                                        <pre>

sub filter_dict {

    my ($self, @parameters) = @_;
    my ($dict, $dict_filtered, $options);

    while ($_ = shift @parameters) {
        $dict = shift @parameters if /-dict/;
        $options = shift @parameters if /-options/;
    }

    my ($d, $s, $c, $i); #data, save, category, item
    my (@saves, $save);
    my ( %keep_cat_lookup, $incl );

    $dict_filtered = STAR::Dictionary->new;

    $dict_filtered->{TITLE} = ($dict->{TITLE})."_filtered";
    $dict_filtered->{TYPE} = $dict->{TYPE};
    $dict_filtered->{FILE} = $dict->{FILE};
    $dict_filtered->{STARTLN} = $dict->{STARTLN};
    $dict_filtered->{ENDLN} = $dict->{ENDLN};

    print $dict->get_attributes;

    #build up keep_cat_lookup
    foreach $d ( keys %{$dict->{DATA}} ) {
        foreach $s ( sort keys %{$dict->{DATA}{$d}} ) {
            if ( $s eq "-" ) {  #dictionary itself (no save block)
                $keep_cat_lookup{lc($s)} = $s;
            }
            elsif ( $s !~ /\./ ) {  #it's a category, not an item
                print "Category $s -- include? (y/n)";
                $incl = <STDIN>;
                chomp $incl;
                if ( $incl =~ /y/ ) {
                    $keep_cat_lookup{lc($s)} = $s;   #hash lookup 
                                                     #lower case => original
                }  
            }
        }
    }

    #filter dictionary according to keep_cat_lookup hash
    foreach $d ( keys %{$dict->{DATA}} ) {  
        foreach $s ( keys %{$dict->{DATA}{$d}} ) {

            if ( $s !~ /\./ && $keep_cat_lookup{lc($s)} ) {
            #save block that's a category to be included

                foreach $c ( keys %{$dict->{DATA}{$d}{$s}} ) {
                    foreach $i ( keys %{$dict->{DATA}{$d}{$s}{$c}} ) {
                            $dict_filtered->{DATA}{$d}{$s}{$c}{$i} =
                            $dict->{DATA}{$d}{$s}{$c}{$i};
                    }
                }
            }

            if ( $s =~ /^_(\S+)\./ && $keep_cat_lookup{lc($1)} ) {
            #save block that's an item in a category to be included

                foreach $c ( keys %{$dict->{DATA}{$d}{$s}} ) {
                    foreach $i ( keys %{$dict->{DATA}{$d}{$s}{$c}} ) {
                            $dict_filtered->{DATA}{$d}{$s}{$c}{$i} =
                            $dict->{DATA}{$d}{$s}{$c}{$i};
                    }
                }
            }
        }
        $dict_filtered->{DATA}{$d}{"-"}{"_dictionary"}
                        {"_dictionary.version"}[0]
          .= "_filtered";
    }

    return $dict_filtered;
}
</pre></div>

<pre>  Usage:  $filtered_dict = STAR::Filter-&gt;filter_dict(
                             -dict=&gt;$dict,
                             -options=&gt;$options);

</pre><p>A (very simplistic) interactive method for filtering a STAR::Dictionary 
object (.cob file). The user is prompted for each category whether 
to include (retain) it in the filtered object. The method returns a 
reference to the filtered (reduced) STAR::Dictionary object.</p>

<p>Note: This method is preliminary and subject to change.</p>

<h2 id="filter_through_dict">filter_through_dict</h2>

<p><a href="#" onclick="toggleCode('method_filter_through_dict');return false;">[Source]</a></p>
                                        <div class="method-source-code" id="method_filter_through_dict">
                                        <pre>

sub filter_through_dict {

    my ($self,@parameters) = @_;
    my ($data, $out, $dict, $options);

    while ($_ = shift @parameters) {
       $data = shift @parameters if /-data/;
       $dict = shift @parameters if /-dict/;
       $options = shift @parameters if /-options/;
    }

    my ($d,$s,$c,$i);  # data, save, category, item
    my (@items);
    my ($dict_item, @dict_items, %dict_lookup);

    @items = $data ->get_items;
    @dict_items = $dict->get_save_blocks;

    foreach $dict_item (@dict_items) {
        $dict_lookup{lc($dict_item)} = $dict_item;
    }

    $out = STAR::DataBlock->new;

    $out->{TITLE} = $data->{TITLE};
    $out->{TYPE} = $data->{TYPE};
    $out->{FILE} = $data->{FILE};
    $out->{STARTLN} = $data->{STARTLN};
    $out->{ENDLN} = $data->{ENDLN};

    foreach $d ( keys %{$data->{DATA}} ) {  
        foreach $s ( keys %{$data->{DATA}{$d}} ) {
            foreach $c ( keys %{$data->{DATA}{$d}{$s}} ) {
                foreach $i ( keys %{$data->{DATA}{$d}{$s}{$c}} ) {
                    if ( $dict_lookup{lc($i)} ) {
                        $out ->{DATA}{$d}{$s}{$c}{$i} =
                        $data->{DATA}{$d}{$s}{$c}{$i};
                    }
                }
            }
        }
    }
    return $out;
}
</pre></div>

<pre>  Usage:  $filtered_data = STAR::Filter-&gt;filter_through_dict(
                             -data=&gt;$data,
                             -dict=&gt;$dict,
                             -options=&gt;$options);

</pre><p>Filters an STAR::DataBlock object through a STAR::Dictionary object. 
Returns a reference to a new STAR::DataBlock object in which only 
those items are included which were defined in the specified dictionary.</p>

<h1 id="AUTHOR">AUTHOR <a href="#TOP" class="toplink"><img alt="^" src="../up.gif" /></a></h1>

<p>Wolfgang Bluhm, mail@wbluhm.com</p>

<h2 id="Acknowledgments">Acknowledgments</h2>

<p>Thanks to Phil Bourne, Helge Weissig, Anne Kuller, Doug Greer, 
Michele Bluhm, and others for support, help, and comments.</p>

<h1 id="COPYRIGHT">COPYRIGHT <a href="#TOP" class="toplink"><img alt="^" src="../up.gif" /></a></h1>

<p>A full copyright statement is provided with the distribution
Copyright (c) 2000 University of California, San Diego</p>

<h1 id="SEE_ALSO">SEE ALSO <a href="#TOP" class="toplink"><img alt="^" src="../up.gif" /></a></h1>

<p>STAR::Parser, STAR::DataBlock, STAR::Dictionary.</p>


</div><div class="footer">generated by <a href="https://metacpan.org/pod/Pod%3A%3AProjectDocs">Pod::ProjectDocs</a></div></body>
</html>
