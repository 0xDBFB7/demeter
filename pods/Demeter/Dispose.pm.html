<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
<title>Demeter::Dispose &mdash; Demeter</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="../podstyle.css" type="text/css" />
</head>
<body><div class="box">
  <h1 class="t1">Demeter</h1>
  <table>
    <tr>
      <td class="label">Description</td>
      <td class="cell">Perl tools for X-ray Absorption Spectroscopy</td>
    </tr>
  </table>
</div>
<div class="path">
  <a href="../index.html">Demeter</a> &gt; Perl Modules &gt;
  Demeter::Dispose
</div>
<div>

<a href="../src/Demeter/Dispose.pm">Source</a>

</div>

<div class="pod">


<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a>
    <ul>
      <li><a href="#Reprocessed-commands">Reprocessed commands</a></li>
    </ul>
  </li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#dispose">dispose</a></li>
      <li><a href="#other-methods">other methods</a></li>
    </ul>
  </li>
  <li><a href="#CONFIGURATION">CONFIGURATION</a></li>
  <li><a href="#DEPENDENCIES">DEPENDENCIES</a></li>
  <li><a href="#BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Demeter::Dispose - Process Ifeffit, Larch, and plotting command strings</p>

<h1 id="VERSION">VERSION</h1>

<p>This documentation refers to Demeter version 0.9.26.</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>  my $data_object = Demeter::Data -&gt; new();
  $data_object -&gt; set_mode(backend=&gt;1, buffer=&gt;\@buffer, screen=&gt;1);
  $data_object -&gt; dispose($ifeffit_command);</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This module contains contains the dispose method, which is used to dispatch Ifeffit, Larch, and Gunplot command strings. This is part of the base of all other objects in the Demeter system, thus any object can dispose text.</p>

<p>The command strings which are handled by the <code>dispose</code> method are typically generated using the command templating system, which is described in <a href="../Demeter.pm.html#TEMPLATES">&quot;TEMPLATES&quot; in Demeter</a>.</p>

<h2 id="Reprocessed-commands">Reprocessed commands</h2>

<p>Command strings are typically generated by Demeter in a manner which is designed to be human readable. Unfortunately, human-readable and Ifeffit-efficient tend to be at odds. In the interest of speed and efficiency, Demeter processes Ifeffit commands into a form that is harder for a human to read, but faster for Ifeffit to process.</p>

<p>The main change made to Ifeffit command strings is to concatinate multi-line commands into a single line and to squeeze white space into a single space. This significantly reduces the number of calls to the <code>iff_exec</code> function in Ifeffit, which is one of the most time-consuming parts of the Demeter/Ifeffit stack. Given that Ifeffit allows command strings to be as much as 2048 characters long, it is rare that an command generated by Demeter cannot be handled in this way.</p>

<p>Also, the preprocessed text does not contain any lines that are only whitespace or are entirely commented out.</p>

<h1 id="METHODS">METHODS</h1>

<h2 id="dispose"><code>dispose</code></h2>

<p>This method dispatches command strings to various places. Many methods in the Demeter system are command generators. The intent is that to accumulate text through successive method calls and then dispose of the text using this method. The method takes two arguments, a scalar containing all the text that you have accumulates, and an optional argument that, when true, indicates that the commands are specifically plotting commands.</p>

<p>Demeter is very careful to segregate plotting commands from data processing commands and to dispose of them separately. This allows transparent use of different plotting backends. The <code>backend</code> disposal channel is used to indicate disposal of commands either to ifeffit or to another plotting backend. That is, if you want to dispose of plotting commands to a gnuplot process, you must have the <code>backend</code> disposal channel enabled. <code>ifeffit</code> and <code>larch</code> are aliases for <code>backend</code>.</p>

<p>Use the <code>set_mode</code> class method to establish the disposal channels.</p>

<pre><code>   Demeter-&gt;set_mode(backend=&gt;1, screen=&gt;1, file=&gt;0, buffer=&gt;0);
   $dataobject -&gt; dispose($commands);</code></pre>

<p>When disposing a plotting command, use the plotting flag:</p>

<pre><code>   $dataobject -&gt; dispose($commands, &quot;plotting&quot;);</code></pre>

<p>There are several disposal channels:</p>

<dl>

<dt id="backend-ifeffit-or-larch-are-aliases">backend (ifeffit or larch are aliases)</dt>
<dd>

<p>This channel sends reprocessed command strings to ifeffit for processing. This is a boolean. By default, this channel is on and all the rest are off.</p>

</dd>
<dt id="screen">screen</dt>
<dd>

<p>This channel sends command strings to standard output. This is a boolean. If the UI is set to screen (see <a href="Mode.pm.html">Demeter::Mode</a>) and the <a href="http://metacpan.org/module/Term::ANSIColor">Term::ANSIColor</a> package is installed, then comments in the screen output will be colored red, pink, or yellow depending on the comment character.</p>

<p>The default colors are:</p>

<pre><code>  red           data processing comments
  pink          plotting comments
  yellow        fitting comments
  light blue    feedback from Ifeffit/Larch
  white on red  error messages from Ifeffit/Larch</code></pre>

<p>These colors are configurable in the screen group.</p>

</dd>
<dt id="file">file</dt>
<dd>

<p>This channel writes command strings to a file. If the value of file evaluates false, then this channel is not used. If it is true, the value is taken to be the name of the output file. At this time, IO control is extremely simple. If you want to append command strings to an existing file, simply append <code>&gt;</code> to the beginning of the file name:</p>

<pre><code>   # clobber foo and start a new file by that name
   $dataobject -&gt; set_mode(file=&gt;&quot;foo&quot;);
   $dataobject -&gt; dispose($commands);
   #
   # append to foo
   $dataobject -&gt; set_mode(file=&gt;&quot;&gt;foo&quot;);
   $dataobject -&gt; dispose($commands);</code></pre>

</dd>
<dt id="plotscreen">plotscreen</dt>
<dd>

<p>This behaves exactly like the <code>screen</code> parameter, but applies only to commands disposed using the plotting flag. If the UI is set to screen (see <a href="Mode.pm.html">Demeter::Mode</a>) and the <a href="http://metacpan.org/module/Term::ANSIColor">Term::ANSIColor</a> package is installed, then comments in the screen output will be colored red, pink, or yellow depending on the comment character.</p>

</dd>
<dt id="plotfile">plotfile</dt>
<dd>

<p>This behaves exactly like the <code>file</code> parameter, but applies only to commands disposed using the plotting flag. This allows you to accumulate plotting commands into plotting scripts, which is handy for the gnuplot backend.</p>

</dd>
<dt id="buffer">buffer</dt>
<dd>

<p>This channel pushes each command line onto an in-memory buffer. The buffer can be either a string or an array. The buffer attribute is a reference to the scalar or array.</p>

<p>If a scalar reference is used, the scalar is treated as a string and each command line is concatinated to the end of the string.</p>

<pre><code>   $buffer = q{};
   $dataobject -&gt; set_mode(buffer=&gt;\$buffer);
   $dataobject -&gt; dispose($commands);
   print $buffer;</code></pre>

<p>If an array reference is used, each command line is pushed onto the end of the array.</p>

<pre><code>   @buffer = ();
   $dataobject -&gt; set_mode(buffer=&gt;\@buffer);
   $dataobject -&gt; dispose($commands);
   map {print $_} @buffer;</code></pre>

<p>An obvious improvement to this would be to allow the buffer attribute to be a reference to an arbitrary object which can be used in some domain-specific, user-defined manner.</p>

</dd>
<dt id="plotbuffer">plotbuffer</dt>
<dd>

<p>This is an optional output channel for the plotting commands. If unset, plotting commands go to the same channel as specified by <code>buffer</code>. This channel works identically to <code>buffer</code>, albeit redirected to a different place.</p>

</dd>
<dt id="callback">callback</dt>
<dd>

<p>This channel sends disposed text to a user supplied code reference. For instance, in Artemis, this is a subroutine that prints the disposed lines to the command buffer. This code ref takes a single argument, which is the text to be disposed.</p>

</dd>
<dt id="plotcallback">plotcallback</dt>
<dd>

<p>This optional channel redirects plotting commands to a differnt code reference from <code>callback</code>. If unset, plotting commands are disposed to <code>callback</code>&#39;s code ref.</p>

</dd>
<dt id="feedback">feedback</dt>
<dd>

<p>This channel sends feedback from Ifeffit or Larch to a user supplied code reference. Note that lines indicating a problem in Ifeffit&#39;s or Larch&#39;s output start with a star (*). Information lines start with text.</p>

</dd>
<dt id="repscreen">repscreen</dt>
<dd>

<p>This channel sends reprocessed command strings to standard output. The value of screen in the hash is interpreted as a boolean. The main use of this channel is to debug the text actually sent to Ifeffit. No colorizing is done because comments are stripped from the reprocessed commands.</p>

</dd>
<dt id="repfile">repfile</dt>
<dd>

<p>This channel send reprocessed command strings to a file. This channel is handled in the same manner as the normal file channel. The main use of this channel is to debug the text actually sent to Ifeffit.</p>

</dd>
</dl>

<p>Note that the <code>dispose</code> method is also used to place a copyright statement on every plot. This behavior can be suppressed by setting the <code>plot-&amp;gt;showcopyright</code> configuration parameter to a false value.</p>

<h2 id="other-methods">other methods</h2>

<dl>

<dt id="dispense"><code>dispense</code></dt>
<dd>

<p>This wraps calls to <code>template</code> and <code>dispose</code>. This:</p>

<pre><code>  $self-&gt;dispense(&#39;process&#39;, &#39;deriv&#39;);</code></pre>

<p>is the same as</p>

<pre><code>  $self-&gt;dispose($self-&gt;template(&#39;process&#39;, &#39;deriv&#39;));</code></pre>

<p>which was such a common idiom in Demeter that it merited this method.</p>

</dd>
<dt id="chart"><code>chart</code></dt>
<dd>

<p>This wraps calls to <code>template</code> and to <code>dispose</code> with the <code>plotting</code> argument. This:</p>

<pre><code>  $self-&gt;chart(&#39;process&#39;, &#39;deriv&#39;);</code></pre>

<p>is the same as</p>

<pre><code>  $self-&gt;dispose($self-&gt;template(&#39;process&#39;, &#39;deriv&#39;), &#39;plotting&#39;);</code></pre>

<p>which was such a common idiom in Demeter that it merited this method.</p>

</dd>
<dt id="Reset"><code>Reset</code></dt>
<dd>

<p>This method sends the <code>reset</code> command to ifeffit. The method name is capitalized to avoid confusion with the perl built-in function.</p>

</dd>
<dt id="cursor"><code>cursor</code></dt>
<dd>

<p>This method sends the <code>cursor</code> command to ifeffit with the <code>show</code> and <code>cross-hair</code> arguments. It returns the x and y coordinates of the cursor click.</p>

<pre><code>   my ($xclick, $yclick) = $object-&gt;cursor;</code></pre>

<p>Note that this is a blocking operation. Your program will pause until a click event happens in the plot window.</p>

</dd>
</dl>

<p>For more information about effecting command generation and disposal, see <a href="Mode.pm.html">Demeter::Mode</a>.</p>

<h1 id="CONFIGURATION">CONFIGURATION</h1>

<p>See <a href="Config.pm.html">Demeter::Config</a> for a description of the configuration system.</p>

<h1 id="DEPENDENCIES">DEPENDENCIES</h1>

<p>Demeter&#39;s dependencies are in the <i>Build.PL</i> file.</p>

<h1 id="BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</h1>

<ul>

<li><p>The file and repfile disposal channels is handled in the most primitive manner that remains functional. It may be useful to consider using IO::File or something similar. Further, it is only possible to specify a single file for this channel. Something clever with &quot;tee&quot; can be done to dispatch to multiple files.</p>

</li>
<li><p>The buffer disposal channel currently only works with normal scalars and normal arrays. It would be reasonable for a user to want the buffer to be, say, a tied array or some particular object. That will be dealt with should it ever come up.</p>

</li>
<li><p>The screen, plotscreen, and repscreen disposal channels currently write to STDOUT. The user can direct STDOUT elsewhere. It may be useful to have the option of specifying a filehandle for this channel.</p>

</li>
</ul>

<p>Please report problems to the Ifeffit Mailing List (<a href="http://cars9.uchicago.edu/mailman/listinfo/ifeffit/">http://cars9.uchicago.edu/mailman/listinfo/ifeffit/</a>)</p>

<p>Patches are welcome.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Bruce Ravel, <a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a></p>

<p><a href="http://bruceravel.github.io/demeter/">http://bruceravel.github.io/demeter/</a></p>

<h1 id="LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</h1>

<p>Copyright (c) 2006-2018 Bruce Ravel (<a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a>). All rights reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See <a href="http://metacpan.org/module/perlgpl">perlgpl</a>.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

</div><div class="footer">generated by <a href="http://metacpan.org/module/Pod::ProjectDocs">Pod::ProjectDocs</a></div></body></html>

