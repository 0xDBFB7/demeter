<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
<title>Demeter::Config &mdash; Demeter</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="../podstyle.css" type="text/css" />
</head>
<body><div class="box">
  <h1 class="t1">Demeter</h1>
  <table>
    <tr>
      <td class="label">Description</td>
      <td class="cell">Perl tools for X-ray Absorption Spectroscopy</td>
    </tr>
  </table>
</div>
<div class="path">
  <a href="../index.html">Demeter</a> &gt; Perl Modules &gt;
  Demeter::Config
</div>
<div>

<a href="../src/Demeter/Config.pm">Source</a>

</div>

<div class="pod">


<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#External-methods">External methods</a></li>
      <li><a href="#ini-file-methods">ini file methods</a></li>
      <li><a href="#Internal-methods">Internal methods</a></li>
    </ul>
  </li>
  <li><a href="#PARAMETER-ATTRIBUTES">PARAMETER ATTRIBUTES</a></li>
  <li><a href="#USER-DEFINED-PARAMETERS">USER DEFINED PARAMETERS</a></li>
  <li><a href="#DIAGNOSTICS">DIAGNOSTICS</a></li>
  <li><a href="#DEMETER-CONFIGURATION-FILES">DEMETER CONFIGURATION FILES</a></li>
  <li><a href="#EMACS-MAJOR-MODE">EMACS MAJOR MODE</a></li>
  <li><a href="#DEPENDENCIES">DEPENDENCIES</a></li>
  <li><a href="#BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Demeter::Config - Demeter&#39;s configuration system</p>

<h1 id="VERSION">VERSION</h1>

<p>This documentation refers to Demeter version 0.9.26.</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This subclass of Demeter provides a general way of storing and manipulating parameters of all sorts, including configuration parameters for controlling the behavior of Demeter&#39;s various subsystems, parameters using by Demeter-base applications, and parameters that get passed to the templating subsystem. The <code>$C</code> special templating variable accesses this object.</p>

<p>Demeter uses a two-tiered configuration system. The system-wide tier reads from a configuration file <i>demeter.config</i> which lives in the <i>lib/</i> directory beneath the <i>Demeter.pm</i> module. This configuration file contains complete information about each configuration parameter, including description text and various attributes. The second tier is the user&#39;s initialization file. This uses the standard INI format and the <a href="IniReader.pm.html">Demeter::IniReader</a> module. The user&#39;s file lives in $ENV{HOME} on unix and Mac and in $ENV{USERPROFILE} on Windows.</p>

<p>Defining new parameters to be handled by Config is as simple as entering them into the INI file using normal INI syntax. Those user-created parameters will not possess descriptions or other attributes, however.</p>

<h1 id="METHODS">METHODS</h1>

<p>The normal idiom for accessing method of the Config class is to chain method calls starting with any other Demeter object. Although you can certainly store a reference to the Config object as a scalar, it usually is not necessary to do so.</p>

<p>The <code>co</code> method, inhereted by all other objects from the Demeter base class, returns a reference to the Config object. All of the examples below use the chain idiom and <code>self</code> can be any kind of object.</p>

<h2 id="External-methods">External methods</h2>

<dl>

<dt id="default"><code>default</code></dt>
<dd>

<p>Return the default value for a parameter.</p>

<pre><code>  print &quot;Default fft kmin is &quot;, $object-&gt;co-&gt;default(&quot;fft&quot;, &quot;kmin&quot;), $/;</code></pre>

</dd>
<dt id="set_default"><code>set_default</code></dt>
<dd>

<p>This method is called repeatedly by <code>read_ini</code> to move the information from the user&#39;s ini file into the Config object.</p>

<pre><code>  $object -&gt; co -&gt; set_default(&quot;bkg&quot;, &quot;rbkg&quot;, 1.2);</code></pre>

</dd>
<dt id="describe"><code>describe</code></dt>
<dd>

<p>Return a text description of a parameter.</p>

<pre><code>  print $object -&gt; co -&gt; describe(&quot;bkg&quot;, &quot;kw&quot;);
   == prints ==&gt;
    bkg -&gt; kw
        &quot;The default value for the k-weighting used to fit the background spline.&quot;
      type     : positive integer
      default  : 2
      demeter  : 2
      minint   : 0
      maxint   : 3</code></pre>

<p>There is a third argument that controls the width of the description text, the default being 90 (as set by the <code>operations--&gt;config_text_width</code> parameter).</p>

<pre><code>  print $object -&gt; co -&gt; describe(&quot;bkg&quot;, &quot;kw&quot;, 45);
   == prints ==&gt;
    bkg -&gt; kw
        &quot;The default value for the k-weighting
         used to fit the background spline.&quot;
      type     : positive integer
      default  : 2
      demeter  : 2
      minint   : 0
      maxint   : 3</code></pre>

</dd>
<dt id="groups"><code>groups</code></dt>
<dd>

<p>Return a list of known configuration groups.</p>

<pre><code>  @groups = $object -&gt; co -&gt; groups;</code></pre>

</dd>
<dt id="parameters"><code>parameters</code></dt>
<dd>

<p>Return a list of parameters associated with a specified configuration group.</p>

<pre><code>  @params = $object -&gt; co -&gt; parameters(&#39;bkg&#39;);</code></pre>

</dd>
</dl>

<h2 id="ini-file-methods">ini file methods</h2>

<dl>

<dt id="read_ini"><code>read_ini</code></dt>
<dd>

<p>Read default values from a user&#39;s ini file, overwriting the values read from the system-wide configuration file.</p>

<pre><code>  $object -&gt; co -&gt; read_ini($filename);</code></pre>

</dd>
<dt id="write_ini"><code>write_ini</code></dt>
<dd>

<p>Write an ini file for a user.</p>

<pre><code>  $object -&gt; co -&gt; write_ini($filename);</code></pre>

<p>If the filename is not given, the user&#39;s ini file will be written.</p>

</dd>
</dl>

<h2 id="Internal-methods">Internal methods</h2>

<dl>

<dt id="is_configured"><code>is_configured</code></dt>
<dd>

<p>This method returns true if a Config object has been created and initialized by the <code>read_config</code> method.</p>

</dd>
<dt id="read_config"><code>read_config</code></dt>
<dd>

<p>This method reads the system-wide configuration file, <i>demeter.config</i>, from it location in the <i>Demeter/lib/</i> folder just below the main <i>Demeter.pm</i> module. This loads the entire contents, including default values, parameter descriptions, and parameter attributes, into the Config object.</p>

</dd>
<dt id="set_this_param"><code>set_this_param</code></dt>
<dd>

<p>Use this method to update the default value for a parameter. For example, the <code>read_ini</code> method calls this repeatedly. Note that the original value of each parameter from the <i>demeter.config</i> file always stays in the object as the &quot;demeter&quot; parameter attribute.</p>

<pre><code>   $object-&gt;set_this_param($group, $param, %hash);</code></pre>

<p>where %hash contains the various attributes decribed below.</p>

</dd>
</dl>

<h1 id="PARAMETER-ATTRIBUTES">PARAMETER ATTRIBUTES</h1>

<p>All parameters have these attributes. Each attribute has an associated convenience method of the same name.</p>

<dl>

<dt id="Type">Type</dt>
<dd>

<p>This is one of string, regex, real, &quot;positive integer&quot;, list, boolean, color, or font.</p>

<pre><code>  print $object -&gt; co -&gt; Type(&quot;fft&quot;, &quot;kwindow&quot;)
    ==prints==&gt;
      list</code></pre>

</dd>
<dt id="default1">default</dt>
<dd>

<p>This is the value associated with the parameter. This is overridden by an imported INI file or by the <code>set_default</code> method.</p>

<pre><code>  print $object -&gt; co -&gt; default(&quot;fft&quot;, &quot;kwindow&quot;)
    ==prints==&gt;
      hanning</code></pre>

</dd>
<dt id="windows">windows</dt>
<dd>

<p>This overrides the default, but only on Windows computers.</p>

<p>Strings that take a fully resolved path to an executable are treated specially. If that executable resides beneath the perl installation location, then the installation location should be denoted as <code>__PERL_BASE__</code>. For example, Strawberry perl is typically instaled into <code>C:\strawberry</code>. Rather than denoting the location of the Feff executable as <code>C:\strawberry\c\bin\feff.exe</code>, it should be specified as <code>__PERL_BASE__\c\bin\feff.exe</code>. The <code>__PERL_BASE__</code> tag will be replaced by the correct installation location. Then, if Strawberry is installed into some other location, the Feff executable will be found at runtime.</p>

</dd>
<dt id="demeter">demeter</dt>
<dd>

<p>This is the default value from the configuration file shipped with demeter. This is untouched even when a default is overridden by an imported INI file.</p>

<pre><code>  print $object -&gt; co -&gt; demeter(&quot;fft&quot;, &quot;kwindow&quot;)
    ==prints==&gt;
      hanning</code></pre>

</dd>
<dt id="was">was</dt>
<dd>

<p>This is the previous value of the parameter from before the last time it was changed using the <code>set_default</code> method. If the parameter has not been changed since it was initialized, this method returns 0. The primary use of this method is to aid in post-processing a change in parameter value in a GUI or other application.</p>

<pre><code>  print $object -&gt; co -&gt; demeter(&quot;fft&quot;, &quot;kwindow&quot;)
    ==prints==&gt;
      welch</code></pre>

</dd>
<dt id="description">description</dt>
<dd>

<p>This is a text string explaining the purpose of the parameter.</p>

<pre><code>  print $object -&gt; co -&gt; description(&quot;fft&quot;, &quot;kwindow&quot;)
    ==prints==&gt;
      The default window type to use for the forward Fourier transform.</code></pre>

<p>This can also return the description text of a parameter group.</p>

<pre><code>  print $object -&gt; co -&gt; description(&quot;fft&quot;)
    ==prints==&gt;
      These parameters determine how forward Fourier transforms are done by Demeter.</code></pre>

</dd>
</dl>

<p>Some attributes are specific to a parameter type. Each attribute has an associated convenience method of the same name.</p>

<dl>

<dt id="units">units</dt>
<dd>

<p>This specifies the units of the parameter, if appropriate.</p>

<pre><code>  print $object -&gt; co -&gt; units(&quot;bkg&quot;, &quot;pre1&quot;)
    ==prints==&gt;
      eV (relative to e0 or to the beginning of the data)</code></pre>

</dd>
<dt id="restart">restart</dt>
<dd>

<p>This is true or false depending on whether changing the parameter takes effect immediately or if a restart of the application is required.</p>

</dd>
<dt id="onvalue-offvalue">onvalue/offvalue</dt>
<dd>

<p>These are the values associated with the true and false states of a boolean parameter. If unspecified in the configuration file, they default to 1 and 0.</p>

<pre><code>  print $object -&gt; co -&gt; onvalue(&quot;bkg&quot;, &quot;flatten&quot;)
    ==prints==&gt;
      1</code></pre>

</dd>
<dt id="minint-maxint">minint/maxint</dt>
<dd>

<p>These are the minimum and maximum allowed values of a positive integer parameter. If unspecified in the configuration file, they default to 0 and 1e9.</p>

<pre><code>  print $object -&gt; co -&gt; maxint(&quot;bkg&quot;, &quot;kw&quot;)
    ==prints==&gt;
      3</code></pre>

</dd>
<dt id="options">options</dt>
<dd>

<p>This are the possible options for a list parameter. They are stored as a space-separated string. This string will have to be split on the spaces to be used as a list.</p>

<pre><code>  print $object -&gt; co -&gt; options(&quot;fft&quot;, &quot;kwindow&quot;)
    ==prints==&gt;
      hanning kaiser-bessel welch parzen sine</code></pre>

</dd>
</dl>

<h1 id="USER-DEFINED-PARAMETERS">USER DEFINED PARAMETERS</h1>

<p>The <code>set</code> method creates a user-defined parameter and stores it in the Config object for later use.</p>

<pre><code>    $merged-&gt;set(ndata=&gt;$ndata);</code></pre>

<p>These user-defined parameter are the accessed via <code>get</code> (rather than <code>default</code>)</p>

<pre><code>    print &quot;Number of sets in merge = &quot;, $data-&gt;co-&gt;get(&quot;ndata&quot;);</code></pre>

<p>The reason to use the Config object to store parameters is that they are easily used by the templating system that Demeter uses to do its work. Also, the user-defined parameters will be serialized along with the Config object.</p>

<p>This system is used extensively in the <code>merge</code> method from <a href="Data/Process.pm.html">Demeter::Data::Process</a>. See also the <i>merge_*.tmpl</i> files in the &quot;process&quot; group of templates.</p>

<h1 id="DIAGNOSTICS">DIAGNOSTICS</h1>

<dl>

<dt id="You-cannot-have-more-than-one-Config-object"><code>You cannot have more than one Config object</code></dt>
<dd>

<p>One Config object is created when Demeter loads. It is forbidden to create a second one. Config paramaters are global to an instance of Demeter.</p>

</dd>
<dt id="The-Demeter-configuration-file-config_file-does-not-exist"><code>The Demeter configuration file ($config_file) does not exist</code></dt>
<dd>

<p>The <i>demeter.config</i> file should be installed in the <i>lib/</i> subdirectory beneath the location of the <i>Demeter.pm</i> module. This diagnostic says that configuration file is absent.</p>

</dd>
<dt id="The-Demeter-configuration-file-config_file-cannot-be-opened"><code>The Demeter configuration file ($config_file) cannot be opened</code></dt>
<dd>

<p>The <i>demeter.config</i> file should be installed in the <i>lib/</i> subdirectory beneath the location of the <i>Demeter.pm</i> module. This diagnostic says that configuration file is unreadable, perhaps because of a permissions setting.</p>

</dd>
<dt id="key-is-not-a-valid-configuration-parameter"><code>$key is not a valid configuration parameter</code></dt>
<dd>

<p>This diagnostic says that you have attempted to retrieve an attribute for a parameter that does not exist.</p>

</dd>
</dl>

<h1 id="DEMETER-CONFIGURATION-FILES">DEMETER CONFIGURATION FILES</h1>

<p>The configuration files are broken into a simple hierarchy. Parameter groups tend to be contained in their own files which are included into the master configuration file <i>config.demeter_conf</i>.</p>

<p>The included configuration files are fairly structured. Beginning-of-line whitespace (2 spaces, no more, no less) is important in the parameter descriptions, as are the empty lines and the lines that begin with a dot. The empty lines denote separations between entries. The dots are used to build lists in the descriptions.</p>

<p>The parser for this file is fairly stupid, so if you make mistakes in the use of whitespace, bad things will happen. An <a href="#EMACS-MAJOR-MODE">&quot;EMACS MAJOR MODE&quot;</a> is provided, the main purpose of which is to color text as an indication of correct formatting. Also, order matters. It is very important that &quot;variable=&quot; comes first, then &quot;type=&quot;, then &quot;default=&quot;, then the rest.</p>

<p>The contents of the configuration files are used to populate the Config object and to generate the files system-wide <i>demeter.ini</i>. It can also be used to populate the preferences dialog in a GUI. Here is a list of suggested widgets to use with each configuration type</p>

<pre><code>   variable types         suggested widget
     string                TextCtrl
     regex                 TextCtrl
     real                  TextCtrl -- validates to accept only numbers
     positive integer      SpinCtrl -- restricted to be &gt;= 0
     list                  Choice or some other multiple selection widget
     boolean               Checkbutton
     keypress              TextCtrl -- rigged to display one character at a time
     color                 ColorPicker -- launches color browser
     font                  FontPicker -- does nothing at this time</code></pre>

<h1 id="EMACS-MAJOR-MODE">EMACS MAJOR MODE</h1>

<p>A major mode for emacs is provided with the Demeter package. It provides some functionality for editing Demeter configuration files. The most significant functionality is syntax colorization that enforces overly strict rules for the layout of the file. Using this major mode helps avoid introducing formatting errors into a configuration file which has an admittedly fragile syntax.</p>

<p>See <i>config-mode.el</i> in the <i>tools/</i> subdirectory of the Demeter distribution. To use config-mode, simply place the file somewhere in the Emacs load path and put this line in your .emacs file or some other emacs initialization file.</p>

<pre><code>   (autoload &#39;config-mode &quot;config-mode&quot;)</code></pre>

<p>The mode is tiny. You can byte-compile or not -- as you wish.</p>

<h1 id="DEPENDENCIES">DEPENDENCIES</h1>

<p>See the <i>Build.PL</i> file for a list of dependencies.</p>

<h1 id="BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</h1>

<ul>

<li><p>This object needs to be a singleton, but it also needs to extend Demeter. How is that done in Moose? I have no idea....</p>

</li>
<li><p>Nothing prevents overwriting Config entries -- this is a potential problem for user-defined parameetrs.</p>

</li>
<li><p>There is no introspection method for returning all (sets of) user defined parameters.</p>

</li>
<li><p>The configuration file syntax is somewhat fragile.</p>

</li>
<li><p><code>read_config_file</code> only handles files relative to the master config file. If it could understand fully resolved filenames, it could, for instance, look for additional configuration files in userspace or application space. That way apps and one-off tools could use the configuration system.</p>

</li>
<li><p>When (how often) should ini files be written out?</p>

</li>
</ul>

<p>Please report problems to the Ifeffit Mailing List (<a href="http://cars9.uchicago.edu/mailman/listinfo/ifeffit/">http://cars9.uchicago.edu/mailman/listinfo/ifeffit/</a>)</p>

<p>Patches are welcome.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Bruce Ravel, <a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a></p>

<p><a href="http://bruceravel.github.io/demeter/">http://bruceravel.github.io/demeter/</a></p>

<h1 id="LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</h1>

<p>Copyright (c) 2006-2018 Bruce Ravel (<a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a>). All rights reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See <a href="http://metacpan.org/module/perlgpl">perlgpl</a>.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

</div><div class="footer">generated by <a href="http://metacpan.org/module/Pod::ProjectDocs">Pod::ProjectDocs</a></div></body></html>

