<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
<title>Demeter::Feff &mdash; Demeter</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="../podstyle.css" type="text/css" />
</head>
<body><div class="box">
  <h1 class="t1">Demeter</h1>
  <table>
    <tr>
      <td class="label">Description</td>
      <td class="cell">Perl tools for X-ray Absorption Spectroscopy</td>
    </tr>
  </table>
</div>
<div class="path">
  <a href="../index.html">Demeter</a> &gt; Perl Modules &gt;
  Demeter::Feff
</div>
<div>

<a href="../src/Demeter/Feff.pm">Source</a>

</div>

<div class="pod">


<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#ATTRIBUTES">ATTRIBUTES</a></li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#Accessor-methods">Accessor methods</a></li>
      <li><a href="#Feff-replacement-methods">Feff replacement methods</a></li>
      <li><a href="#Feff-running-methods">Feff running methods</a></li>
      <li><a href="#Reporting-methods">Reporting methods</a></li>
      <li><a href="#Convenience-methods">Convenience methods</a></li>
    </ul>
  </li>
  <li><a href="#SERIALIZATION-AND-DESERIALIZATION">SERIALIZATION AND DESERIALIZATION</a></li>
  <li><a href="#CONFIGURATION-AND-ENVIRONMENT">CONFIGURATION AND ENVIRONMENT</a></li>
  <li><a href="#DEPENDENCIES">DEPENDENCIES</a></li>
  <li><a href="#BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Demeter::Feff - Make and manipulate Feff calculations</p>

<h1 id="VERSION">VERSION</h1>

<p>This documentation refers to Demeter version 0.9.26.</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>  my $feff = Demeter::Feff -&gt; new(file =&gt; &#39;feff.inp&#39;);
  $feff-&gt;set(workspace=&gt;&quot;temp&quot;, screen=&gt;1);
  $feff-&gt;run;
  $feff-&gt;intrp;</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This subclass of the Demeter class is for interacting with theory from Feff. Computing the <code>phase.bin</code> file is done by Feff via a pipe, as is running the genfmt portion of Feff. Parsing the input file, pathfinding, and generating the <code>paths.dat</code> to control genfmt have been implemented as methods of this object.</p>

<h1 id="ATTRIBUTES">ATTRIBUTES</h1>

<dl>

<dt id="file"><code>file</code></dt>
<dd>

<p>The name of a <i>feff.inp</i> file.</p>

</dd>
<dt id="yaml"><code>yaml</code></dt>
<dd>

<p>The name of a file containing a serialization of a Feff calculation.</p>

</dd>
<dt id="atoms"><code>atoms</code></dt>
<dd>

<p>A <a href="Atoms.pm.html">Demeter::Atoms</a> object from which a <i>feff.inp</i> file will be generated automatically.</p>

</dd>
<dt id="sites"><code>sites</code></dt>
<dd>

<p>Reference to a list containing all the sites found in the input structure. Each element of the list is a reference to a list containing the site&#39;s x, y , and z coordinates, followed by its potential index.</p>

</dd>
<dt id="potentials"><code>potentials</code></dt>
<dd>

<p>Reference to a list containing all the unique potentials. Each element of the list is a reference to a list containing the site&#39;s ipot, Z-number, and tag.</p>

</dd>
<dt id="titles"><code>titles</code></dt>
<dd>

<p>Reference to a list containing all the title lines.</p>

</dd>
<dt id="absorber"><code>absorber</code></dt>
<dd>

<p>Reference to a list containing the x, y, and z coordinates of the absorbing atoms.</p>

</dd>
<dt id="abs_index"><code>abs_index</code></dt>
<dd>

<p>Index, starting at 0, of the absorber in the <code>sites</code> list.</p>

</dd>
<dt id="edge"><code>edge</code></dt>
<dd>

<p>The edge of the calculation. This can be any of 1, 2, 3, 4, K, L1, L2, or L3.</p>

</dd>
<dt id="s02"><code>s02</code></dt>
<dd>

<p>The S02 value. This can be other than 1, which is a really bad idea for the Feff calculation, but that&#39;s how Feff works.</p>

</dd>
<dt id="rmax"><code>rmax</code></dt>
<dd>

<p>The Rmax value, i.e. the half length of the longest path.</p>

</dd>
<dt id="nlegs"><code>nlegs</code></dt>
<dd>

<p>The maximum number of legs of paths to be calculated. In Feff this can be as large as 7. Demeter&#39;s implementation of the path finder is currently limited to 4.</p>

</dd>
<dt id="rmultiplier"><code>rmultiplier</code></dt>
<dd>

<p>The value of Rmultiplier, an isotropic scaling factor for all atomic coordinates in the atoms list.</p>

</dd>
<dt id="pcrit"><code>pcrit</code></dt>
<dd>

<p>The value of the plane wave criterion. This is not used by Demeter&#39;s pathfinder.</p>

</dd>
<dt id="ccrit"><code>ccrit</code></dt>
<dd>

<p>The value of the curved wave criterion. This may be used by the <code>genfmt</code> method.</p>

</dd>
<dt id="workspace"><code>workspace</code></dt>
<dd>

<p>A valid directory in which to run Feff. Demeter will cd into this directory before writing out a <i>feff.inp</i> file, computing the potentials, running the pathfinder, or running genfmt.</p>

</dd>
<dt id="miscdat"><code>miscdat</code></dt>
<dd>

<p>The contents of the <i>misc.dat</i> file, slurped up after the <i>phase.bin</i> file is generated.</p>

</dd>
<dt id="pathlist"><code>pathlist</code></dt>
<dd>

<p>A reference to the list of ScatteringPath objects generated by the <code>pathfinder</code> method.</p>

</dd>
<dt id="hidden"><code>hidden</code></dt>
<dd>

<p>This boolean attribute is true if this is a &quot;hidden&quot; Feff calculation. As example of this is the Feff calculation associated with a <a href="FSPath.pm.html">Demeter::FSPath</a> object. In that case, the Feff calculation is intended to be done completely bihind the scenes and the user will normally not interact with it directly. In the contextof Artemis, this means that an entry in the Feff toolbar will not be shown for the FSPath object.</p>

</dd>
<dt id="source"><code>source</code></dt>
<dd>

<p>This is a string that is used to identify the provenance of the Feff calculation. The default is &quot;demeter/feff6&quot;, indicating that the Feff calculation was handled entirely by Demeter. For a Demeter::Feff::External object, this is set to &quot;external&quot;, indicating that the Feff calculation was imported from outside of Demeter.</p>

</dd>
<dt id="screen"><code>screen</code></dt>
<dd>

<p>A boolean controlling whether Feff&#39;s output is printed to STDOUT.</p>

</dd>
<dt id="buffer"><code>buffer</code></dt>
<dd>

<p>A reference to a array or scalar for containing the output from Feff. This array or scalar can then be handled by the caller.</p>

</dd>
<dt id="save"><code>save</code></dt>
<dd>

<p>A boolean saying whether to save the minimal <code>feff.inp</code> file after a Feff running step is finished.</p>

</dd>
</dl>

<h1 id="METHODS">METHODS</h1>

<h2 id="Accessor-methods">Accessor methods</h2>

<p>This uses the <code>set</code> and <code>get</code> methods of the parent class, <a href="../Demeter.pm.html">Demeter</a>.</p>

<h2 id="Feff-replacement-methods">Feff replacement methods</h2>

<dl>

<dt id="rdinp"><code>rdinp</code></dt>
<dd>

<p>Parse the feff input file and store its information. It can read from an arbitrarily named file, which is an improvement over Feff itself..</p>

<pre><code>  $feff -&gt; rdinp(&quot;yourfeff.inp&quot;);</code></pre>

<p>If called without an argument, it will look for <i>feff.inp</i> in the current working directory.</p>

<p>This is triggered when the <code>file</code> attribute is set.</p>

</dd>
<dt id="pathfinder"><code>pathfinder</code></dt>
<dd>

<p>Find all unique paths in the input atoms list. All degenerate geometries will be preserved.</p>

<pre><code>  $feff -&gt; rdinp(&quot;somefeff.inp&quot;) -&gt; pathfinder;</code></pre>

<p>This implementation of the path finder has two advantages over Feff&#39;s implementation.</p>

<ul>

<li><p>The degeneracy is determined with fuzziness. Paths with similar, but not equal, half-lengths and/or scattering angles will be grouped together as effectively degenerate. The width of these fuzzily degenerate bins is configurable.</p>

</li>
<li><p>The geometries of the degenerate paths are preserved. This will aid in the identification of paths in a ball-and-stick view and allow easier tracking of how structural distortions propagate into the path list.</p>

</li>
</ul>

<p>There are three shortcomings of Demeter&#39;s path finder compared to Feff&#39;s:</p>

<ul>

<li><p>Implemented in an interpreted language, it is considerably slower. This is exponentially true for larger clusters.</p>

</li>
<li><p>It is currently limited to 4-legged paths. This is not a fundamental limitation, merely a lazy one. Eventually all leggedness limitations will be removed from Demeter&#39;s implementation.</p>

</li>
<li><p>Demeter cannot compute the so-called importance factor which is used to limit the size of the heap and to convey approximate information about path size to the user. This is actually a pretty serious problem as it means that one of Feff&#39;s most important ways of trimming the size of the pathfinder heap is unavailable to Demeter.</p>

</li>
</ul>

<p>This is not simply a drop-in-place replacement. It actually produces different output than Feff&#39;s path finder. It will not miss any of the important paths, but it treats degeneracies differently and will include some small paths that Feff would normally exclude.</p>

</dd>
<dt id="pathsdat"><code>pathsdat</code></dt>
<dd>

<p>Write a <i>paths.dat</i> file from some or all of the ScatteringPath objects found by the path finder.</p>

<pre><code>  $feff -&gt; pathsdat()
  # or
  $feff -&gt; pathsdat(7 .. 13);</code></pre>

<p>With no argument, all paths will be written to the <i>paths.dat</i> file. The optional argument is a list of numbers interpreted as indeces of the list returned by the <code>pathlist</code> method.</p>

</dd>
</dl>

<h2 id="Feff-running-methods">Feff running methods</h2>

<dl>

<dt id="run"><code>run</code></dt>
<dd>

<p>This calls <code>potph</code> then <code>pathfinder</code>. It is proving common to chain these two methods, so it seems useful to provide a shortcut.</p>

</dd>
<dt id="make_feffinp"><code>make_feffinp</code></dt>
<dd>

<p>Write out a feff.inp file suitable for computing the potentials, running genfmt, or running all of Feff.</p>

<pre><code>  $feff -&gt; make_feffinp(&quot;potentials&quot;);
    # or
  $feff -&gt; make_feffinp(&quot;genfmt&quot;);
    # or
  $feff -&gt; make_feffinp(&quot;full&quot;);</code></pre>

</dd>
<dt id="potph"><code>potph</code></dt>
<dd>

<p>Run Feff to compute the potentials. The <code>make_feffinp</code> method will be run if needed.</p>

<pre><code>  $feff -&gt; potph;</code></pre>

<p>This runs just the first segment of Feff, generating the <i>phase.bin</i> file. Note that, when transfering a feff calculation between machines with different CPU or different operating system, this binary file will not be read correctly (possibly not at all) by Feff on the new machine.</p>

</dd>
<dt id="genfmt"><code>genfmt</code></dt>
<dd>

<p>Run the third segment of Feff, which imports the <i>phase.bin</i> file and generates a <i>feffNNNN.dat</i> file for every entry int he <i>paths.dat</i> file.</p>

<pre><code>  $feff -&gt; genfmt();
  # or
  $feff -&gt; genfmt(7 .. 13);</code></pre>

<p>The optional argument is a list of indeces passed to the <code>pathsdat</code> method. WIthout that argument, <code>pathsdat</code> is used to write out data for every path found by the path finder.</p>

</dd>
<dt id="run_feff"><code>run_feff</code></dt>
<dd>

<p>This cds to the directory specified by the <code>workspace</code> attribute and runs feff using whatever <i>feff.inp</i> file is found there. You would usually call the <code>make_feffinp</code> method just before calling this.</p>

<pre><code>  $feff -&gt; make_feffinp(&quot;potentials&quot;) -&gt; run_feff;</code></pre>

</dd>
<dt id="report"><code>report</code></dt>
<dd>

<p>Dispose of text, possibly gathered from a Feff run, to the channels specified by the <code>screen</code> and <code>buffer</code> attributes.</p>

<pre><code>  $feff -&gt; report($some_text);</code></pre>

</dd>
<dt id="rank_paths"><code>rank_paths</code></dt>
<dd>

<p>Perform various rankins of the importance of the various paths found using Demeter&#39;s pathfinder. One of these is to run Feff on the entire path list and extract the curved wave importance factors from the <i>files.dat</i> file. Other rankings are performed using <a href="ScatteringPath/Rank.pm.html">Demeter::ScatteringPath::Rank</a>. The rankings are stored in the ScatteringPath object.</p>

<pre><code>  $feff -&gt; pathfinder;
  ## some time later ...
  $feff-&gt;rank_paths;</code></pre>

</dd>
</dl>

<h2 id="Reporting-methods">Reporting methods</h2>

<dl>

<dt id="intrp"><code>intrp</code></dt>
<dd>

<p>Write an interpretation of the Feff calculation. This summarizes each path, reporting on the <i>feffNNNN.dat</i> index, the degeneracy, the half path length, and a description of the scattering geometry.</p>

<p>The optional argument is used to add markup to add some style to the text written.</p>

<p>To mark up the interpretation for an html page using CSS</p>

<pre><code>   print $feff-&gt;intrp(&#39;css&#39;);</code></pre>

<p>You will need to define CSS text styles called <code>comment</code>, <code>major</code>, <code>minor</code>, and <code>normal</code> for the header, the major paths, the minor paths, and the small paths respectively. Here is a very simple example:</p>

<pre><code>  .comment {
    font: 1em monospace;
    color: #990000;
  }
  .major {
    font: 1em monospace;
    color: #009900;
  }
  .minor {
    font: 1em monospace;
    color: #775500;
  }
  .normal {
    font: 1em monospace;
    color: #777777;
  }</code></pre>

<p>To mark up the interpretation for LaTeX</p>

<pre><code>   print $feff-&gt;intrp(&#39;latex&#39;);</code></pre>

<p>You will need to define colors called <code>commentcolor</code>, <code>majorcolor</code>, and <code>minorcolor</code> for the header, the major paths, and the minor paths, respectively. One way of defining colors in your LaTeX document is</p>

<pre><code>   \usepackage[pdftex]{color}
   \definecolor{commentcolor}{rgb}{0.70,0.00,0.00}</code></pre>

<p>The argument can also be a hash reference defining some other kind of markup. There are five markup tags:</p>

<dl>

<dt id="comment"><code>comment</code></dt>
<dd>

<p>The beginning of a header line. In the latex style, this is &quot;<code>{\color{commentcolor}\texttt{</code>&quot;. In css style, this is &quot;<code>&lt;span class=comment&gt;</code>&quot;.</p>

</dd>
<dt id="pod2"><code>2</code></dt>
<dd>

<p>The beginning of a path of importance level 2. In the latex style, this is &quot;<code>{\color{majorcolor}\texttt{</code>&quot;. In css style, this is &quot;<code>&lt;span class=major&gt;</code>&quot;.</p>

</dd>
<dt id="pod1"><code>1</code></dt>
<dd>

<p>The beginning of a path of importance level 1. In the latex style, this is &quot;<code>{\color{minorcolor}\texttt{</code>&quot;. In css style, this is &quot;<code>&lt;span class=minor&gt;</code>&quot;.</p>

</dd>
<dt id="pod0"><code>0</code></dt>
<dd>

<p>The beginning of a path of importance level 0. In the latex style, this is &quot;<code>{\texttt{</code>&quot;. In css style, this is &quot;<code>&lt;span class=normal&gt;</code>&quot;.</p>

</dd>
<dt id="close"><code>close</code></dt>
<dd>

<p>The markup for the end of a style block. In the latex style, this is two closing curly brackets, &quot;<code>}}</code>&quot;. In css style, this is &quot;<code>&lt;/span&gt;&lt;br&gt;</code>&quot;.</p>

</dd>
</dl>

<p>Here is an example of adding some color when writing to a terminal capable of displaying ANSI color:</p>

<pre><code>    use Term::ANSIColor qw(:constants);
    $style = {comment =&gt; BOLD.RED,
              close   =&gt; RESET,
              1       =&gt; BOLD.YELLOW,
              2       =&gt; BOLD.GREEN,
              0       =&gt; q{},
             };
    print $feff-&gt;intrp($style);</code></pre>

<p>The ANSI color example is not pre-defined so that Term::ANSIColor does not have to be a Demeter requirement. That said, it is probably the most useful style.</p>

</dd>
</dl>

<h2 id="Convenience-methods">Convenience methods</h2>

<p>These are simple wrappers around the <code>get</code> accessor.</p>

<dl>

<dt id="central"><code>central</code></dt>
<dd>

<p>Returns a list of the x, y, and z coordinates of the central atom.</p>

</dd>
<dt id="list_of_paths"><code>list_of_paths</code></dt>
<dd>

<p>Returns a list of ScatteringPath objects found by the path finder. This simply dereferences the anonymous array contained in the <code>pathlist</code> attribute and returns the list.</p>

</dd>
<dt id="nsites"><code>nsites</code></dt>
<dd>

<p>Returns the number of sites in the atoms list.</p>

</dd>
</dl>

<h1 id="SERIALIZATION-AND-DESERIALIZATION">SERIALIZATION AND DESERIALIZATION</h1>

<p>The Feff object uses <a href="http://metacpan.org/module/YAML">YAML</a> for its serialization format. All of the scalar valued attributes are collected into a hash, which is the first thing serialized into the YAML file. This is followed by the array-valued attributes in this order: <code>titles</code>, <code>othercards</code>, <code>potentials</code>, <code>absorber</code>, then <code>sites</code>. Finally each of the ScatteringPath objects are serialized in the order they appear in the <code>pathlist</code> attribute. <code>freeze</code> is an alias for <code>serialize</code>.</p>

<pre><code>  $feff -&gt; serialize($yaml_filename);
    # or
  $feff -&gt; freeze($yaml_filename);</code></pre>

<p>There is a second, optional argument to <code>serialize</code>. If true, the serialization file is written without compression. By default, the serialization file is compressed using the gzip algorithm.</p>

<p>You can deserialize the YAML file and store it in a Feff object and a list of ScatteringPath objects. <code>thaw</code> is an alias for <code>deserialize</code>.</p>

<pre><code>  $feff -&gt; deserialize($yaml_filename);
    # or
  $feff -&gt; thaw($yaml_filename);</code></pre>

<h1 id="CONFIGURATION-AND-ENVIRONMENT">CONFIGURATION AND ENVIRONMENT</h1>

<p>See <a href="../Demeter.pm.html">Demeter</a> for a description of the configuration system.</p>

<h1 id="DEPENDENCIES">DEPENDENCIES</h1>

<p>The dependencies of the Demeter system are in the <i>Build.PL</i> file.</p>

<h1 id="BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</h1>

<ul>

<li><p>Need methods for identifying particular paths, for example &quot;the single scattering path with the phosphorous atom as the scatterer&quot;.</p>

</li>
<li><p>Automated indexing currently only works when doing a fit. If you want to plot paths before doing a fit, you will need to assign indeces by hand.</p>

</li>
<li><p>Feff8 functionality is incomplete. For instance, the <code>potentials</code> attribute needs to allow for longer lists for the additional parameters in Feff8.</p>

</li>
<li><p>The <code>edge</code> attribute should recognize M, N, O edges.</p>

</li>
<li><p>Need to keep and <code>iedge</code> attribute, as in the Atoms object</p>

</li>
<li><p>The <code>pathsdat</code> method should accept special arguments, like &quot;SS&quot; for all single scattering paths, or &quot;collinear&quot; for all collinear MS paths.</p>

</li>
<li><p>Look into doing a better job of caching halflengths. Tools::halflength is a significanty fraction of the time spent by the pathfinder.</p>

</li>
</ul>

<p>See <a href="ScatteringPath.pm.html">Demeter::ScatteringPath</a> for limitations of the pathfinder.</p>

<p>Please report problems to the Ifeffit Mailing List (<a href="http://cars9.uchicago.edu/mailman/listinfo/ifeffit/">http://cars9.uchicago.edu/mailman/listinfo/ifeffit/</a>)</p>

<p>Patches are welcome.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Bruce Ravel, <a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a></p>

<p><a href="http://bruceravel.github.io/demeter/">http://bruceravel.github.io/demeter/</a></p>

<h1 id="LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</h1>

<p>Copyright (c) 2006-2018 Bruce Ravel (<a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a>). All rights reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See <a href="http://metacpan.org/module/perlgpl">perlgpl</a>.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

</div><div class="footer">generated by <a href="http://metacpan.org/module/Pod::ProjectDocs">Pod::ProjectDocs</a></div></body></html>

