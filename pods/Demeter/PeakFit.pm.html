<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
<title>Demeter::PeakFit &mdash; Demeter</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="../podstyle.css" type="text/css" />
</head>
<body><div class="box">
  <h1 class="t1">Demeter</h1>
  <table>
    <tr>
      <td class="label">Description</td>
      <td class="cell">Perl tools for X-ray Absorption Spectroscopy</td>
    </tr>
  </table>
</div>
<div class="path">
  <a href="../index.html">Demeter</a> &gt; Perl Modules &gt;
  Demeter::PeakFit
</div>
<div>

<a href="../src/Demeter/PeakFit.pm">Source</a>

</div>

<div class="pod">


<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#FITTING-ENGINES">FITTING ENGINES</a></li>
  <li><a href="#ATTRIBUTES">ATTRIBUTES</a></li>
  <li><a href="#METHODS">METHODS</a></li>
  <li><a href="#CONFIGURATION-AND-ENVIRONMENT">CONFIGURATION AND ENVIRONMENT</a></li>
  <li><a href="#DEPENDENCIES">DEPENDENCIES</a></li>
  <li><a href="#BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Demeter::PeakFit - A peak fitting object for Demeter</p>

<h1 id="VERSION">VERSION</h1>

<p>This documentation refers to Demeter version 0.9.26.</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>Here is a simple fit of three peak shapes to normalized XES data.</p>

<pre><code>  #!/usr/bin/perl
  use Demeter qw(:ui=screen :plotwith=gnuplot);

  my $xes = Demeter::XES-&gt;new(file=&gt;&#39;../XES/7725.11&#39;,
                              energy =&gt; 2, emission =&gt; 3,
                              e1 =&gt; 7610, e2 =&gt; 7624, e3 =&gt; 7664, e4 =&gt; 7690,
                             );
  my $peak = Demeter::PeakFit-&gt;new(screen =&gt; 0, yaxis=&gt; &#39;norm&#39;, name=&gt;&#39;fit&#39;);
  $peak -&gt; data($xes);

  $peak -&gt; add(&#39;gaussian&#39;,   center=&gt;7649.5, name=&gt;&#39;peak 1&#39;);
  $peak -&gt; add(&#39;gaussian&#39;,   center=&gt;7647.7, name=&gt;&#39;peak 2&#39;);
  $peak -&gt; add(&#39;lorentzian&#39;, center=&gt;7636.8, name=&gt;&#39;peak 3&#39;);

  $peak -&gt; fit;
  print $peak -&gt; report;
  $_  -&gt; plot(&#39;norm&#39;) foreach ($xes, $peak, @{$peak-&gt;lineshapes});
  $peak -&gt; pause;</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This object is a sort of container for holding Data (either XANES data in a normal Data object or XES data in an XES object) along with some number of lineshapes. It organizes the parameterization of the lineshapes and shuffles all of this off to the fitting engine for fitting, all wihtout having to master whatever quirky syntax it might have.</p>

<h1 id="FITTING-ENGINES">FITTING ENGINES</h1>

<p>This module provides an abstract framework for enabling peak fitting in Demeter. This abstraction allows (well ... in principle) the use of various backends for performing the actual fit. Currently the only one available is Fityk (http://www.unipress.waw.pl/fityk/), which is implemented as <a href="PeakFit/Fityk.pm.html">Demeter::PeakFit::Fityk</a>.</p>

<p>Any suggestions?</p>

<h1 id="ATTRIBUTES">ATTRIBUTES</h1>

<dl>

<dt id="screen-boolean-0"><code>screen</code> (boolean) [0]</dt>
<dd>

<p>This is a flag telling Demeter to echo instructions to the screen.</p>

</dd>
<dt id="engine-boolean-1"><code>engine</code> (boolean) [1]</dt>
<dd>

<p>This is a flag telling Demeter to echo instructions to the fitting engine process.</p>

</dd>
<dt id="buffer"><code>buffer</code></dt>
<dd>

<p>Dispose commands to a string or array when given a reference to a string or array. This allows you to accumulate instructions in a string or an array an save them for future use, e.g. writing a script or displaying a text widget in a GUI.</p>

</dd>
<dt id="xaxis-string-energy"><code>xaxis</code> (string) [energy]</dt>
<dd>

<p>The string denoting the array containing the ordinate axis of the data. For most XANES and XES data, this is <code>energy</code>.</p>

</dd>
<dt id="yaxis-string-flat"><code>yaxis</code> (string) [flat]</dt>
<dd>

<p>The string denoting the array containing the abscisa axis of the data. For most XANES, this is typically either <code>flat</code> or <code>norm</code>. For XES data, this might be <code>raw</code>, <code>sub</code>, or <code>norm</code>. Note that the default will trigger an error if you try to fit XES data without changing its value appropriately.</p>

</dd>
<dt id="sigma-string"><code>sigma</code> (string) []</dt>
<dd>

<p>The string denoting the array containing the varience of the data.</p>

</dd>
<dt id="xmin-float"><code>xmin</code> (float)</dt>
<dd>

<p>The lower bound of the fit range. For XANES data, this will be interpreted relative to the edge, while for XES data it is intepretated as an absolute energy.</p>

</dd>
<dt id="xmax-float"><code>xmax</code> (float)</dt>
<dd>

<p>The upper bound of the fit range. For XANES data, this will be interpreted relative to the edge, while for XES data it is intepretated as an absolute energy.</p>

</dd>
<dt id="lineshapes"><code>lineshapes</code></dt>
<dd>

<p>This contains a reference to the array of LineShape objects included in the fit. This array can be manipulated with the standard Moose-y sort of automatically generated methods:</p>

<pre><code>  push_lineshapes
  pop_lineshapes
  shift_lineshapes
  unshift_lineshapes
  clear_lineshapes</code></pre>

</dd>
</dl>

<h1 id="METHODS">METHODS</h1>

<dl>

<dt id="add"><code>add</code></dt>
<dd>

<p>Use this to add new lineshapes to the fitting model.</p>

<pre><code>  $ls = $peak -&gt; add(&quot;Gaussian&quot;, center =&gt; 4967, name =&gt; &quot;First peak&quot;)</code></pre>

<p>This returns a <i>Demeter::PeakFit::LineShape</i> object. This is the standard way of creating such an object as this properly associates the LineShape object with the current peak fitting effort. It should never be necessary (or desirable) to create a LineShape by hand.</p>

</dd>
<dt id="fit"><code>fit</code></dt>
<dd>

<p>Perform the fit after adding one or more LineShapes.</p>

<pre><code>  $peak -&gt; fit;</code></pre>

<p>After the fit finishes, the statistics of the fit will be accumulated from the fitting engine and stored in this and all the LineShape objects.</p>

</dd>
<dt id="engine_object"><code>engine_object</code></dt>
<dd>

<p>This returns the object for interacting with the fitting engine (if there is one). This is used extensively by <i>Demeter::PeakFit::LineShape</i>.</p>

</dd>
<dt id="plot"><code>plot</code></dt>
<dd>

<p>Use this to plot the result of the fit. Note that this only plots the full model and (optionally) the residual. To plot the individual function, use the <code>plot</code> method of the the LineShape object.</p>

<p>This plots the data along with the fitting model and each function:</p>

<pre><code>  $xanes_data -&gt; po -&gt; e_norm(1);
  $_ -&gt; plot(&#39;E&#39;) foreach ($xanes_data, $peak, @{$peak-&gt;lineshapes});</code></pre>

<p>Note that the C(&#39;E&#39;) argument and the setting of <code>e_norm</code> are ignored by the PeakFit and LineShape objects, but they are required to plot a fit to XANES data as the fit is made to the normalized data. In fact, the fit is made to the flattened data if the Data&#39;s <code>bkg_flatten</code> attribute is true.</p>

<p>For a fit to raw XES data, you might make the plot like so:</p>

<pre><code>  $_ -&gt; plot(&#39;raw&#39;) foreach ($xanes_data, $peak, @{$peak-&gt;lineshapes});</code></pre>

<p>Specifically, you want to plot the data in the manner indicated by the <code>yaxis</code> attribute of the PeakFit object, which indicates the form of the data used in the fit.</p>

<p>When the PeakFit object is plotted, the residual from the fit will also be plotted if the <code>plot_res</code> attribute of the Plot object is true.</p>

</dd>
<dt id="pf_dispose"><code>pf_dispose</code></dt>
<dd>

<p>This is the choke point for sending instructions to the fitting engine, much like the normal <code>dispose</code> method handles text intended for Ifeffit or Gnuplot. See the descriptions of the <code>engine</code> and <code>screen</code> attributes.</p>

</dd>
<dt id="report"><code>report</code></dt>
<dd>

<p>This returns a tring summarizing the results of a fit.</p>

<pre><code>  print $peak-&gt;report;</code></pre>

</dd>
</dl>

<h1 id="CONFIGURATION-AND-ENVIRONMENT">CONFIGURATION AND ENVIRONMENT</h1>

<p>See <a href="Config.pm.html">Demeter::Config</a> for a description of the configuration system.</p>

<h1 id="DEPENDENCIES">DEPENDENCIES</h1>

<p>Demeter&#39;s dependencies are in the <i>Build.PL</i> file.</p>

<h1 id="BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</h1>

<ul>

<li><p>How to capture errors without bailing?</p>

</li>
<li><p>more testing with xanes data</p>

</li>
<li><p>better interface for fixing parameters</p>

</li>
<li><p>need to test more functions</p>

</li>
</ul>

<p>Please report problems to the Ifeffit Mailing List (<a href="http://cars9.uchicago.edu/mailman/listinfo/ifeffit/">http://cars9.uchicago.edu/mailman/listinfo/ifeffit/</a>)</p>

<p>Patches are welcome.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Bruce Ravel, <a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a></p>

<p><a href="http://bruceravel.github.io/demeter/">http://bruceravel.github.io/demeter/</a></p>

<h1 id="LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</h1>

<p>Copyright (c) 2006-2018 Bruce Ravel (<a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a>). All rights reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See <a href="http://metacpan.org/module/perlgpl">perlgpl</a>.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

</div><div class="footer">generated by <a href="http://metacpan.org/module/Pod::ProjectDocs">Pod::ProjectDocs</a></div></body></html>

