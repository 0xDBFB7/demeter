<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
<title>Demeter::Fit::Sanity &mdash; Demeter</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="../../podstyle.css" type="text/css" />
</head>
<body><div class="box">
  <h1 class="t1">Demeter</h1>
  <table>
    <tr>
      <td class="label">Description</td>
      <td class="cell">Perl tools for X-ray Absorption Spectroscopy</td>
    </tr>
  </table>
</div>
<div class="path">
  <a href="../../index.html">Demeter</a> &gt; Perl Modules &gt;
  Demeter::Fit::Sanity
</div>
<div>
<a href="../../src/Demeter/Fit/Sanity.pm">Source</a>
</div>

<div class="pod">


<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#METHODS">METHODS</a></li>
  <li><a href="#TROUBLE-REPORTING">TROUBLE REPORTING</a>
    <ul>
      <li><a href="#Problems-with-Data-objects">Problems with Data objects</a></li>
      <li><a href="#Problems-with-Path-objects">Problems with Path objects</a></li>
      <li><a href="#Problems-with-GDS-objects">Problems with GDS objects</a></li>
      <li><a href="#Problems-with-Fit-objects">Problems with Fit objects</a></li>
    </ul>
  </li>
  <li><a href="#CONFIGURATION-AND-ENVIRONMENT">CONFIGURATION AND ENVIRONMENT</a></li>
  <li><a href="#BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Demeter::Fit::Sanity - Sanity checks for EXAFS fitting models</p>

<h1 id="VERSION">VERSION</h1>

<p>This documentation refers to Demeter version 0.9.26.</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>  my $fitobject = Demeter::Fit -&gt;
     new(gds   =&gt; \@gds_objects,
         data  =&gt; [$data_object],
         paths =&gt; \@path_objects,
        );
  $command = $fitobject -&gt; fit;</code></pre>

<p>Before the fit method is run, a series of sanity check on the data contained in the fit object is run. The sanity checks all live in this module.</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This module contains all the sanity checks made on a Fit object before the fit starts. This file forms part of the base of the Demeter::Fit class and serves no independent function. That is, using this module directly in a program does nothing useful -- it is purely a utility module for the Feff object.</p>

<p>The user should never need to call the methods explicitly since they are called automatically whenever a fit or a sum is performed. However they are documented here so that the scope of such checks made is clearly understood.</p>

<p>When problems are found, the fit will exit and a descriptive report will be made.</p>

<h1 id="METHODS">METHODS</h1>

<p>The following sanity checks are made on the Fit object:</p>

<ul>

<li><p>All data files included in the fit exist.</p>

</li>
<li><p>No data set is obviously used twice in the fit.</p>

</li>
<li><p>All <i>feffNNNN.dat</i> files used in the fit exist.</p>

</li>
<li><p>All guess parameters are used in at least one def parameter or path parameter.</p>

</li>
<li><p>No def or path parameters use parameters which have not been defined.</p>

</li>
<li><p>Binary operators are used correctly, specifically that none of these strings appear in a math expression:</p>

<pre><code>   ++    --   //   ***   ^^</code></pre>

</li>
<li><p>All function names (i.e. strings that are followed by an open paren) are valid Ifeffit functions.</p>

</li>
<li><p>All data and path objects have unique group names.</p>

</li>
<li><p>All GDS parameters have unique names.</p>

</li>
<li><p>All opening parens are matched by closing parens.</p>

</li>
<li><p>All data paremeters make sense, for example that <code>fft_kmin</code> is smaller than <code>fft_kmax</code>.</p>

</li>
<li><p>The number of guess parameters does not exceed the number of independent points.</p>

</li>
<li><p>The <code>bft_rmin</code> value is not greater than <code>bkg_rbkg</code>.</p>

</li>
<li><p>The R_eff of any path is not far beyond <code>bft_rmax</code>.</p>

</li>
<li><p>Ifeffit&#39;s hardwired limits on things like the maximum number of guess parameters and the maximum number of data sets are not exceeded by the fitting model.</p>

</li>
<li><p>No GDS parameters have the names of Ifeffit program variables or other reserved words.</p>

</li>
<li><p>No merge parameters remain unresolved.</p>

</li>
</ul>

<h1 id="TROUBLE-REPORTING">TROUBLE REPORTING</h1>

<p>The <code>trouble</code> attribute of an Demeter object will be filled with a pipe-separated list of problem codes.</p>

<p>Some error codes contain additional information to further identify the problem. These codes have a keyword separated from the other information by an underscore, making these sufficiently easy to parse on the fly. Indeed, the <code>translate_trouble</code> method of the base object (see <a href="../../Demeter.pm.html">Demeter</a>) does just that, so error reporting during a fit is an example of literate programming.</p>

<p>Here are the explanations:</p>

<h2 id="Problems-with-Data-objects">Problems with Data objects</h2>

<dl>

<dt id="e"><code>-e</code></dt>
<dd>

<p>You specified an explicit data file to use in the fit (i.e. not part of a project file) and that file does not exist.</p>

</dd>
<dt id="r"><code>-r</code></dt>
<dd>

<p>You specified an explicit data file to use in the fit (i.e. not part of a project file) and that data file cannot be read.</p>

</dd>
<dt id="namenotunique"><code>namenotunique</code></dt>
<dd>

<p>The Ifeffit group name of this data group is not unique.</p>

</dd>
<dt id="pathdataname"><code>pathdataname</code></dt>
<dd>

<p>This path has an Ifeffit group name which is used by a Path object.</p>

</dd>
<dt id="tagnotunique"><code>tagnotunique</code></dt>
<dd>

<p>The tag of this data group is not unique.</p>

</dd>
<dt id="cvnotunique"><code>cvnotunique</code></dt>
<dd>

<p>The characteristic value of this data group is not unique.</p>

</dd>
<dt id="kminkmax"><code>kminkmax</code></dt>
<dd>

<p><code>kmin</code> is larger than <code>kmax</code>.</p>

</dd>
<dt id="rminrmax"><code>rminrmax</code></dt>
<dd>

<p><code>rmin</code> is larger than <code>rmax</code>.</p>

</dd>
<dt id="rminrbkg"><code>rminrbkg</code></dt>
<dd>

<p><code>rmin</code> is smaller than the value of <code>rbkg</code> that was used in the background removal.</p>

</dd>
<dt id="collision"><code>collision</code></dt>
<dd>

<p>This data came from the the same source as another data group. You seem to be trying to increase your number of independent points by fitting the same data more than once in a multiple data set fit.</p>

</dd>
<dt id="datanopaths"><code>datanopaths</code></dt>
<dd>

<p>This data has no paths associated with it. You must either assign paths to it or exclude it from the fit.</p>

</dd>
</dl>

<h2 id="Problems-with-Path-objects">Problems with Path objects</h2>

<dl>

<dt id="e1"><code>-e</code></dt>
<dd>

<p>The path file does not exist (perhaps the Feff calculation was not run).</p>

</dd>
<dt id="r1"><code>-r</code></dt>
<dd>

<p>The path file cannot be read.</p>

</dd>
<dt id="spnotexist"><code>spnotexist</code></dt>
<dd>

<p>The <code>sp</code> attribute is not defined or not set to a ScatteringPath or other Path object, and the path is not using a feffNNNN.dat file directly.</p>

</dd>
<dt id="useundef-pp-token"><code>useundef</code> + <code>$pp</code> + <code>$token</code></dt>
<dd>

<p>The math expression for the <code>$pp</code> path parameter contains an undefined parameter, <code>$token</code>.</p>

</dd>
<dt id="binary-pp-token"><code>binary</code> + <code>$pp</code> + <code>$token</code></dt>
<dd>

<p>The math expression for the <code>$pp</code> path parameter contains an unallowed binary math operator, <code>$token</code>.</p>

</dd>
<dt id="function-pp-token"><code>function</code> + <code>$pp</code> + <code>$token</code></dt>
<dd>

<p>The math expression for the <code>$pp</code> path parameter contains a mathematical function unknown to Ifeffit, <code>$token</code>.</p>

</dd>
<dt id="namenotunique1"><code>namenotunique</code></dt>
<dd>

<p>The Ifeffit group name for this path is not unique.</p>

</dd>
<dt id="pathdataname1"><code>pathdataname</code></dt>
<dd>

<p>This path has an Ifeffit/Larch group name which is used by a Data object.</p>

</dd>
<dt id="parens-pp"><code>parens</code> + <code>$pp</code></dt>
<dd>

<p>The math expression for the <code>$pp</code> path parameter has unmatched parentheses.</p>

</dd>
<dt id="reffrmax"><code>reffrmax</code></dt>
<dd>

<p>The R effective for this path is much larger than the <code>rmax</code> value chosen for the fit to the data.</p>

</dd>
<dt id="nocalc"><code>nocalc</code></dt>
<dd>

<p>It seems as though the Feff calculation for this path has not been made yet.</p>

</dd>
</dl>

<h2 id="Problems-with-GDS-objects">Problems with GDS objects</h2>

<dl>

<dt id="notused"><code>notused</code></dt>
<dd>

<p>This is a guess parameter which is not used in the math expressions for any def or path parameters.</p>

</dd>
<dt id="usecv"><code>usecv</code></dt>
<dd>

<p>This is a def parameter which uses the characteristic value (cv). This is not yet allowed for def parameters.</p>

</dd>
<dt id="useundef"><code>useundef</code></dt>
<dd>

<p>The math expression for this GDS parameter uses an undefined parameter name.</p>

</dd>
<dt id="binary-token"><code>binary</code> + <code>$token</code></dt>
<dd>

<p>The math expression for this GDS parameter contains an unallowed binary math operator, <code>$token</code>.</p>

</dd>
<dt id="function-token"><code>function</code> + <code>$token</code></dt>
<dd>

<p>The math expression for this GDS parameter contains a mathematical function unknown to Ifeffit, <code>$token</code>.</p>

</dd>
<dt id="notunique"><code>notunique</code></dt>
<dd>

<p>The name of this GDS parameter is not unique.</p>

</dd>
<dt id="parens"><code>parens</code></dt>
<dd>

<p>The math expression for this GDS parameter has unmatched parentheses.</p>

</dd>
<dt id="progvar"><code>progvar</code></dt>
<dd>

<p>The name of this GDS parameter is an Ifeffit program variable name.</p>

</dd>
<dt id="badchar"><code>badchar</code></dt>
<dd>

<p>The name of this GDS parameter contains an unallowed character. Allowed characters are letters (a-z), numbers (0-9), and underscore (_). The first character must not be a number.</p>

</dd>
<dt id="merge"><code>merge</code></dt>
<dd>

<p>This is an parameter which has been defined twice, possibly from the merge of fitting projects or the creation of two more similar quick first shell fitting models.</p>

</dd>
</dl>

<h2 id="Problems-with-Fit-objects">Problems with Fit objects</h2>

<dl>

<dt id="gds"><code>gds</code></dt>
<dd>

<p>No GDS parameters are defined for this fit</p>

</dd>
<dt id="data"><code>data</code></dt>
<dd>

<p>No data sets are defined for this fit</p>

</dd>
<dt id="paths"><code>paths</code></dt>
<dd>

<p>No paths are defined for this fit</p>

</dd>
<dt id="nvarnidp"><code>nvarnidp</code></dt>
<dd>

<p>This fitting model uses more guess parameters than the available information content of the data.</p>

</dd>
<dt id="nvarys"><code>nvarys</code></dt>
<dd>

<p>This fitting model uses more than Ifeffit&#39;s compiled-in limit of guess parameters (&amp;max_varys).</p>

</dd>
<dt id="nparams"><code>nparams</code></dt>
<dd>

<p>This fitting model uses more than Ifeffit&#39;s compiled-in limit of parameters (&amp;max_scalars).</p>

</dd>
<dt id="nrestraints"><code>nrestraints</code></dt>
<dd>

<p>This fitting model uses more than Ifeffit&#39;s compiled-in limit of restraints (10).</p>

</dd>
<dt id="ndatasets"><code>ndatasets</code></dt>
<dd>

<p>This fitting model uses more than Ifeffit&#39;s compiled-in limit of data sets (&amp;max_data_sets).</p>

</dd>
<dt id="npaths"><code>npaths</code></dt>
<dd>

<p>This fitting model uses more than Ifeffit&#39;s compiled-in limit of paths (&amp;max_paths).</p>

</dd>
<dt id="defaultpath"><code>defaultpath</code></dt>
<dd>

<p>More than one path is flagged as being the default path, making it unclear how to evaluate the log file.</p>

</dd>
<dt id="loop-token"><code>loop</code> + <code>$token</code></dt>
<dd>

<p>The parameter <code>$token</code> refers to itself in its math expression.</p>

</dd>
<dt id="cycle-token"><code>cycle</code> + <code>$token</code></dt>
<dd>

<p>There is a cyclical dependence among a set of parameter math expressions. This cycle is <code>$token</code>.</p>

</dd>
</dl>

<h1 id="CONFIGURATION-AND-ENVIRONMENT">CONFIGURATION AND ENVIRONMENT</h1>

<p>See <a href="../../Demeter.pm.html">Demeter</a> for a description of the configuration system.</p>

<h1 id="BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</h1>

<p>Missing tests:</p>

<ul>

<li><p>Test that every Path is associated with a data set. (Warn, not fatal.)</p>

</li>
<li><p>Test that each data in the data array is properly defined.</p>

</li>
<li><p>Test that every Path points to a real path file</p>

</li>
</ul>

<p>Please report problems to the Ifeffit Mailing List (<a href="http://cars9.uchicago.edu/mailman/listinfo/ifeffit/">http://cars9.uchicago.edu/mailman/listinfo/ifeffit/</a>)</p>

<p>Patches are welcome.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Bruce Ravel, <a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a></p>

<p><a href="http://bruceravel.github.io/demeter/">http://bruceravel.github.io/demeter/</a></p>

<h1 id="LICENCE-AND-COPYRIGHT">LICENCE AND COPYRIGHT</h1>

<p>Copyright (c) 2006-2017 Bruce Ravel (<a href="http://bruceravel.github.io/home">http://bruceravel.github.io/home</a>). All rights reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See <a href="http://metacpan.org/module/perlgpl">perlgpl</a>.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

</div><div class="footer">generated by <a href="http://metacpan.org/module/Pod::ProjectDocs">Pod::ProjectDocs</a></div></body></html>

