#!/usr/bin/perl

=for Copyright
 .
 Copyright (c) 2008-2009, 2012 Bruce Ravel (bravel AT bnl DOT gov).
 All rights reserved.
 .
 This file is free software; you can redistribute it and/or
 modify it under the same terms as Perl itself. See The Perl
 Artistic License.
 .
 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

=cut

use Demeter;
use Getopt::Long;
use Demeter::Constants qw($NUMBER);

my ($feff6, $feff8, $abs, $sg, $p1, $rmax, $cif, $record, $atinp, $wx) = (0, 0, 0, 0, 0, 0, 0, 1, 0, 0);
my $result = GetOptions (
			 "c|cif"    => \$cif,
			 "rec=i"    => \$record,
			 "r|rmax=s" => \$rmax,
			 "6"	    => \$feff6,
			 "8"	    => \$feff8,
			 "a"	    => \$abs,
			 "s"	    => \$sg,
			 "p"	    => \$p1,
			 "atoms"    => \$atinp,
			 "wx"       => \$wx,
			);

if ($wx) {
  wx();
  exit;
};

my @call = ($cif) ? (record=>$record-1, cif => $ARGV[0]) : (file => $ARGV[0]||"atoms.inp");
my $atoms = Demeter::Atoms->new(@call);

my $which = ($feff6) ? "feff6"
          : ($feff8) ? "feff8"
          : ($abs)   ? "absorption"
          : ($sg)    ? "spacegroup"
          : ($p1)    ? "p1"
          : ($atinp) ? "atoms"
          :            "feff6" ;
$atoms -> set(rmax=>$rmax) if ($rmax and $rmax =~ m{\A$NUMBER\z});
print $atoms -> Write($which);


sub wx {
 require Wx;
 require Demeter::UI::Atoms;
 Wx::InitAllImageHandlers();
 my $window = Demeter::UI::Atoms->new;
 $window   -> MainLoop;
};
