<!DOCTYPE HTMP PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Setting up an EXAFS fit</title>
    <link rel="stylesheet" href=../dpg.css />
    <link rel="stylesheet" href=../ppi.css />
    <meta http-equiv="Content-Type" content="text/html"; charset=iso-8859-15 />
    <meta name="robots" contents="all" />
  </head>

  <body>
    <div class=topbar>
  <div class=navbar>
  <a class=navhead href="../index.html">The Demeter Programmer' Guide</a>
  <table class=navtable>
    <tr>
      <td align=left>
        &laquo;<a class=navtable href="http://bruceravel.github.com/demeter/"><span class=programlink>DEMETER</span></a>&raquo; &nbsp;
        &laquo;<a class=navtable href="http://cars9.uchicago.edu/iffwiki/Ifeffit"><span class=programlink>IFEFFIT</span></a>&raquo; &nbsp;
        <!-- [&nbsp;<a class=navtable href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp; -->
        &laquo;<a class=navtable href="http://xafs.org">xafs.org</a>&raquo; &nbsp;
	<!-- [&nbsp;<a class=navtable href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;] -->
      </td>
      <td align=right>
        &nbsp;&nbsp;
        Up: <a class=navtable href="../fit/index.html" class="menu">Fitting EXAFS data</a> &nbsp;&nbsp;
        Next: <a class=navtable href="../fit/sanity.html" class="menu">Sanity checking a fitting model</a>      </td>
    </tr>
  </table>
  </div>
</div>

<div class=sidebar>
  <a href="../ceres.html"><img src=../../images/Isis-Sothis-Demeter_sm.jpg
    width=90% border=0 alt='[Demeter logo]'></a>
  <br />
  <a href="../index.html"  class="menu">Home</a><br />
<a href="../intro.html"  class="menu">Introduction</a><br />
<a href="../data/index.html"  class="menu">Importing data</a><br />
<a href="../mue/index.html"  class="menu">Processing mu(E) data</a><br />
<a href="../xanes/index.html"  class="menu">Analysis of XANES data</a><br />
<a href="../highlevel/index.html"  class="menu">High level actions for Demeter objects</a><br />
<a href="../atoms/index.html"  class="menu">Atoms</a><br />
<a href="../feff/index.html"  class="menu">Feff</a><br />
<a href="../paths/index.html"  class="menu">Scattering paths</a><br />
<a href="../gds/index.html"  class="menu">Guess/Def/Set parameters</a><br />
<a href="../fit/index.html"  class="menuselect">Fitting EXAFS data</a><br />
&nbsp;&#8618;&nbsp;<span style="font-style: italic;">Setting up a fitting model</span><br />
&nbsp;&#8618;&nbsp;<a href="../fit/sanity.html"  class="menu">Sanity checking a fitting model</a><br />
&nbsp;&#8618;&nbsp;<a href="../fit/after.html"  class="menu">After a fit finishes</a><br />
&nbsp;&#8618;&nbsp;<a href="../fit/happiness.html"  class="menu">The non-statistical happiness parameter</a><br /><a href="../perl/index.html"  class="menu">Using perl to create a fitting model</a><br />
<a href="../lgcv.html"  class="menu">Local guess parameters and the characteristic value</a><br />
<a href="../pathlike/index.html"  class="menu">Path-like objects</a><br />
<a href="../su.html"  class="menu">Structural Units</a><br />
<a href="../ui.html"  class="menu">User interfaces</a><br />
<a href="../output.html"  class="menu">Output formats</a><br />
<a href="../examples/index.html"  class="menu">Full examples</a><br />
</div>

<div class=contentarea>


<h1>
  Setting up an EXAFS fit
</h1>

In this section, the examples will reinforce the idea that the Fit
object is simply a collection of Data, Path, and GDS objects.  We have
already seen some of this.  To make a fit, a number of GDS object are
created and the <tt>gds</tt> attribute of the Fit
object is set to an anonymous array containing those GDS objects.
Similarly, the <tt>paths</tt> attribute is set to
an anonymous array containing all the Path objects to be used in the
fit.

This idea of a Fit object containing a collection of other objects
extends to its use for more advanced fitting concepts.  A Fit object
for a multiple data set fit has its <tt>data</tt>
attribute set to an anonymous list of Data objects.  This is shown in
the first example below.

A Fit object involving multiple <span class=program>FEFF</span> calculations is made by
creating some number of Path objects from each <span class=program>FEFF</span> calculation,
then collecting all those Path objects into the 
<tt>paths</tt> attribute of the Fit object.  This
is shown in the second example below.

<hr class=hide />
<a name="multipledatasetfitting">

<h2>  Multiple data set fitting</h2>
</a>

<p>

The following script expands upon the example in the previous section
by expanding the isotropic expansion and correlated Debye fitting
model to a simultaneous refinement of two data sets.  In this example,
two copper foils measurements were made at 10 K and 150 K.  Both are
imported from an <span class=program>ATHENA</span> project file and a Fit object is
established using both data sets.
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="comment">#!/usr/bin/perl
<li></span><span class="keyword">use</span> <span class="word">Demeter</span> <span class="words">qw(:ui=screen)</span><span class="structure">;</span>
<li>
<li><span class="comment">## import an Athena project file with copper metal in it
<li></span><span class="keyword">my</span> <span class="symbol">$prj</span> <span class="operator">=</span> <span class="word">Demeter::Data::Prj</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><span class="word">file</span><span class="operator">=</span><span class="single">'cu_data.prj'</span><span class="structure">);</span>
<li>
<li><span class="comment">## make a Data object and set the FT and fit parameters
<li></span><span class="keyword">my</span> <span class="symbol">@data</span> <span class="operator">=</span> <span class="symbol">$prj</span><span class="operator">-&gt;</span><span class="word">records</span><span class="structure">(</span><span class="number">1</span><span class="operator">,</span> <span class="number">2</span><span class="structure">);</span>
<li><span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span> <span class="operator">-&gt;</span> <span class="word">name</span><span class="structure">(</span><span class="single">'10 K copper data'</span><span class="structure">);</span>
<li><span class="symbol">$data</span><span class="structure">[</span><span class="number">1</span><span class="structure">]</span> <span class="operator">-&gt;</span> <span class="word">name</span><span class="structure">(</span><span class="single">'150 K copper data'</span><span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">@common</span> <span class="operator">=</span> <span class="structure">(</span><span class="word">fft_kmin</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">3</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">fft_kmax</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">14</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">fit_k1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">fit_k3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">bft_rmin</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="float">1.6</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">bft_rmax</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="float">4.3</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">fit_do_bkg</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li><span class="magic">$_</span> <span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="symbol">@common</span><span class="structure">)</span> <span class="word">foreach</span> <span class="symbol">@data</span><span class="structure">;</span>
<li>
<li><span class="comment">## run a Feff calculation on copper metal
<li></span><span class="keyword">my</span> <span class="symbol">$feff</span> <span class="operator">=</span> <span class="word">Demeter::Feff</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">file</span> <span class="operator">=&gt;</span> <span class="double">&quot;cu_metal.inp&quot;</span><span class="structure">);</span>
<li><span class="symbol">$feff</span> <span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="word">workspace</span> <span class="operator">=&gt;</span> <span class="double">&quot;cu_workspace/&quot;</span><span class="operator">,</span> <span class="word">screen</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span><span class="structure">);</span>
<li><span class="symbol">$feff</span> <span class="operator">-&gt;</span> <span class="word">potph</span> <span class="operator">-&gt;</span> <span class="word">pathfinder</span><span class="structure">;</span>
<li><span class="keyword">my</span> <span class="symbol">@list_of_paths</span> <span class="operator">=</span> <span class="symbol">$feff</span><span class="operator">-&gt;</span> <span class="word">list_of_paths</span><span class="structure">;</span>
<li>
<li><span class="comment">## make GDS objects for an isotropic expansion, correlated Debye model fit to copper
<li></span><span class="keyword">my</span> <span class="symbol">@gds</span> <span class="operator">=</span>&nbsp;&nbsp;<span class="structure">(</span><span class="word">Demeter::GDS</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">gds</span> <span class="operator">=&gt;</span> <span class="single">'guess'</span><span class="operator">,</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'alpha10'</span><span class="operator">,</span>&nbsp;&nbsp;<span class="word">mathexp</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Demeter::GDS</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">gds</span> <span class="operator">=&gt;</span> <span class="single">'guess'</span><span class="operator">,</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'alpha150'</span><span class="operator">,</span> <span class="word">mathexp</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Demeter::GDS</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">gds</span> <span class="operator">=&gt;</span> <span class="single">'guess'</span><span class="operator">,</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'amp'</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">mathexp</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Demeter::GDS</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">gds</span> <span class="operator">=&gt;</span> <span class="single">'guess'</span><span class="operator">,</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'enot'</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">mathexp</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Demeter::GDS</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">gds</span> <span class="operator">=&gt;</span> <span class="single">'guess'</span><span class="operator">,</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'theta'</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">mathexp</span> <span class="operator">=&gt;</span> <span class="number">500</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Demeter::GDS</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">gds</span> <span class="operator">=&gt;</span> <span class="single">'set'</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;<span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'sigmm'</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">mathexp</span> <span class="operator">=&gt;</span> <span class="float">0.00052</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li>
<li><span class="comment">## make Path objects for the first 5 paths in copper (3 shell fit)
<li></span><span class="keyword">my</span> <span class="symbol">@paths</span> <span class="operator">=</span> <span class="structure">();</span>
<li><span class="keyword">foreach</span> <span class="keyword">my</span> <span class="symbol">$i</span> <span class="structure">(</span><span class="number">0</span> <span class="operator">..</span> <span class="number">4</span><span class="structure">)</span> <span class="structure">{</span>
<li><span class="comment">&nbsp;&nbsp;## paths for data at 10K
<li></span>&nbsp;&nbsp;<span class="symbol">$paths</span><span class="structure">[</span><span class="symbol">$i</span><span class="structure">]</span> <span class="operator">=</span> <span class="word">Demeter::Path</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">();</span>
<li>&nbsp;&nbsp;<span class="symbol">$paths</span><span class="structure">[</span><span class="symbol">$i</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">set</span><span class="structure">(</span><span class="word">data</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">sp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$list_of_paths</span><span class="structure">[</span><span class="symbol">$i</span><span class="structure">];</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">s02</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'amp'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">e0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'enot'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">delr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'alpha10*reff'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">sigma2</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'debye(10, theta) + sigmm'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li>
<li><span class="comment">&nbsp;&nbsp;## paths for data at 150K
<li></span>&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$j</span> <span class="operator">=</span> <span class="symbol">$i</span><span class="operator">+</span><span class="number">5</span><span class="structure">;</span>
<li>&nbsp;&nbsp;<span class="symbol">$paths</span><span class="structure">[</span><span class="symbol">$j</span><span class="structure">]</span> <span class="operator">=</span> <span class="symbol">$paths</span><span class="structure">[</span><span class="symbol">$i</span><span class="structure">]</span> <span class="operator">-&gt;</span> <span class="word">clone</span><span class="structure">;</span>
<li>&nbsp;&nbsp;<span class="symbol">$paths</span><span class="structure">[</span><span class="symbol">$j</span><span class="structure">]</span> <span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="word">data</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$data</span><span class="structure">[</span><span class="number">1</span><span class="structure">]</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">delr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'alpha150*reff'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">sigma2</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'debye(150, theta) + sigmm'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li><span class="structure">};</span>
<li>
<li><span class="comment">## make a Fit object
<li></span><span class="keyword">my</span> <span class="symbol">$fit</span> <span class="operator">=</span> <span class="word">Demeter::Fit</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">gds</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="cast">\</span><span class="symbol">@gds</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">data</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="cast">\</span><span class="symbol">@data</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">paths</span> <span class="operator">=&gt;</span> <span class="cast">\</span><span class="symbol">@paths</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li>
<li><span class="comment">## do the fit
<li></span><span class="symbol">$fit</span> <span class="operator">-&gt;</span> <span class="word">fit</span><span class="structure">;</span>
<li>
<li><span class="comment">## set up some plotting parameters
<li></span><span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span> <span class="operator">-&gt;</span> <span class="word">po</span> <span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="word">plot_data</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;<span class="word">plot_fit</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">plot_bkg</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;<span class="word">plot_res</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">plot_win</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;<span class="word">plot_run</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">kweight</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">2</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li><span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span> <span class="operator">-&gt;</span> <span class="word">y_offset</span><span class="structure">(</span><span class="number">6</span><span class="structure">);</span>
<li><span class="magic">$_</span> <span class="operator">-&gt;</span> <span class="word">plot</span><span class="structure">(</span><span class="single">'rmr'</span><span class="structure">)</span> <span class="word">foreach</span> <span class="symbol">@data</span><span class="structure">;</span>
<li><span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span> <span class="operator">-&gt;</span> <span class="word">pause</span><span class="structure">;</span>
</ol>
</pre>

<p>

This script bears a strong resemblance to the one in the previous
section.  There are a couple of small differences.  At lines 8-16, two
records are imported from the <span class=program>ATHENA</span> project file.  They both
have parameters set appropriately.  One fewer GDS object at lines
19-25 is defined compared to the previous script.  This is because the
temperature parameter of <span class=program>IFEFFIT</span>'s
<tt>debye</tt> function is explicitly set to the
correct value at lines 43 and 51.
</p>

<p>
The major difference of this multiple data set fitting model is at
line 57.  Both Data objects are supplied to the Fit object.  This is
the fundamental difference between a single and multiple data set fit
-- the number of items in the Fit object's 
<tt>data</tt> attribute.  Very cool!
</p>

<p>
Another major difference is shown at lines 47-52.  In those lines a
set of Path objects is set up and associated with the second Data
object.  At lines 37-44, Path objects are set up for the 10 K data in
identical manner to the script in the previous section.  At line 48,
each Path object is cloned, returning a new Path object with all the same
attributes.  These copies are added to the
<tt>@paths</tt> list, with care taken at line 47
to do the counting correctly.  In lines 49-52, only those parameters
that need to be changed to be appropriate for the 150 K data set are
set to their new values.  At line 49, the cloned paths are
associated with the 150 K Data object.  At lines 50 and 51, the
temperature dependent path parameters are set appropriately.
</p>

<p>
Note that the <tt>sp</tt> atrtibute is 
<strong>not</strong> changed for the cloned paths.  This is
central to <span class=program>DEMETER</span>'s efficient use of <span class=program>FEFF</span>.  The same
ScatteringPath object is used for the Path object associated with the
10 K Data object <strong>and</strong> for the Path object
associated with the 150 K Data object.  This is conceptually equivalent
to using the same 
<span class=file>feffNNNN.dat</span> file in two different path
paragraphs in a <span class=program>FEFFIT</span> input file.
</p>


<table>
<tr>
<td>
<p>

Another impoirtant thing demonstrated by this example is how a fairly
elaborate polot can be generated with a small number of lines of
code.  The plot to the right is what gets made by lines 65-71.  Lines
65-69 set some parameters of the Plot object.  Line 70 sets a vertical
offset for the plot of the 10 K data.  At line 71
<a href="../data/plot.html">Rmr plots</a>
are made for each Data object.  That's a lot of plot for two lines of
code! 
</p>

</td>
<td width=640>
<a href="../../images/cumds.png" target=_blank><img border=0 src="../../images/cumds.png" alt="cumds.png" width=100%></a>
</td>
</tr>
</table>

<hr class=hide />
<a name="usingmultiplefeffcalculations">

<h2>  Using multiple Feff calculations</h2>
</a>

</div>

<br />
<hr class=hide />
<hr class=bottomdivider />

<div class=bottombar>
  <div class=copyright>
  <table>
    <tr>
      <td colspan=2>
        <span class=program>DEMETER</span> is copyright &copy; 2009-2014 Bruce Ravel
        &mdash;
        This document is copyright &copy; 2014 Bruce Ravel
        <br />
      </td>
    </tr>
    <tr valign=middle>
      <td> 
           <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../images/somerights20.png" width="88" height="31" alt="" border="0" /></a> &nbsp;&nbsp;&nbsp;
      </td>
      <td>
  	This document is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">
  	The Creative Commons Attribution-ShareAlike License</a>.
  	<br />
  	If <span class=program>DEMETER</span> and this document are useful to you, please consider
  	<a href="http://creativecommons.org/support/">supporting The Creative Commons</a>.
      </td>
    </tr>
  </table>
</div>
</div>
  </body>
</html>