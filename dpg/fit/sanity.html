<!DOCTYPE HTMP PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Sanity checking the fitting model</title>
    <link rel="stylesheet" href=../ab.css />
    <link rel="stylesheet" href=../ppi.css />
    <meta http-equiv="Content-Type" content="text/html"; charset=iso-8859-15 />
    <meta name="robots" contents="all" />
  </head>

  <body>
    <div class=topbar>
  <div class=navbar>
  <table class=navtable>
    <tr>
      <td align=left>
        [&nbsp;<a href="../index.html">Home</a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://cars9.uchicago.edu/iffwiki/Demeter"><span class=programlink>DEMETER</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://cars9.uchicago.edu/iffwiki/Ifeffit"><span class=programlink>IFEFFIT</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://xafs.org">xafs.org</a>&nbsp;] &nbsp;&nbsp;
	[&nbsp;<a href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;]
      </td>
      <td align=right>
        Back: <a href="../fit/collection.html" class="menu" >Setting up a fitting model</a> &nbsp;&nbsp;
        Next: <a href="../fit/after.html" class="menu" >After a fit finishes</a>
        &nbsp;&nbsp;
        Up: <a href="../fit/index.html" class="menu" >Fitting EXAFS data</a>      </td>
    </tr>
  </table>
  </div>
  <h1>
  Sanity checking the fitting model
</h1>
</div>

<hr class=hide />


<div class=sidebar>
  <a href="../ceres.html"><img src=../../images/Isis-Sothis-Demeter_sm.jpg
    width=100% border=0 alt='[Demeter logo]'></a>
  <br />
  <a href="../index.html" class="menu" >Home</a><br />
<a href="../intro.html" class="menu" >Introduction</a><br />
<a href="../data/index.html" class="menu" >Importing data</a><br />
<a href="../mue/index.html" class="menu" >Processing mu(E) data</a><br />
<a href="../xanes/index.html" class="menu" >Analysis of XANES data</a><br />
<a href="../highlevel/index.html" class="menu" >High level actions for Demeter objects</a><br />
<a href="../atoms/index.html" class="menu" >Atoms</a><br />
<a href="../feff/index.html" class="menu" >Feff</a><br />
<a href="../paths/index.html" class="menu" >Scattering paths</a><br />
<a href="../gds/index.html" class="menu" >Guess/Def/Set parameters</a><br />
<br />
<a href="../fit/index.html" class="menuselect" >Fitting EXAFS data</a><br />
&nbsp;-&nbsp;<a href="../fit/collection.html" class="menu" >Setting up a fitting model</a><br />
&nbsp;-&nbsp;<a href="../fit/sanity.html" class="menuselect" >Sanity checking a fitting model</a><br />
&nbsp;-&nbsp;<a href="../fit/after.html" class="menu" >After a fit finishes</a><br />
&nbsp;-&nbsp;<a href="../fit/happiness.html" class="menu" >The non-statistical happiness parameter</a><br /><br />
<a href="../perl/index.html" class="menu" >Using perl to create a fitting model</a><br />
<a href="../lgcv.html" class="menu" >Local guess parameters and the characteristic value</a><br />
<a href="../pathlike/index.html" class="menu" >Path-like objects</a><br />
<a href="../su.html" class="menu" >Structural Units</a><br />
<a href="../ui.html" class="menu" >User interfaces</a><br />
<a href="../output.html" class="menu" >Output formats</a><br />
<a href="../examples/index.html" class="menu" >Full examples</a><br />
</div>

<p>

A lot happens under the hood when the <tt>fit</tt>
method is called by a Fit object.  One of the first things that
happens is an extensive series of sanity checks on the objects that
make up the fitting model.
</p>

<p>
Here is the complete list of tests that are made on a fitting model:
</p>


<ol>
  
<li>
If Data objects read directly from a column data file (rather than
from, say, an  <span class=program>ATHENA</span> project file, all such  data files included
in the fit must exist. 
</li>
<li>
If Path objects read directly from  <span class=file>feffNNNN.dat</span> files, all such files used in the fit must exist.
</li>
<li>
All guess parameters are used in at least one def parameter or path
parameter.
</li>
<li>
No def or path parameters use parameters which have not been defined.
</li>
<li>
Binary operators are used correctly.  This test specifically checks
that none of these strings appear in a math expression:
<pre>
   ++    --   //   ***   ^^
</pre>
</li>
<li>
All  <span class=program>IFEFFIT</span> function names (i.e. strings that are followed by an
open paren) are valid  <span class=program>IFEFFIT</span> functions.
</li>
<li>
All data and path objects have unique <tt>group</tt>
attributes.  (It is possible for a user to reset this attribute, although
this is considered very bad practice.) 
</li>
<li>
All GDS parameters have unique names.
</li>
<li>
All opening parens are matched by closing parens.
</li>
<li>
Data attribute related to fitting make sense, for example that 
<tt>fft_kmin</tt> is
smaller than <tt>fft_kmax</tt>.
</li>
<li>
The number of guess parameters does not exceed the number of
independent points.
</li>
<li>
The <tt>bft_rmin</tt> value is not greater than 
<tt>bkg_rbkg</tt>.
</li>
<li>
The  R<sub>eff</sub>  of any path is not very far beyond
<tt>bft_rmax</tt>.
</li>
<li>
 <span class=program>IFEFFIT</span>'s hardwired limits on things like the maximum number of guess
parameters and the maximum number of data sets are not exceeded by the
fitting model.
</li>
<li>
No GDS parameters have the names of  <span class=program>IFEFFIT</span> program variables or other
reserved words.
</li>
<li>
No merge parameters remain unresolved.  Merge parameters are GDS
parameters that are in naming conflict in a project that involves
importing structural units or otherwise merging together elements of a
fitting model. As of version 0.4, this is an unimplemented feature. 
</li>
<li>
GDS parameter math expressions are checked to verify that they are
neither self-referential nor part of a cycle of references, e.g. 
<pre>
def a = b
def b = c
def c = d
def d = a
</pre>
</li>
</ol>

<p>

If any of these sanity checks fail for your fitting model, the fit
will not continue and a (hopefully) useful error message will be
issued via  <span class=program>DEMETER</span>'s error reporting system.  For a script run
at the command line, this error message is typically (and by default)
issued to STDERR.  For a Wx application, the warning text will
normally be displayed in a dialog box or elsewhere.  Disposal of the
error text is left as a chore for the end-user application.
</p>


<p class=todo>
<strong>On the to do list:</strong>&nbsp;&nbsp;
There are, as of version 0.4, several missing tests, including:
<ol>
  
<li>
Test that every included Data object has at least 1 Path object
associated with it. 
</li>
<li>
Test that every Path object is associated with a Data object.  This
should be a warning, not an error.  The unassociated Path can simply
be ignored.
</li>
<li>
Test that each Data in the data array is properly defined.
</li>
<li>
Test that every Path points either to a ScatteringPath object or to a
real path file.
</li>
</ol>
</p>

<br />
<hr class=hide />

<div class=bottombar>
  <div class=navbar>
  <table class=navtable>
    <tr>
      <td align=left>
        [&nbsp;<a href="../index.html">Home</a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://cars9.uchicago.edu/iffwiki/Demeter"><span class=programlink>DEMETER</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://cars9.uchicago.edu/iffwiki/Ifeffit"><span class=programlink>IFEFFIT</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://xafs.org">xafs.org</a>&nbsp;] &nbsp;&nbsp;
	[&nbsp;<a href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;]
      </td>
      <td align=right>
        Back: <a href="../fit/collection.html" class="menu" >Setting up a fitting model</a> &nbsp;&nbsp;
        Next: <a href="../fit/after.html" class="menu" >After a fit finishes</a>
        &nbsp;&nbsp;
        Up: <a href="../fit/index.html" class="menu" >Fitting EXAFS data</a>      </td>
    </tr>
  </table>
  </div>
  <div class=copyright>
   <span class=program>DEMETER</span> is copyright &copy; 2009-2011 Bruce Ravel
  <br />
  This document is copyright &copy; 2011 Bruce Ravel
  <br />
  email: (bravel |A|T| bnl |D|O|T| gov)
  <br />
  
  <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../images/somerights20.png" width="88" height="31" alt="" border="0" /></a> &nbsp;&nbsp;&nbsp;
  <br />
  This document is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">
  The Creative Commons Attribution-ShareAlike License</a>.
  <br />
  If  <span class=program>DEMETER</span> and this document are useful to you, please consider
  <a href="http://creativecommons.org/support/">supporting The Creative Commons</a>.
</div>
</div>
  </body>
</html>