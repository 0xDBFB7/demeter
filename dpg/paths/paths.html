<!DOCTYPE HTMP PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Calculating individual scattering paths</title>
    <link rel="stylesheet" href=../dpg.css />
    <link rel="stylesheet" href=../ppi.css />
    <meta http-equiv="Content-Type" content="text/html"; charset=iso-8859-15 />
    <meta name="robots" contents="all" />
  </head>

  <body>
    <div class=topbar>
  <div class=navbar>
  <a class=navhead href="../index.html">The Demeter Programmer' Guide</a>
  <table class=navtable>
    <tr>
      <td align=left>
        &laquo;<a class=navtable href="http://bruceravel.github.com/demeter/"><span class=programlink>DEMETER</span></a>&raquo; &nbsp;
        &laquo;<a class=navtable href="http://cars9.uchicago.edu/iffwiki/Ifeffit"><span class=programlink>IFEFFIT</span></a>&raquo; &nbsp;
        <!-- [&nbsp;<a class=navtable href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp; -->
        &laquo;<a class=navtable href="http://xafs.org">xafs.org</a>&raquo; &nbsp;
	<!-- [&nbsp;<a class=navtable href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;] -->
      </td>
      <td align=right>
        &nbsp;&nbsp;
        Up: <a class=navtable href="../paths/index.html" class="menu">Scattering paths</a> &nbsp;&nbsp;
        Next: <a class=navtable href="../paths/semantic.html" class="menu">Semantic path descriptions</a>      </td>
    </tr>
  </table>
  </div>
</div>

<div class=sidebar>
  <a href="../ceres.html"><img src=../../images/Isis-Sothis-Demeter_sm.jpg
    width=90% border=0 alt='[Demeter logo]'></a>
  <br />
  <a href="../index.html"  class="menu">Home</a><br />
<a href="../intro.html"  class="menu">Introduction</a><br />
<a href="../data/index.html"  class="menu">Importing data</a><br />
<a href="../mue/index.html"  class="menu">Processing mu(E) data</a><br />
<a href="../xanes/index.html"  class="menu">Analysis of XANES data</a><br />
<a href="../highlevel/index.html"  class="menu">High level actions for Demeter objects</a><br />
<a href="../atoms/index.html"  class="menu">Atoms</a><br />
<a href="../feff/index.html"  class="menu">Feff</a><br />
<a href="../paths/index.html"  class="menuselect">Scattering paths</a><br />
&nbsp;&#8618;&nbsp;<span style="font-style: italic;">Calculating individual paths</span><br />
&nbsp;&#8618;&nbsp;<a href="../paths/semantic.html"  class="menu">Semantic path descriptions</a><br />
&nbsp;&#8618;&nbsp;<a href="../paths/pathparams.html"  class="menu">Setting path parameters</a><br />
&nbsp;&#8618;&nbsp;<a href="../paths/plot.html"  class="menu">Plotting individual paths</a><br />
&nbsp;&#8618;&nbsp;<a href="../paths/existing.html"  class="menu">Using an existing Feff calculation</a><br /><a href="../gds/index.html"  class="menu">Guess/Def/Set parameters</a><br />
<a href="../fit/index.html"  class="menu">Fitting EXAFS data</a><br />
<a href="../perl/index.html"  class="menu">Using perl to create a fitting model</a><br />
<a href="../lgcv.html"  class="menu">Local guess parameters and the characteristic value</a><br />
<a href="../pathlike/index.html"  class="menu">Path-like objects</a><br />
<a href="../su.html"  class="menu">Structural Units</a><br />
<a href="../ui.html"  class="menu">User interfaces</a><br />
<a href="../output.html"  class="menu">Output formats</a><br />
<a href="../examples/index.html"  class="menu">Full examples</a><br />
</div>

<div class=contentarea>


<h1>
  Calculating individual scattering paths
</h1>

<p>

After the path finder is run, the Feff object has its
<tt>pathlist</tt> attribute filled with a reference
to a list of ScatteringPath objects.  The ScatteringPath object is an
abstract representation of a scattering path.  In <span class=program>DEMETER</span>, the
ScatteringPath object is somewhat like a 
<span class=file>feffNNNN.dat</span> is to <span class=program>IFEFFIT</span> -- it
does indeed describe the path, but it needs to imported and
parametrized before it can be used to make a plot or a fit.
</p>

<p>
The ScatteringPath object has attributes which describe all the
geometry of the path, including degeneracy, leg lengths, and
scattering angles.  It also has a way of reconstructing the specific
geometry of each degenerate path that gets combined when the path
finder determines path degeneracy.  
</p>

<p>
The methods of the ScatteringPath object include a way of generating
the <span class=file>feffNNNN.dat</span> file containing 
<span class=program>FEFF</span> calculation of the scattering amplitude and phase shift for
the path.  The calculation of the
<span class=file>feffNNNN.dat</span> file is done on-the-fly by 
<span class=program>DEMETER</span> and is written to temporary file in the directory
specified by the <tt>workspace</tt> attribute of
the Feff object from which the ScatteringPath object was created.
That path file has a randomly generated name.  The use of random names
for the path files is intended to sever the link between the index of
the path in <span class=program>FEFF</span> path list and the path file.  That number has
been used in earlier versions of <span class=program>ARTEMIS</span>, but has proven
troublesome in many situations.  As you will see in later chapters, 
<span class=program>DEMETER</span> tries to emphasize semantic descriptions of paths,
eschewing the path index.
</p>

<p>
<span class=program>DEMETER</span> never saves <span class=file>feffNNNN.dat</span>
files when it saves a fitting model to a project file (nor does 
<span class=program>ARTEMIS</span>).  The recalculation of the <span class=file>feffNNNN.dat</span> file is sufficiently fast that it is done when
needed.
</p>

<p>
The main use of the ScatteringPath object is as the value of the 
<tt>sp</tt> attribute of the Path object.  Here is
an example of plotting the 6 shortest paths from a <span class=program>FEFF</span>
calculation.
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="comment">#!/usr/bin/perl
<li></span><span class="keyword">use</span> <span class="word">Demeter</span><span class="structure">;</span>
<li>
<li><span class="keyword">my</span> <span class="symbol">$feff</span> <span class="operator">=</span> <span class="word">Demeter::Feff</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">file</span> <span class="operator">=&gt;</span> <span class="double">&quot;feff/feff.inp&quot;</span><span class="structure">);</span>
<li><span class="symbol">$feff</span> <span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="word">workspace</span> <span class="operator">=&gt;</span> <span class="double">&quot;feff/&quot;</span><span class="operator">,</span> <span class="word">screen</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span><span class="structure">);</span>
<li><span class="symbol">$feff</span> <span class="operator">-&gt;</span> <span class="word">potph</span><span class="structure">;</span>
<li><span class="symbol">$feff</span> <span class="operator">-&gt;</span> <span class="word">pathfinder</span><span class="structure">;</span>
<li>
<li><span class="keyword">my</span> <span class="symbol">@list_of_paths</span> <span class="operator">=</span> <span class="cast">@</span><span class="structure">{</span> <span class="symbol">$feff</span><span class="operator">-&gt;</span> <span class="word">pathlist</span> <span class="structure">};</span>
<li><span class="keyword">foreach</span> <span class="structure">(</span><span class="symbol">@list_of_paths</span><span class="structure">[</span><span class="number">0</span><span class="operator">..</span><span class="number">5</span><span class="structure">])</span> <span class="structure">{</span>
<li>&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$this</span> <span class="operator">=</span> <span class="word">Demeter::Path</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><span class="word">parent</span> <span class="operator">=&gt;</span> <span class="symbol">$feff</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">sp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="magic">$_</span><span class="structure">);</span>
<li>&nbsp;&nbsp;<span class="symbol">$this</span> <span class="operator">-&gt;</span> <span class="word">plot</span><span class="structure">(</span><span class="single">'r'</span><span class="structure">);</span>
<li><span class="structure">};</span>
</ol>
</pre>

<p>

At line 9, the reference to the list of ScatteringPath objects is read
into a normal array (the <tt>@{ }</tt> syntax
dereferences the array).  The first 6 elements of this array is then
looped over and a Path object is created using those 6 ScatteringPath
objects.  Each Path object is then plotted at line 13.
</p>


<hr class=hide />
<a name="writingfeffnnnn.datfiles">

<h2>  Writing feffNNNN.dat files</h2>
</a>

<p>

As demonstrated above, generation of the individual 
<span class=file>feffNNNN.dat</span> files is
something that happens behind the scenes.  <span class=program>DEMETER</span> goes to great
lengths to ensure that you do not need to worry about those
files.  It is certainly possible to write large, complex fitting
programs with <span class=program>DEMETER</span> without ever even thinking about those
files.
</p>

<p>
That said, sometimes you may want to generate 
<span class=file>feffNNNN.dat</span> files.  The Feff object
provides the <tt>genfmt</tt> method.  This is the
method used behind the scenes to generate path files as needed for
plotting or fitting.  This behind-the-scenes chore is quite
efficient.  The individual path file is saved during an instance of
the <span class=program>DEMETER</span> program so it can be reused without being
recalculated.  Even in a scenario where a single ScatteringPath object
is used to define two or more Path objects
(see <a href="../examples/histogram.tt">the histogram example</a>
for an example where this is used to great effect), <span class=program>DEMETER</span> is
clever enough to only compute the path file once.
</p>

<p>
In a scenario where you wish to generate 
<span class=file>feffNNNN.dat</span> files, you can do something
like this:
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="comment">#!/usr/bin/perl&nbsp;&nbsp;<li></span><span class="keyword">use</span> <span class="word">Demeter</span><span class="structure">;</span>
<li>
<li><span class="comment">## Deserialize feff.yaml;
<li></span><span class="keyword">my</span> <span class="symbol">$feff</span> <span class="operator">=</span> <span class="word">Demeter::Feff</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">yaml</span> <span class="operator">=&gt;</span> <span class="double">&quot;feff/feff.yaml&quot;</span><span class="structure">);</span>
<li><span class="symbol">$feff</span><span class="operator">-&gt;</span><span class="word">pathsdat</span><span class="structure">();</span> <span class="comment"># all paths</span>
<li><span class="comment">#$feff-&gt;pathsdat(1,2,6,9); # the first four SS paths
<li></span><span class="symbol">$feff</span><span class="operator">-&gt;</span><span class="word">genfmt</span><span class="structure">;</span>
</ol>
</pre>

<p>

The <tt>pathsdat</tt> method writes a 
<span class=file>paths.dat</span> file to the Feff object's 
<tt>workspace</tt>.  This is the file that the
<em>genfmt</em> part of <span class=program>FEFF</span> uses to define the
geometries of the scattering paths that go into the 
<span class=file>feffNNNN.dat</span> files.  Without an argument,
as at line 6,
all paths found by the path finder are written to the
<span class=file>paths.dat</span> file.  With an argument, as
commented out at line 7, only
the paths listed will be written out.  The path files then generated
by the <tt>genfmt</tt> method will be named 
<span class=file>feffNNNN.dat</span> with the 
<tt>NNNN</tt> replaced by the zero-padded path
index.  This behavior is very similar to the normal behavior of 
<span class=program>FEFF</span> (with the exception of the ability to prescribe a truncated
path list).
</p>

<p>
As great as it is that <span class=program>DEMETER</span> can replicate the stodgy old
behavior of <span class=program>FEFF</span>, I strongly recommend that you avoid doing so.
</p>



<hr class=hide />
<a name="examiningthedegeneratepaths">

<h2>  Examining the degenerate paths</h2>
</a>

<p>

Along with fuzzy degeneracy, the ability to remember the entire list
of scattering geometries contributing to the degeneracy of a path is
one of the major new features <span class=program>DEMETER</span>'s path finder.  If you
ever want to examine the degenerate list, you can do something like
this: 
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="comment">#!/usr/bin/perl&nbsp;&nbsp;<li></span><span class="keyword">use</span> <span class="word">Demeter</span><span class="structure">;</span>
<li>
<li><span class="comment">## Deserializing feff.yaml;
<li></span><span class="keyword">my</span> <span class="symbol">$feff</span> <span class="operator">=</span> <span class="word">Demeter::Feff</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="double">&quot;feff/feff.yaml&quot;</span><span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">@list_of_paths</span> <span class="operator">=</span> <span class="symbol">$feff</span><span class="operator">-&gt;</span><span class="word">pathlist</span><span class="structure">;</span>
<li>
<li><span class="comment">### The 6 scattering geometries that contribute to path #2:
<li></span><span class="keyword">my</span> <span class="symbol">$sp</span> <span class="operator">=</span> <span class="symbol">$list_of_paths</span><span class="structure">[</span><span class="number">1</span><span class="structure">];</span>
<li><span class="keyword">my</span> <span class="symbol">$j</span><span class="operator">=</span><span class="number">1000</span><span class="structure">;</span>
<li><span class="keyword">foreach</span> <span class="keyword">my</span> <span class="symbol">$s</span> <span class="structure">(</span><span class="symbol">$sp</span><span class="operator">-&gt;</span><span class="word">all_strings</span><span class="structure">)</span> <span class="structure">{</span>
<li>&nbsp;&nbsp;<span class="word">print</span> <span class="symbol">$sp</span> <span class="operator">-&gt;</span> <span class="word">pathsdat</span><span class="structure">(</span><span class="word">index</span><span class="operator">=&gt;++</span><span class="symbol">$j</span><span class="operator">,</span> <span class="word">string</span><span class="operator">=&gt;</span><span class="symbol">$s</span><span class="operator">,</span> <span class="word">angles</span><span class="operator">=&gt;</span><span class="number">1</span><span class="structure">);</span>
<li><span class="structure">};</span>
</ol>
</pre>

<p>

What gets printed out is something like this, which is in the form of
a <span class=file>paths.dat</span> file and can be used by the 
<em>genfmt</em> part of <span class=program>FEFF</span>.
</p>


<pre>
  1001    2   6.000  index, nleg, degeneracy, r= 3.6100
      x           y           z     ipot  label      rleg      beta        eta
    3.610000    0.000000    0.000000   1 'Cu_2  '     3.6100  180.0000    0.0000
    0.000000    0.000000    0.000000   0 'abs   '     3.6100  180.0000    0.0000
  1002    2   6.000  index, nleg, degeneracy, r= 3.6100
      x           y           z     ipot  label      rleg      beta        eta
   -3.610000    0.000000    0.000000   1 'Cu_2  '     3.6100  180.0000    0.0000
    0.000000    0.000000    0.000000   0 'abs   '     3.6100  180.0000    0.0000
  1003    2   6.000  index, nleg, degeneracy, r= 3.6100
      x           y           z     ipot  label      rleg      beta        eta
    0.000000    3.610000    0.000000   1 'Cu_2  '     3.6100  180.0000    0.0000
    0.000000    0.000000    0.000000   0 'abs   '     3.6100  180.0000    0.0000
  1004    2   6.000  index, nleg, degeneracy, r= 3.6100
      x           y           z     ipot  label      rleg      beta        eta
    0.000000   -3.610000    0.000000   1 'Cu_2  '     3.6100  180.0000    0.0000
    0.000000    0.000000    0.000000   0 'abs   '     3.6100  180.0000    0.0000
  1005    2   6.000  index, nleg, degeneracy, r= 3.6100
      x           y           z     ipot  label      rleg      beta        eta
    0.000000    0.000000    3.610000   1 'Cu_2  '     3.6100  180.0000    0.0000
    0.000000    0.000000    0.000000   0 'abs   '     3.6100  180.0000    0.0000
  1006    2   6.000  index, nleg, degeneracy, r= 3.6100
      x           y           z     ipot  label      rleg      beta        eta
    0.000000    0.000000   -3.610000   1 'Cu_2  '     3.6100  180.0000    0.0000
    0.000000    0.000000    0.000000   0 'abs   '     3.6100  180.0000    0.0000
</pre>

<p>

In truth, <span class=program>DEMETER</span> does not do much with the list of degerate
scattering geometries at this time.  In the future, I hope to
incorporate an ability to propagate a strctural distortion through
the degerate paths to examine the effect of broken degeneracy on the
calculated or fitted &chi;(k).
</p>

</div>

<br />
<hr class=hide />
<hr class=bottomdivider />

<div class=bottombar>
  <div class=copyright>
  <table>
    <tr>
      <td colspan=2>
        <span class=program>DEMETER</span> is copyright &copy; 2009-2012 Bruce Ravel
        &mdash;
        This document is copyright &copy; 2012 Bruce Ravel
        <br />
      </td>
    </tr>
    <tr valign=middle>
      <td> 
           <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../images/somerights20.png" width="88" height="31" alt="" border="0" /></a> &nbsp;&nbsp;&nbsp;
      </td>
      <td>
  	This document is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">
  	The Creative Commons Attribution-ShareAlike License</a>.
  	<br />
  	If <span class=program>DEMETER</span> and this document are useful to you, please consider
  	<a href="http://creativecommons.org/support/">supporting The Creative Commons</a>.
      </td>
    </tr>
  </table>
</div>
</div>
  </body>
</html>