<!DOCTYPE HTMP PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Command disposal and command templates</title>
    <link rel="stylesheet" href=../ab.css />
    <link rel="stylesheet" href=../ppi.css />
    <meta http-equiv="Content-Type" content="text/html"; charset=iso-8859-15 />
    <meta name="robots" contents="all" />
  </head>

  <body>
    <div class=topbar>
  <div class=navbar>
  <table class=navtable>
    <tr>
      <td align=left>
        [&nbsp;<a href="../index.html">Home</a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://cars9.uchicago.edu/iffwiki/Demeter"><span class=programlink>DEMETER</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://cars9.uchicago.edu/iffwiki/Ifeffit"><span class=programlink>IFEFFIT</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://xafs.org">xafs.org</a>&nbsp;] &nbsp;&nbsp;
	[&nbsp;<a href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;]
      </td>
      <td align=right>
        Next: <a href="../highlevel/mode.html" class="menu" >The Mode object</a>
        &nbsp;&nbsp;
        Up: <a href="../highlevel/index.html" class="menu" >High level actions for Demeter objects</a>      </td>
    </tr>
  </table>
  </div>
  <h1>
  Command disposal and command templates
</h1>
</div>

<hr class=hide />


<div class=sidebar>
  <a href="../ceres.html"><img src=../../images/Isis-Sothis-Demeter_sm.jpg
    width=100% border=0 alt='[Demeter logo]'></a>
  <br />
  <a href="../index.html" class="menu" >Home</a><br />
<a href="../intro.html" class="menu" >Introduction</a><br />
<a href="../data/index.html" class="menu" >Importing data</a><br />
<a href="../mue/index.html" class="menu" >Processing mu(E) data</a><br />
<a href="../xanes/index.html" class="menu" >Analysis of XANES data</a><br />
<br />
<a href="../highlevel/index.html" class="menuselect" >High level actions for Demeter objects</a><br />
&nbsp;-&nbsp;<a href="../highlevel/dispose.html" class="menuselect" >Command disposal and command templates</a><br />
&nbsp;-&nbsp;<a href="../highlevel/mode.html" class="menu" >The Mode object</a><br />
&nbsp;-&nbsp;<a href="../highlevel/plot.html" class="menu" >The Plot object</a><br />
&nbsp;-&nbsp;<a href="../highlevel/config.html" class="menu" >The Config object</a><br />
&nbsp;-&nbsp;<a href="../highlevel/methods.html" class="menu" >Other high level methods</a><br /><br />
<a href="../atoms/index.html" class="menu" >Atoms</a><br />
<a href="../feff/index.html" class="menu" >Feff</a><br />
<a href="../paths/index.html" class="menu" >Scattering paths</a><br />
<a href="../gds/index.html" class="menu" >Guess/Def/Set parameters</a><br />
<a href="../fit/index.html" class="menu" >Fitting EXAFS data</a><br />
<a href="../perl/index.html" class="menu" >Using perl to create a fitting model</a><br />
<a href="../lgcv.html" class="menu" >Local guess parameters and the characteristic value</a><br />
<a href="../pathlike/index.html" class="menu" >Path-like objects</a><br />
<a href="../su.html" class="menu" >Structural Units</a><br />
<a href="../ui.html" class="menu" >User interfaces</a><br />
<a href="../output.html" class="menu" >Output formats</a><br />
<a href="../examples/index.html" class="menu" >Full examples</a><br />
</div>

<p>

 <span class=program>DEMETER</span> uses a highly abstract system for communicating with 
 <span class=program>FEFF</span>,  <span class=program>IFEFFIT</span>, and the plotting .  The 
<a href="http://search.cpan.org/~mjd/Text-Template/">Text::Template</a>
module is used along with a large number of small, external template
files.  The idea behind 
<a href="http://search.cpan.org/~mjd/Text-Template/">Text::Template</a>
is quite simple.  Perl code is interspersed with normal text.  A pass
over the text is made and the perl code is evaluated.  In this way, a
bit of text is made that is specifically relevant to a particular
situation.  As an example, here is the template that  <span class=program>DEMETER</span>
uses to construct the  <span class=program>IFEFFIT</span> command used to normalize the 
 &mu;(E)     data associated with a Data object.
</p>


<pre>
{ # -*- ifm -*-
  # pre-edge template
  #   {$D->group} returns the ifeffit group name
  #   {$D->parameter} returns the value of that parameter
}

pre_edge("{$D->group}.energy+{$D->bkg_eshift}", 
         {$D->group}.xmu, 
         e0         = {$D->bkg_e0},
         pre1       = {$D->bkg_pre1}, 
         pre2       = {$D->bkg_pre2}, 
         norm_order = {$D->bkg_nnorm},
	 norm1      = {$D->bkg_nor1}, 
         norm2      = {$D->bkg_nor2})
</pre>

<p>

In this example, <tt>$D</tt> represents the Data
object.  Thus  <span class=program>IFEFFIT</span>'s <tt>pre-edge</tt>
command is filled in ith attribute values apprporiate to the current
Data object.
</p>

<p>
The text generated from the processing of the template is then
disposed of via one or more avenues, one of which may include sending
the text to  <span class=program>IFEFFIT</span> for processing.
</p>

<p>
This section explains all of the disposal and templating options
available to a  <span class=program>DEMETER</span> program.
</p>


<a name="commanddisposal">

<h3>  Command disposal</h3>
</a>

<p>

Once commands have been processed using the templating system, there
are seevral avenues for disposing of those commands.  The most obvious
avenue is to send the commands to  <span class=program>IFEFFIT</span> so that the actual
data can be processed.  However, several other options are possible.
</p>

<p>
The <tt>dispose</tt> method is a method of the base
class and inherited by all objects.  It is used all throughout 
 <span class=program>DEMETER</span> to get things done and is available for explicit use in
 <span class=program>DEMETER</span> programs.  The syntax is quite simple:
</p>


<ol class=perlsample>
<br />
&nbsp;&nbsp;<span class="symbol">$any_object</span> <span class="operator">-&gt;</span> <span class="word">dispose</span><span class="structure">(</span><span class="symbol">$text</span><span class="structure">);</span><br />
&nbsp;&nbsp;<span class="symbol">$any_object</span> <span class="operator">-&gt;</span> <span class="word">dispose</span><span class="structure">(</span><span class="symbol">$text</span><span class="operator">,</span> <span class="single">'plotting'</span><span class="structure">);</span>
</ol>

<p>

The first line is used for any data processing command.  The second
form, with the second argument to the method, is used to identify
command text which is explicitly used to make plots.  When using the
PGPLOT plotting back end, there is not actually a significant
difference between plotting and non-plotting commands since 
 <span class=program>IFEFFIT</span> is used to send command to PGPLOT.  However, when using
other plotting backends, it is essential that plotting commands be
apprpriately flagged.  Plotting backends are discussed in more detail
in <a href="../ui.html">the user interface chapter</a>.
</p>

<p>
The <tt>$text</tt> given as an argument to the 
<tt>dispose</tt> method typically comes from the
evaluation of a template, but can be any text generated in any
fashion.  Thus, it is a completely generic way for a program to
communicate with  <span class=program>DEMETER</span>'s backends.
</p>

<p>
The targets of the <tt>dispose</tt> method are set
using the <tt>set_mode</tt> method, another method
of the base class which is inherited by all objects.  The syntax of
<tt>set_mode</tt> is consistent with other 
methods in  <span class=program>DEMETER</span>:
</p>


<ol class=perlsample>
<br />
&nbsp;&nbsp;<span class="symbol">$any_object</span> <span class="operator">-&gt;</span> <span class="word">set_mode</span><span class="structure">(</span><span class="word">screen</span><span class="operator">=&gt;</span><span class="number">1</span><span class="operator">,</span> <span class="word">ifeffit</span><span class="operator">=&gt;</span><span class="number">1</span><span class="structure">);</span>
</ol>

<p>

Any command can be sent to multiple targets.
The disposal targets which can be set using <tt>set_mode</tt> are:
</p>


<dl>
  
<dt>
  ifeffit
</dt>
<dd>
When true, commands will be sent to  <span class=program>IFEFFIT</span>.  It is often useful
to turn this disposal target off when debugging  <span class=program>DEMETER</span> programs.
  <br />
  <br />
</dd>
<dt>
  screen
</dt>
<dd> When true, commands will be sent
to standard output (usually the screen).  Turning this disposal target
on is often useful  when debugging  <span class=program>DEMETER</span> programs.
  <br />
  <br />
</dd>
<dt>
  plotscreen
</dt>
<dd> When true, plotting commands
will be sent to standard output (usually the screen).  Turning this
disposal target 
on is ofetn useful  when debugging  <span class=program>DEMETER</span> programs.
  <br />
  <br />
</dd>
<dt>
  repscreen
</dt>
<dd> When true, the reprocessed
commands (discussed below) will be sent to standard output (usually the screen).
  <br />
  <br />
</dd>
<dt>
  file
</dt>
<dd> When set to a string value, that
string will be interpretted as a file name to be opened for writing
and the commands will then be written to that file.  To append text to a
file, the <tt>file</tt> mode string should begin
with the <tt>></tt> character.
  <br />
  <br />
</dd>
<dt>
  plotfile
</dt>
<dd> When set to a string value, that
string will be interpretted as a file name to be opened for writing
and the plotting commands will then be written to that file.  To
append text to a 
file, the <tt>file</tt> mode string should begin
with the <tt>></tt> character.
  <br />
  <br />
</dd>
<dt>
  repfile
</dt>
<dd>  When set to a string value, that
string will be interpretted as a file name to be opened for writing
and the reprocessed commands (discussed below)will then be written to
that file.  To append text to a 
file, the <tt>file</tt> mode string should begin
with the <tt>></tt> character.
  <br />
  <br />
</dd>
<dt>
  buffer
</dt>
<dd> When set to an array reference,
commands will be pushed onto that array.  When set to a scalar
reference, commands will be concatinated to the end of the strings
held by the scalar. 
  <br />
  <br />
</dd>
<dt>
  plotbuffer
</dt>
<dd> When set to an array reference,
plotting commands will be pushed onto that array.  When set to a scalar
reference, plotting commands will be concatinated to the end of the strings
held by the scalar. 
  <br />
  <br />
</dd>
<dt>
  callback
</dt>
<dd> When set to a code reference,
the text of the command will be sent to that code reference as the
sole argument.  This is useful for user interfaces that want to
post-process the commands.  For example, this disposal mode is used by
 <span class=program>ARTEMIS</span> to display colorized text in its command buffer.
  <br />
  <br />
</dd>
<dt>
  plotcallback
</dt>
<dd> When set to a code reference,
the text of the plotting command will be sent to that code reference as the
sole argument.  This is useful for user interfaces that want to
post-process the commands.  For example, this disposal mode is used by
 <span class=program>ARTEMIS</span> to display colorized text in its plotting buffer.
  <br />
  <br />
</dd>
<dt>
  feedback
</dt>
<dd> When set to a code reference,
the text of  <span class=program>IFEFFIT</span>'s response to commands will be sent to that
code reference as the 
sole argument.  This is useful for user interfaces that want to
post-process the commands.  For example, this disposal mode is used by
 <span class=program>ARTEMIS</span> to display colorized text in its command buffer.
  <br />
  <br />
</dd>
</dl>

<a name="reprocessedcommands">

<h3>  Reprocessed commands</h3>
</a>

<p>

 <span class=program>DEMETER</span> tries to use  <span class=program>IFEFFIT</span> as efficiently as possibly.
On one hand,  <span class=program>IFEFFIT</span> the one of the things that makes 
 <span class=program>DEMETER</span> go and so is indispensible.  On the other hand, the
business of communicating between perl code and the  <span class=program>IFEFFIT</span>
library is 
(<a href="../feff/pathfinder.html">with one exception</a>)
always the slowest thing that  <span class=program>DEMETER</span> does.  One of the
optimizations implemented by  <span class=program>DEMETER</span> is the reprocessing of
commands targeted for disposal to  <span class=program>IFEFFIT</span>.
</p>

<p>
Command strings in  <span class=program>IFEFFIT</span> can be quite long -- up to 2048
characters as it is normally compiled.  A command that is split over
multiple lines, as the example at the beginning of this section is,
will be processed much faster if  <span class=program>DEMETER</span> pre-processes the
command to remove unnecessary line breaks.  Basically this means that
everything between parentheses will be sent to  <span class=program>IFEFFIT</span> as a
single string.  This is accomplished within the <tt>dispose</tt> method via the application of a few regular
expressions.  The reprocessed string is then sent to  <span class=program>IFEFFIT</span>.
</p>

<p>
As a small example of how reprocessing works, this human-friendly
command:
</p>


<pre>
pre_edge("data0.energy+0",
         data0.xmu,
         e0         = -9999999,
         pre1       = -150,
         pre2       = -30,
         norm_order = 3,
         norm1      = 150,
         norm2      = 1800)                                                                                            
</pre>

<p>

will be reprocessed into this one-line command before being shuffled
off to  <span class=program>IFEFFIT</span>.
</p>


<pre>
pre_edge("data0.energy+0", data0.xmu, e0=-9999999, pre1=-150, pre2=-30, norm_order=3, norm1=150, norm2=1800)
</pre>

<p>

which, when summed over dozens or hundreds of  <span class=program>IFEFFIT</span> commands,
results in a substantial performance improvement.
</p>

<p>
The <tt>repscreen</tt> and 
<tt>repfile</tt> disposal targets are provided to
debug the behavior of this optimization.  Reprocessing is quite well
tested.  However, if you suspect that reprocessing is damaging the
commands sent to  <span class=program>IFEFFIT</span>, use one of those disposal channels to
see the text that is actually being sent.
</p>



<a name="commandtemplates">

<h3>  Command templates</h3>
</a>

<p>

 <span class=program>DEMETER</span> ships with <strong>a lot</strong> of templates.
Each template encapsulates a small bit of functionality and 
 <span class=program>DEMETER</span> does many things.  The
templates are organized into
&ldquo;template sets&rdquo;, which are written for
specific backend targets, and 
&ldquo;template groups&rdquo; which, are groups of
templates which serve related functions.  All template sets must
have a complete representation of template groups to be fully
functional.
</p>

<p>
The templates are found in <span class=file>lib/templates/</span>
directory underneath the installation location of the  <span class=program>DEMETER</span>
package.  One of the reasons for explaining the templating system in
this level of detail is to underscore that it is quite possible to add
new template sets.  By following the model of the existing template
sets, new output types can be created for  <span class=program>DEMETER</span>.  Indeed, when
 <span class=program>IFEFFIT2</span> finally makes its appearence, it should be relatively
simple to extend  <span class=program>DEMETER</span> to use it simply by creating an
apprporiate template set.
</p>

<p>
Choosing between template sets is one of the topics of 
<a href="mode.html">the next section</a>.
</p>


<a name="templatesets">

<h4>  Template sets</h4>
</a>

<p>

Template sets describe backend targets for disposed commands.  There
are four different categories of template sets:
</p>


<ol>
  
<li>
Data processing commands
</li>
<li>
Plotting commands
</li>
<li>
 <span class=program>FEFF</span> input templates
</li>
<li>
 <span class=program>ATOMS</span> input templates
</li>
</ol>

<p>

 <span class=program>DEMETER</span> currently ships with four different sets in the data
processing category.  
</p>


<ol>
  
<li>
<tt><u>ifeffit</u></tt>, templates which write the syntax
of  <span class=program>IFEFFIT</span> is a compact form.
</li>
<li>
<tt><u>iff_columns</u></tt>, templates which write the syntax
of  <span class=program>IFEFFIT</span> is a more human-readable form.
</li>
<li>
<tt><u>feffit</u></tt>, templates which write the syntax
of input files for the old  <span class=program>FEFFIT</span> program.
</li>
<li>
<tt><u>demeter</u></tt>, templates which write out perl
syntax using  <span class=program>DEMETER</span>.
</li>
</ol>

<p>

The <tt>demeter</tt> category might seem a bit
strange.  Its purpose is, indeed, to allow  <span class=program>DEMETER</span> programs to
write  <span class=program>DEMETER</span> programs.  The intent is to allow a GUI to export
a file containing a  <span class=program>DEMETER</span> program that can be used to make a
fit using the same fitting model that was created using the GUI.
</p>

<p>
The possibility of having these different output targets is the main
reason for using a templating system.  Having command creation
containined in these small template files separate from the code may
seem like an unnecessary layer of abstraction and misdirection, but it
offers  <span class=program>DEMETER</span> a lot of flexibility and power.  This is even
more evident for the plotting backends.
</p>

<p>
 <span class=program>DEMETER</span> currently ships with three different sets in the plotting
category.  More information about plotting backends can be found in
<a href="../ui.html">the user interface chapter</a>.
</p>


<ol>
  
<li>
<tt><u>pgplot</u></tt>, templates which write the syntax
of  <span class=program>IFEFFIT</span> plotting commands, which talk directly to PGPLOT.
</li>
<li>
<tt><u>gnuplot</u></tt>, templates which write Gnuplot
plotting scripts.  Using Gnuplot involves writing lots of temporary
files which contain the data to be plotted.  It also requires that
Gnuplot be installed on your computer, which is something that you
have to do separate from the installation of  <span class=program>DEMETER</span>.
</li>
<li>
<tt><u>singlefile</u></tt>, this set of templates is used
to export the data to be plotted to a single column file.  The main
use of this is in a GUI to exprt a file that can be used to replicate
an interesting plot -- with offsets, energy shifts, and scaling
factors -- in an external plotting program.
</li>
</ol>

<p>

In the future, I would like to add more plotting backends to
 <span class=program>DEMETER</span>.  Certainly, any of the plot creation tools from CPAN
(such as 
<a href="http://search.cpan.org/~lds/GD/">GD</a>
or
<a href="http://search.cpan.org/~chartgrp/Chart/">Chart</a>)
would be possible, as would something like
<a href="http://plasma-gate.weizmann.ac.il/Grace/">Grace</a>,
which uses a text file as its input.
</p>

<p>
 <span class=program>DEMETER</span> currently ships with two different sets in the  <span class=program>FEFF</span>
input template category, one for  <span class=program>FEFF6</span> and one for  <span class=program>FEFF8</span>.
(Actually the  <span class=program>FEFF8</span> set has not yet been written at the time
this document is being written.  In fact,  <span class=program>DEMETER</span>'s  <span class=program>FEFF8</span>
interface has not yet been started.
</p>

<p>
There is only one set in the  <span class=program>ATOMS</span> input template category.  It
seems unlikely that other sets will actually be required.
</p>


<a name="templategroups">

<h4>  Template groups</h4>
</a>

<p>

Template groups define related chores.  These chores are
</p>


<ol>
  
<li>
<tt><u>process</u></tt>: all data processing chores that
do not involve fitting  &chi;(k)    data or doing any other sort of data
analysis. 
</li>
<li>
<tt><u>fit</u></tt>: all chores associated with fitting
 &chi;(k)    data.
</li>
<li>
<tt><u>analysis</u></tt>: all analysis chores other than
those associated with fitting  &chi;(k)    data.  This might include
things like linear combination fitting. principle component analysis,
or log-ration/phase-difference analysis.
</li>
<li>
<tt><u>plot</u></tt>: all chore associated with plotting data
</li>
</ol>

<p>

The first four groups must be provided completely by any template set.
Although if a template is missing from a template set,  <span class=program>DEMETER</span>
will fall back to using the template for that chore found in the 
<tt>ifeffit</tt> set.
</p>


<a name="thetemplatemethod">

<h4>  The template method</h4>
</a>

<p>

When the <tt>template</tt> method is called, a
number of variables are set for use in the template.  These variables
are set appropriately for the contect in which the 
<tt>template</tt> method is called.  You can see
one example of this in the example at the beginning of this section.
The <tt>$D</tt> variable represents the Data object
relevant to the context in which that template is evaluated.  Some
more examples will be seen below.
</p>

<p>
Here is the complete list of these special variables.
</p>


<dl>
  
<dt>
  $S
</dt>
<dd> 
This is the &ldquo;self&rdquo; object, i.e. the object
that called the <tt>template</tt> method.
  <br />
  <br />
</dd>
<dt>
  $D
</dt>
<dd> 
The is the Data object of the calling object.  When a Data object is
the caller, <tt>$S</tt> and <tt>$D</tt>
are the same thing.  For a Path object as <tt>$S</tt>,
<tt>$D</tt> is its associated Data object.
  <br />
  <br />
</dd>
<dt>
  $P
</dt>
<dd> 
This is the Plot object.
  <br />
  <br />
</dd>
<dt>
  $C
</dt>
<dd> 
This is the Config object.
  <br />
  <br />
</dd>
<dt>
  $F
</dt>
<dd> 
This is the currently active Fit object.
  <br />
  <br />
</dd>
<dt>
  $DS
</dt>
<dd> 
This is the currently active Data standard.
  <br />
  <br />
</dd>
<dt>
  $T
</dt>
<dd> 
This is the currently active Feff (i.e. theory) object.
  <br />
  <br />
</dd>
<dt>
  $PT
</dt>
<dd> 
This is the currently active Path object.
  <br />
  <br />
</dd>
</dl>

<p>

The syntax of the <tt>template</tt> method is
relatively simple.  The method takes two arguments, the first
identifying the template group, the second identifying the chore
that the template performs.  Identifying the specific template also
requires the template set, which is an attribute of the 
<a href="mode.html">Mode group</a>.
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="keyword">my</span> <span class="symbol">$string</span> <span class="operator">=</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">template</span><span class="structure">(</span><span class="double">&quot;process&quot;</span><span class="operator">,</span> <span class="double">&quot;fft&quot;</span><span class="structure">);</span>
<li><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">dispose</span><span class="structure">(</span><span class="symbol">$string</span><span class="structure">);</span>
</ol>
</pre>

<p>

In this example, the command to make a forward Fourier transform using
the current template set is generated by evaluating the appropriate
template.  The text of this command is then passed to the 
<tt>dispose</tt> method.
</p>

<p>
Some templates require data that is not normally available from any
attribute of any object.  There are two ways of addressing that
situation.  One is to store an arbitrarily named attribute in the
Config object.  This is done like so:
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="symbol">$config</span><span class="operator">-&gt;</span><span class="word">set</span><span class="structure">(</span><span class="word">conv_type</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$args</span><span class="structure">{</span><span class="word">type</span><span class="structure">}</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">conv_width</span> <span class="operator">=&gt;</span> <span class="symbol">$args</span><span class="structure">{</span><span class="word">width</span><span class="structure">}</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">conv_which</span> <span class="operator">=&gt;</span> <span class="symbol">$args</span><span class="structure">{</span><span class="word">which</span><span class="structure">}</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">$string</span> <span class="operator">=</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">template</span><span class="structure">(</span><span class="double">&quot;process&quot;</span><span class="operator">,</span> <span class="double">&quot;convolve&quot;</span><span class="structure">);</span>
<li><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">dispose</span><span class="structure">(</span><span class="symbol">$string</span><span class="structure">);</span>
</ol>
</pre>

<p>

Here three scalars related to data covolution are set in the Config
object.  Here is how those scalars are used:
</p>


<pre>
{
  $x = ($C->get("conv_which") eq 'xmu') ? 'energy' : 'k';
  $type = 'gconvolve';
  ($type = 'lconvolve') if (lc($C->get("conv_type")) =~ m{\Al});
  q{}
}
##|
##| convolution {$D->group}
set {$D->group}.{$C->get("conv_which")} = {$type}({$D->group}.{$x}, {$D->group}.{$C->get("conv_which")}, {$C->get("conv_width")})
##|
</pre>

<p>

Note that this example uses the <tt>$C</tt> special
template variable to access the Config object and the Config object's
<tt>get</tt> method to oibjtain the values of these
arbitrarily named scalars.
</p>

<p>
The other approach to passing arbitrary data to a template is to
provide a hash reference as the third argument of the 
<tt>template</tt> method.
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="symbol">$command</span> <span class="operator">=</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">template</span><span class="structure">(</span><span class="double">&quot;plot&quot;</span><span class="operator">,</span> <span class="double">&quot;marker&quot;</span><span class="operator">,</span> <span class="structure">{</span> <span class="word">x</span> <span class="operator">=&gt;</span> <span class="symbol">$xx</span><span class="operator">,</span> <span class="single">'y'</span><span class="operator">=&gt;</span> <span class="symbol">$y</span> <span class="structure">});</span>
</ol>
</pre>

<p>

These user-defined parameters are then accessed by name in the
template.  This example also shows the use of the 
<tt>$P</tt> special variable to make reference to
the Plot object.
</p>


<pre>
plot_marker({$x}, {$y}, marker={$P->markertype}, color={$P->markercolor})
</pre>

<br />
<hr class=hide />

<div class=bottombar>
  <div class=navbar>
  <table class=navtable>
    <tr>
      <td align=left>
        [&nbsp;<a href="../index.html">Home</a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://cars9.uchicago.edu/iffwiki/Demeter"><span class=programlink>DEMETER</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://cars9.uchicago.edu/iffwiki/Ifeffit"><span class=programlink>IFEFFIT</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp;&nbsp;
        [&nbsp;<a href="http://xafs.org">xafs.org</a>&nbsp;] &nbsp;&nbsp;
	[&nbsp;<a href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;]
      </td>
      <td align=right>
        Next: <a href="../highlevel/mode.html" class="menu" >The Mode object</a>
        &nbsp;&nbsp;
        Up: <a href="../highlevel/index.html" class="menu" >High level actions for Demeter objects</a>      </td>
    </tr>
  </table>
  </div>
  <div class=copyright>
   <span class=program>DEMETER</span> is copyright &copy; 2009-2010 Bruce Ravel
  <br />
  This document is copyright &copy; 2010 Bruce Ravel
  <br />
  email: (bravel |A|T| bnl |D|O|T| gov)
  <br />
  
  <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../images/somerights20.png" width="88" height="31" alt="" border="0" /></a> &nbsp;&nbsp;&nbsp;
  <br />
  This document is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">
  The Creative Commons Attribution-ShareAlike License</a>.
  <br />
  If  <span class=program>DEMETER</span> and this document are useful to you, please consider
  <a href="http://creativecommons.org/support/">supporting The Creative Commons</a>.
</div>
</div>
  </body>
</html>