<!DOCTYPE HTMP PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Merging data</title>
    <link rel="stylesheet" href=../dpg.css />
    <link rel="stylesheet" href=../ppi.css />
    <meta http-equiv="Content-Type" content="text/html"; charset=iso-8859-15 />
    <meta name="robots" contents="all" />
  </head>

  <body>
    <div class=topbar>
  <div class=navbar>
  <a class=navhead href="../index.html">The Demeter Programmer' Guide</a>
  <table class=navtable>
    <tr>
      <td align=left>
        &laquo;<a class=navtable href="http://bruceravel.github.io/demeter/"><span class=programlink>DEMETER</span></a>&raquo; &nbsp;
        &laquo;<a class=navtable href="http://cars9.uchicago.edu/iffwiki/Ifeffit"><span class=programlink>IFEFFIT</span></a>&raquo; &nbsp;
        <!-- [&nbsp;<a class=navtable href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp; -->
        &laquo;<a class=navtable href="http://xafs.org">xafs.org</a>&raquo; &nbsp;
	<!-- [&nbsp;<a class=navtable href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;] -->
      </td>
      <td align=right>
        Back: <a class=navtable href="../mue/align.html" class="menu">Aligning data</a> &nbsp;&nbsp;
        &nbsp;&nbsp;
        Up: <a class=navtable href="../mue/index.html" class="menu">Processing mu(E) data</a> &nbsp;&nbsp;
        Next: <a class=navtable href="../mue/deglitch.html" class="menu">Deglitching data</a>      </td>
    </tr>
  </table>
  </div>
</div>

<div class=sidebar>
  <a href="../ceres.html"><img src=../../images/Isis-Sothis-Demeter_sm.jpg
    width=90% border=0 alt='[Demeter logo]'></a>
  <br />
  <a href="../index.html"  class="menu">Home</a><br />
<a href="../intro.html"  class="menu">Introduction</a><br />
<a href="../data/index.html"  class="menu">Importing data</a><br />
<a href="../mue/index.html"  class="menuselect">Processing mu(E) data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/align.html"  class="menu">Aligning data</a><br />
&nbsp;&#8618;&nbsp;<span style="font-style: italic;">Merging data</span><br />
&nbsp;&#8618;&nbsp;<a href="../mue/deglitch.html"  class="menu">Deglitching data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/truncate.html"  class="menu">Truncating data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/noise.html"  class="menu">Adding artificial noise to data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/smooth.html"  class="menu">Smoothing data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/convolve.html"  class="menu">Convolving data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/deconvolve.html"  class="menu">Deconvolving data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/rebin.html"  class="menu">Rebinning data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/dispersive.html"  class="menu">Processing dispersive XAS data</a><br /><a href="../xanes/index.html"  class="menu">Analysis of XANES data</a><br />
<a href="../highlevel/index.html"  class="menu">High level actions for Demeter objects</a><br />
<a href="../atoms/index.html"  class="menu">Atoms</a><br />
<a href="../feff/index.html"  class="menu">Feff</a><br />
<a href="../paths/index.html"  class="menu">Scattering paths</a><br />
<a href="../gds/index.html"  class="menu">Guess/Def/Set parameters</a><br />
<a href="../fit/index.html"  class="menu">Fitting EXAFS data</a><br />
<a href="../perl/index.html"  class="menu">Using perl to create a fitting model</a><br />
<a href="../lgcv.html"  class="menu">Local guess parameters and the characteristic value</a><br />
<a href="../pathlike/index.html"  class="menu">Path-like objects</a><br />
<a href="../su.html"  class="menu">Structural Units</a><br />
<a href="../ui.html"  class="menu">User interfaces</a><br />
<a href="../output.html"  class="menu">Output formats</a><br />
<a href="../examples/index.html"  class="menu">Full examples</a><br />
</div>

<div class=contentarea>


<h1>
  Merging data
</h1>

<p>

Merging data is one of the essential data processing steps.  As with
every thing, <span class=program>DEMETER</span> tries to make merging as easy as possible:
</p>


<ol class=perlsample>
<br />
&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$merged</span> <span class="operator">=</span> <span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">merge</span><span class="structure">(</span><span class="single">'e'</span><span class="operator">,</span> <span class="symbol">@data</span><span class="structure">);</span>
</ol>

<p>

The first argument to the <tt>merge</tt> method
specifies which spectrum is merged: <tt>e</tt>
means to merge &mu;(E), <tt>n</tt> means to merge
normalized &mu;(E), and <tt>k</tt> means to merge
&chi;(k).
</p>

<p>
Care is taken not to double count the caller.  This is a convenience
because, as shown above, you can pass an entire array which also
contains the caller.
</p>

<p>
The <tt>merge</tt> method returns a new Data
object. 
</p>

<p>
Both of the plot types below (<tt>stddev</tt> and
<tt>varience</tt>) plot ignore many setting of the
Plot object in order to plot the data in the form in which it was
merged.  Attempting to plot the standard deviation or variance plots
with a Data object that does not contain merged data will return as
error.
</p>


<dl>
  
<dt>
  plot merged data with standard deviation
</dt>
<dd>
<pre class=olscript>
<ol class=perlblock>
<li><span class="comment">#!/usr/bin/perl
<li></span><span class="keyword">use</span> <span class="word">Demeter</span><span class="structure">;</span>
<li><span class="keyword">my</span> <span class="symbol">@common</span> <span class="operator">=</span> <span class="structure">(</span><span class="word">energy</span> <span class="operator">=&gt;</span> <span class="single">'$1'</span><span class="operator">,</span> <span class="word">numerator</span> <span class="operator">=&gt;</span> <span class="single">'$2'</span><span class="operator">,</span> <span class="word">denominator</span> <span class="operator">=&gt;</span> <span class="single">'$3'</span><span class="operator">,</span> <span class="word">ln</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">$prj</span> <span class="operator">=</span> <span class="word">Demeter::Data::Prj</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">file</span><span class="operator">=&gt;</span><span class="single">'U_DNA.prj'</span><span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">@data</span> <span class="operator">=</span> <span class="structure">(</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Demeter::Data</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">file</span> <span class="operator">=&gt;</span> <span class="single">'examples/data/fe.060'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span> <span class="operator">=&gt;</span> <span class="double">&quot;Fe scan 1&quot;</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">@common</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Demeter::Data</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">file</span> <span class="operator">=&gt;</span> <span class="single">'examples/data/fe.061'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span> <span class="operator">=&gt;</span> <span class="double">&quot;Fe scan 2&quot;</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">@common</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Demeter::Data</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">file</span> <span class="operator">=&gt;</span> <span class="single">'examples/data/fe.062'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span> <span class="operator">=&gt;</span> <span class="double">&quot;Fe scan 3&quot;</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">@common</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">$merged</span> <span class="operator">=</span> <span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span> <span class="operator">-&gt;</span> <span class="word">merge</span><span class="structure">(</span><span class="single">'e'</span><span class="operator">,</span> <span class="symbol">@data</span><span class="structure">);</span>
<li><span class="symbol">$merged</span> <span class="operator">-&gt;</span> <span class="word">plot</span><span class="structure">(</span><span class="single">'stddev'</span><span class="structure">);</span>
</ol>
</pre>
<table>
<tr>
<td>
<p>

This shows the merge of &mu;(E) of 3 iron foil scans along with the
standard deviation array.  The standard deviation has been added to
and subtracted from the &mu;(E) spectrum, so the red trace is an
error margin for the &mu;(E) spectrum.  Note that this plot type can
only be plotted using a Data object which contains the data from a
merge.  Trying to plot a non-merged Data object in this way will
return a warning without plotting anything.
<p class=todo>
<img class=tinyfloatleft border=0 src="../../images/todo.png" alt="To do!">
I really need to show noisier data in this example.
</p>
</p>

</td>
<td width=640>
<a href="../../images/plot_stddev.png" target=_blank><img border=0 src="../../images/plot_stddev.png" alt="plot_stddev.png" width=100%></a>
</td>
</tr>
</table>
  <br />
  <br />
</dd>
<dt>
  plot merged data with standard deviation
</dt>
<dd>
Change line 20 in the script shown above to this:
<ol class=perlsample>
<br />
&nbsp;&nbsp;<span class="symbol">$merged</span> <span class="operator">-&gt;</span> <span class="word">plot</span><span class="structure">(</span><span class="single">'variance'</span><span class="structure">);</span>
</ol>
<table>
<tr>
<td>
<p>

This shows the merge of &mu;(E) of 3 iron foil scans along with the
standard deviation array.  The standard deviation has been scaled to
plot with the &mu;(E) spectrum, with the scaling factor is given in
the legend.  This, then, is a way of visualizing how the standard
deviation is distributed across the spectrum.  Note that this plot
type can only be plotted using a Data object which contains the data
from a merge.  Trying to plot a non-merged Data object in this way
will return a warning without plotting anything.
</p>

</td>
<td width=640>
<a href="../../images/plot_variance.png" target=_blank><img border=0 src="../../images/plot_variance.png" alt="plot_variance.png" width=100%></a>
</td>
</tr>
</table>
  <br />
  <br />
</dd>
</dl>

</div>

<br />
<hr class=hide />
<hr class=bottomdivider />

<div class=bottombar>
  <div class=copyright>
  <table>
    <tr>
      <td colspan=2>
        <span class=program>DEMETER</span> is copyright &copy; 2009-2014 Bruce Ravel
        &mdash;
        This document is copyright &copy; 2014 Bruce Ravel
        <br />
      </td>
    </tr>
    <tr valign=middle>
      <td> 
           <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../images/somerights20.png" width="88" height="31" alt="" border="0" /></a> &nbsp;&nbsp;&nbsp;
      </td>
      <td>
  	This document is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">
  	The Creative Commons Attribution-ShareAlike License</a>.
  	<br />
  	If <span class=program>DEMETER</span> and this document are useful to you, please consider
  	<a href="http://creativecommons.org/support/">supporting The Creative Commons</a>.
      </td>
    </tr>
  </table>
</div>
</div>
  </body>
</html>