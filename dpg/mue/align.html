<!DOCTYPE HTMP PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Aligning data</title>
    <link rel="stylesheet" href=../dpg.css />
    <link rel="stylesheet" href=../ppi.css />
    <meta http-equiv="Content-Type" content="text/html"; charset=iso-8859-15 />
    <meta name="robots" contents="all" />
  </head>

  <body>
    <div class=topbar>
  <div class=navbar>
  <a class=navhead href="../index.html">The Demeter Programmer' Guide</a>
  <table class=navtable>
    <tr>
      <td align=left>
        &laquo;<a class=navtable href="http://bruceravel.github.com/demeter/"><span class=programlink>DEMETER</span></a>&raquo; &nbsp;
        &laquo;<a class=navtable href="http://cars9.uchicago.edu/iffwiki/Ifeffit"><span class=programlink>IFEFFIT</span></a>&raquo; &nbsp;
        <!-- [&nbsp;<a class=navtable href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp; -->
        &laquo;<a class=navtable href="http://xafs.org">xafs.org</a>&raquo; &nbsp;
	<!-- [&nbsp;<a class=navtable href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;] -->
      </td>
      <td align=right>
        &nbsp;&nbsp;
        Up: <a class=navtable href="../mue/index.html" class="menu">Processing mu(E) data</a> &nbsp;&nbsp;
        Next: <a class=navtable href="../mue/merge.html" class="menu">Merging data</a>      </td>
    </tr>
  </table>
  </div>
</div>

<div class=sidebar>
  <a href="../ceres.html"><img src=../../images/Isis-Sothis-Demeter_sm.jpg
    width=90% border=0 alt='[Demeter logo]'></a>
  <br />
  <a href="../index.html"  class="menu">Home</a><br />
<a href="../intro.html"  class="menu">Introduction</a><br />
<a href="../data/index.html"  class="menu">Importing data</a><br />
<a href="../mue/index.html"  class="menuselect">Processing mu(E) data</a><br />
&nbsp;&#8618;&nbsp;<span style="font-style: italic;">Aligning data</span><br />
&nbsp;&#8618;&nbsp;<a href="../mue/merge.html"  class="menu">Merging data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/deglitch.html"  class="menu">Deglitching data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/truncate.html"  class="menu">Truncating data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/noise.html"  class="menu">Adding artificial noise to data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/smooth.html"  class="menu">Smoothing data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/convolve.html"  class="menu">Convolving data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/deconvolve.html"  class="menu">Deconvolving data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/rebin.html"  class="menu">Rebinning data</a><br />
&nbsp;&#8618;&nbsp;<a href="../mue/dispersive.html"  class="menu">Processing dispersive XAS data</a><br /><a href="../xanes/index.html"  class="menu">Analysis of XANES data</a><br />
<a href="../highlevel/index.html"  class="menu">High level actions for Demeter objects</a><br />
<a href="../atoms/index.html"  class="menu">Atoms</a><br />
<a href="../feff/index.html"  class="menu">Feff</a><br />
<a href="../paths/index.html"  class="menu">Scattering paths</a><br />
<a href="../gds/index.html"  class="menu">Guess/Def/Set parameters</a><br />
<a href="../fit/index.html"  class="menu">Fitting EXAFS data</a><br />
<a href="../perl/index.html"  class="menu">Using perl to create a fitting model</a><br />
<a href="../lgcv.html"  class="menu">Local guess parameters and the characteristic value</a><br />
<a href="../pathlike/index.html"  class="menu">Path-like objects</a><br />
<a href="../su.html"  class="menu">Structural Units</a><br />
<a href="../ui.html"  class="menu">User interfaces</a><br />
<a href="../output.html"  class="menu">Output formats</a><br />
<a href="../examples/index.html"  class="menu">Full examples</a><br />
</div>

<div class=contentarea>


<h1>
  Aligning data
</h1>

<p>

<span class=program>DEMETER</span> uses a rather simple alignment algorithm.  First, one
Data object is chosen as the alignment standard.  The standard is one
that doesn't move -- other data are aligned to the standard by
applying an E&#8320; shift.  The derivative spectrum is computed for
both the standard and the data.  An E&#8320; shift and an overall
amplitude are the variable parameters used to fit the data to the
standard.  The amplitude value is discard, but the fitted E&#8320;
shift is set as the <tt>bkg_eshift</tt> attribute
of the aligned data.
</p>

<p>
This algorithm work quite well for good quality data.  Although, even
for very good data, if it starts of many volts out of alignment, the
fit is likely to find a false minimum.  If data start very far out of
alignment, you will likely need to set the 
<tt>bkg_eshift</tt> attribute by hadn to something
close before calling the <tt>align</tt> method.
</p>

<p>
Here is a simple example:
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="comment">#!/usr/bin/perl
<li></span>
<li><span class="keyword">my</span> <span class="symbol">$prj</span> <span class="operator">=</span> <span class="word">Demeter::Data::Prj</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">file</span><span class="operator">=&gt;</span><span class="single">'U_DNA.prj'</span><span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">@data</span> <span class="operator">=</span> <span class="symbol">$prj</span> <span class="operator">-&gt;</span> <span class="word">records</span><span class="structure">(</span><span class="number">1</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span> <span class="number">3</span><span class="operator">,</span> <span class="number">4</span><span class="structure">);</span>
<li>
<li><span class="comment">## ... set background removal and Fourier transform attributes for
<li>##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;each data set ...
<li></span>
<li><span class="comment">## align to the standard
<li></span><span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">align</span><span class="structure">(</span><span class="symbol">@data</span><span class="structure">);</span>
<li><span class="comment">## make all the E0 values the same
<li></span><span class="magic">$_</span><span class="operator">-&gt;</span><span class="word">e0</span><span class="structure">(</span><span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">])</span> <span class="word">foreach</span> <span class="symbol">@data</span><span class="structure">[</span><span class="number">1</span><span class="operator">..</span><span class="number">3</span><span class="structure">];</span>
</ol>
</pre>

<p>

Four data sets are imported at lines 3 and 4.  By calling the 
<tt>align</tt> method on the first data set in the
list at line 10, it is chosen as  the standard, i.e. the one that
stays in place while the others are shifted.  It is not a problem that
the standard is passed as an argument of the method.  <span class=program>DEMETER</span>
will notice this and do the right thing.
</p>

<p>
Aligning does not also force the E&#8320; values to be the same, so
that is done as a separate step at line 12.
</p>

<p>
There is also an <tt>align_with_reference</tt>
method (which has an alias of <tt>alignwr</tt>).
This will use the Data objects specified in the 
<tt>reference</tt> attribute of the standard and
the data to perform the alignment.  Here is how that works:
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="comment">#!/usr/bin/perl
<li></span>
<li><span class="keyword">my</span> <span class="symbol">$prj</span> <span class="operator">=</span> <span class="word">Demeter::Data::Prj</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">file</span><span class="operator">=&gt;</span><span class="single">'U_DNA.prj'</span><span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">@data</span> <span class="operator">=</span> <span class="symbol">$prj</span> <span class="operator">-&gt;</span> <span class="word">records</span><span class="structure">(</span><span class="number">1</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span> <span class="number">3</span><span class="operator">,</span> <span class="number">4</span><span class="structure">);</span>
<li>
<li><span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">reference</span><span class="structure">(</span><span class="symbol">$data</span><span class="structure">[</span><span class="number">1</span><span class="structure">]);</span>
<li><span class="symbol">$data</span><span class="structure">[</span><span class="number">2</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">reference</span><span class="structure">(</span><span class="symbol">$data</span><span class="structure">[</span><span class="number">3</span><span class="structure">]);</span>
<li>
<li><span class="comment">## align to the standard using the reference
<li></span><span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">alignwr</span><span class="structure">(</span><span class="symbol">$data</span><span class="structure">[</span><span class="number">2</span><span class="structure">]);</span>
<li><span class="comment">## make the E0 values the same
<li></span><span class="symbol">$data</span><span class="structure">[</span><span class="number">2</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">e0</span><span class="structure">(</span><span class="symbol">$data</span><span class="structure">[</span><span class="number">0</span><span class="structure">]);</span>
</ol>
</pre>

<p class=todo>
<img class=tinyfloatleft border=0 src="../../images/todo.png" alt="To do!">
Smoothing the derivative spectra before aligning is not yet implemented.
</p>

</div>

<br />
<hr class=hide />
<hr class=bottomdivider />

<div class=bottombar>
  <div class=copyright>
  <table>
    <tr>
      <td colspan=2>
        <span class=program>DEMETER</span> is copyright &copy; 2009-2012 Bruce Ravel
        &mdash;
        This document is copyright &copy; 2012 Bruce Ravel
        <br />
      </td>
    </tr>
    <tr valign=middle>
      <td> 
           <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../images/somerights20.png" width="88" height="31" alt="" border="0" /></a> &nbsp;&nbsp;&nbsp;
      </td>
      <td>
  	This document is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">
  	The Creative Commons Attribution-ShareAlike License</a>.
  	<br />
  	If <span class=program>DEMETER</span> and this document are useful to you, please consider
  	<a href="http://creativecommons.org/support/">supporting The Creative Commons</a>.
      </td>
    </tr>
  </table>
</div>
</div>
  </body>
</html>