<!DOCTYPE HTMP PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Silver/gold alloy</title>
    <link rel="stylesheet" href=../dpg.css />
    <link rel="stylesheet" href=../ppi.css />
    <meta http-equiv="Content-Type" content="text/html"; charset=iso-8859-15 />
    <meta name="robots" contents="all" />
  </head>

  <body>
    <div class=topbar>
  <div class=navbar>
  <a class=navhead href="../index.html">The Demeter Programmer' Guide</a>
  <table class=navtable>
    <tr>
      <td align=left>
        &laquo;<a class=navtable href="http://bruceravel.github.io/demeter/"><span class=programlink>DEMETER</span></a>&raquo; &nbsp;
        &laquo;<a class=navtable href="https://github.com/newville/ifeffit"><span class=programlink>IFEFFIT</span></a>&raquo; &nbsp;
        <!-- [&nbsp;<a class=navtable href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp; -->
        &laquo;<a class=navtable href="http://xafs.org">xafs.org</a>&raquo; &nbsp;
	<!-- [&nbsp;<a class=navtable href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;] -->
      </td>
      <td align=right>
        Back: <a class=navtable href="../examples/methyltin.html" class="menu">Methyltin chloride</a> &nbsp;&nbsp;
        &nbsp;&nbsp;
        Up: <a class=navtable href="../examples/index.html" class="menu">Full examples</a> &nbsp;&nbsp;
        Next: <a class=navtable href="../examples/uranyl.html" class="menu">Uranyl complex in solution</a>      </td>
    </tr>
  </table>
  </div>
</div>

<div class=sidebar>
  <a href="../ceres.html"><img src=../../images/Isis-Sothis-Demeter_sm.jpg
    width=90% border=0 alt='[Demeter logo]'></a>
  <br />
  <a href="../index.html"  class="menu">Home</a><br />
<a href="../intro.html"  class="menu">Introduction</a><br />
<a href="../data/index.html"  class="menu">Importing data</a><br />
<a href="../mue/index.html"  class="menu">Processing mu(E) data</a><br />
<a href="../xanes/index.html"  class="menu">Analysis of XANES data</a><br />
<a href="../highlevel/index.html"  class="menu">High level actions for Demeter objects</a><br />
<a href="../atoms/index.html"  class="menu">Atoms</a><br />
<a href="../feff/index.html"  class="menu">Feff</a><br />
<a href="../paths/index.html"  class="menu">Scattering paths</a><br />
<a href="../gds/index.html"  class="menu">Guess/Def/Set parameters</a><br />
<a href="../fit/index.html"  class="menu">Fitting EXAFS data</a><br />
<a href="../perl/index.html"  class="menu">Using perl to create a fitting model</a><br />
<a href="../lgcv.html"  class="menu">Local guess parameters and the characteristic value</a><br />
<a href="../pathlike/index.html"  class="menu">Path-like objects</a><br />
<a href="../su.html"  class="menu">Structural Units</a><br />
<a href="../ui.html"  class="menu">User interfaces</a><br />
<a href="../output.html"  class="menu">Output formats</a><br />
<a href="../examples/index.html"  class="menuselect">Full examples</a><br />
&nbsp;&#8618;&nbsp;<a href="../examples/methyltin.html"  class="menu">Methyltin chloride</a><br />
&nbsp;&#8618;&nbsp;<span style="font-style: italic;">Silver/gold alloy</span><br />
&nbsp;&#8618;&nbsp;<a href="../examples/uranyl.html"  class="menu">Uranyl complex in solution</a><br />
&nbsp;&#8618;&nbsp;<a href="../examples/histo.html"  class="menu">Histogram</a><br />
</div>

<div class=contentarea>


<h1>
  Silver/gold alloy
</h1>
<h2>
  Multiple data set fitting using the characteristic value 
</h2>

<p>

In this example, a series of silver/gold alloys are co-refined using a
simple model in which the first shell is a mixture of silver and gold
backscatterers in the same proportion as the bulk.  This example lends
itself quite naturally to using the
<a href="../lgcv.html">characteristic value</a>
of the Data object.  It also demonstrates a direct manipulation of a
Feff object without editing a <span class=file>feff.inp</span> file.
</p>


<pre class=olscript>
<ol class=perlblock>
<li><span class="comment">#!/usr/bin/perl
<li></span><span class="keyword">use</span> <span class="word">Demeter</span> <span class="words">qw(:ui=screen :plotwith=gnuplot)</span><span class="structure">;</span>
<li><span class="word">print</span> <span class="double">&quot;Multiple data set fit to several AgAu samples using Demeter $Demeter::VERSION\n&quot;</span><span class="structure">;</span>
<li>
<li><span class="comment">### -------- import five sets of Ag and Ag/Au data from an Athena project file
<li></span><span class="keyword">my</span> <span class="symbol">$prj</span> <span class="operator">=</span> <span class="word">Demeter::Data::Prj</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><span class="word">file</span> <span class="operator">=&gt;</span> <span class="single">'AgAu_merged.prj'</span><span class="structure">);</span>
<li><span class="symbol">$prj</span> <span class="operator">-&gt;</span> <span class="word">set_mode</span><span class="structure">(</span><span class="word">screen</span><span class="operator">=&gt;</span><span class="number">0</span><span class="operator">,</span> <span class="word">backend</span><span class="operator">=&gt;</span><span class="number">1</span><span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">@common</span> <span class="operator">=</span> <span class="structure">(</span><span class="word">fft_kmin</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">2</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;<span class="word">fft_kmax</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">11</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">bft_rmax</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="float">3.2</span><span class="operator">,</span> <span class="word">bft_rmin</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="float">1.8</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">fit_k1</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;<span class="word">fit_k2</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">fit_k3</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">$data_100</span> <span class="operator">=</span> <span class="symbol">$prj</span><span class="operator">-&gt;</span><span class="word">record</span><span class="structure">(</span><span class="number">1</span><span class="structure">);</span>
<li><span class="symbol">$data_100</span> <span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="symbol">@common</span><span class="operator">,</span> <span class="word">cv</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;<span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'pure silver'</span><span class="structure">);</span>
<li>
<li><span class="keyword">my</span> <span class="symbol">$data_80</span> <span class="operator">=</span> <span class="symbol">$prj</span><span class="operator">-&gt;</span><span class="word">record</span><span class="structure">(</span><span class="number">3</span><span class="structure">);</span>
<li><span class="symbol">$data_80</span>&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="symbol">@common</span><span class="operator">,</span> <span class="word">cv</span> <span class="operator">=&gt;</span> <span class="float">0.8</span><span class="operator">,</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'80% silver'</span><span class="structure">);</span>
<li>
<li><span class="keyword">my</span> <span class="symbol">$data_60</span> <span class="operator">=</span> <span class="symbol">$prj</span><span class="operator">-&gt;</span><span class="word">record</span><span class="structure">(</span><span class="number">5</span><span class="structure">);</span>
<li><span class="symbol">$data_60</span>&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="symbol">@common</span><span class="operator">,</span> <span class="word">cv</span> <span class="operator">=&gt;</span> <span class="float">0.6</span><span class="operator">,</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'60% silver'</span><span class="structure">);</span>
<li>
<li><span class="keyword">my</span> <span class="symbol">$data_50</span> <span class="operator">=</span> <span class="symbol">$prj</span><span class="operator">-&gt;</span><span class="word">record</span><span class="structure">(</span><span class="number">6</span><span class="structure">);</span>
<li><span class="symbol">$data_50</span>&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="symbol">@common</span><span class="operator">,</span> <span class="word">cv</span> <span class="operator">=&gt;</span> <span class="float">0.5</span><span class="operator">,</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'50% silver'</span><span class="structure">);</span>
<li>
<li><span class="keyword">my</span> <span class="symbol">$data_40</span> <span class="operator">=</span> <span class="symbol">$prj</span><span class="operator">-&gt;</span><span class="word">record</span><span class="structure">(</span><span class="number">7</span><span class="structure">);</span>
<li><span class="symbol">$data_40</span>&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="symbol">@common</span><span class="operator">,</span> <span class="word">cv</span> <span class="operator">=&gt;</span> <span class="float">0.4</span><span class="operator">,</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="single">'40% silver'</span><span class="structure">);</span>
<li>
<li><span class="comment">## -------- make GDS objects for an isotropic expansion, correlated
<li>##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debye, mixed first shell fit to silver and silver/gold
<li></span><span class="keyword">my</span> <span class="symbol">@gdsobjects</span> <span class="operator">=</span>&nbsp;&nbsp;<span class="structure">(</span><span class="symbol">$data_100</span> <span class="operator">-&gt;</span> <span class="word">simpleGDS</span><span class="structure">(</span><span class="double">&quot;guess amp&nbsp;&nbsp;&nbsp;= 1&quot;</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$data_100</span> <span class="operator">-&gt;</span> <span class="word">simpleGDS</span><span class="structure">(</span><span class="double">&quot;guess enot&nbsp;&nbsp;= 0&quot;</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$data_100</span> <span class="operator">-&gt;</span> <span class="word">simpleGDS</span><span class="structure">(</span><span class="double">&quot;guess dr_ag = 0&quot;</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$data_100</span> <span class="operator">-&gt;</span> <span class="word">simpleGDS</span><span class="structure">(</span><span class="double">&quot;guess ss_ag = 0.003&quot;</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$data_100</span> <span class="operator">-&gt;</span> <span class="word">simpleGDS</span><span class="structure">(</span><span class="double">&quot;guess dr_au = 0&quot;</span><span class="structure">)</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$data_100</span> <span class="operator">-&gt;</span> <span class="word">simpleGDS</span><span class="structure">(</span><span class="double">&quot;guess ss_au = 0.003&quot;</span><span class="structure">)</span><span class="operator">,</span>
<li><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Determine Ag::Au ratios with an lguess
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## $data_100 -&gt; simpleGDS(&quot;lguess frac = 0.6&quot;),
<li></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li>
<li><span class="comment">## -------- import Ag crystal data and generate a feff.inp file
<li></span><span class="keyword">my</span> <span class="symbol">$atoms</span> <span class="operator">=</span> <span class="word">Demeter::Atoms</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><span class="word">file</span> <span class="operator">=&gt;</span> <span class="double">&quot;Ag.inp&quot;</span><span class="structure">);</span>
<li><span class="word">open</span><span class="structure">(</span><span class="keyword">my</span> <span class="symbol">$FEFF</span><span class="operator">,</span> <span class="single">'&gt;feff.inp'</span><span class="structure">);</span>
<li><span class="word">print</span> <span class="symbol">$FEFF</span> <span class="symbol">$atoms</span><span class="operator">-&gt;</span><span class="word">Write</span><span class="structure">(</span><span class="double">&quot;feff6&quot;</span><span class="structure">);</span>
<li><span class="word">close</span> <span class="symbol">$FEFF</span><span class="structure">;</span>
<li>
<li><span class="comment">## -------- run Feff on pure silver
<li></span><span class="keyword">my</span> <span class="symbol">$agfeff</span> <span class="operator">=</span> <span class="word">Demeter::Feff</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">(</span><span class="word">file</span> <span class="operator">=&gt;</span> <span class="double">&quot;feff.inp&quot;</span><span class="structure">);</span>
<li><span class="symbol">$agfeff</span> <span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="word">workspace</span><span class="operator">=&gt;</span><span class="double">&quot;feff/&quot;</span><span class="operator">,</span> <span class="word">screen</span><span class="operator">=&gt;</span><span class="number">0</span><span class="operator">,</span><span class="structure">);</span>
<li><span class="symbol">$agfeff</span> <span class="operator">-&gt;</span> <span class="word">make_workspace</span><span class="structure">;</span>
<li><span class="symbol">$agfeff</span> <span class="operator">-&gt;</span> <span class="word">run</span><span class="structure">;</span>
<li>
<li><span class="comment">## -------- make a path object from the 1st shell of pure silver, use
<li>##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this for the pure silver data
<li></span><span class="keyword">my</span> <span class="symbol">@paths</span> <span class="operator">=</span> <span class="structure">();</span>
<li><span class="symbol">$paths</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span> <span class="operator">=</span> <span class="word">Demeter::Path</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">();</span>
<li><span class="symbol">$paths</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">set</span><span class="structure">(</span><span class="word">data</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$data_100</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">parent</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$agfeff</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">sp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$agfeff</span><span class="operator">-&gt;</span><span class="word">pathlist</span><span class="operator">-&gt;</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'silver'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">12</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">s02</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'amp'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">e0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'enot'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">delr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'dr_ag'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">sigma2</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'ss_ag'</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li>
<li><span class="comment">## -------- clone the Ag Feff calculation, add Au to the potentials
<li>##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list, make an Au scatterer out of the first site after the
<li>##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;absorber
<li></span><span class="keyword">my</span> <span class="symbol">$aufeff</span> <span class="operator">=</span> <span class="symbol">$agfeff</span><span class="operator">-&gt;</span><span class="word">Clone</span><span class="structure">;</span>
<li><span class="symbol">$aufeff</span> <span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="word">workspace</span><span class="operator">=&gt;</span><span class="double">&quot;feffau/&quot;</span><span class="operator">,</span> <span class="word">screen</span><span class="operator">=&gt;</span><span class="number">0</span><span class="operator">,</span><span class="structure">);</span>
<li><span class="symbol">$aufeff</span> <span class="operator">-&gt;</span> <span class="word">make_workspace</span><span class="structure">;</span>
<li><span class="symbol">$aufeff</span> <span class="operator">-&gt;</span> <span class="word">push_potentials</span><span class="structure">([</span><span class="number">2</span><span class="operator">,</span> <span class="number">79</span><span class="operator">,</span> <span class="single">'Au'</span><span class="structure">]);</span> <span class="comment">## add Au to the end of the potentials list</span>
<li><span class="keyword">my</span> <span class="symbol">@sites</span> <span class="operator">=</span> <span class="cast">@</span><span class="structure">{</span> <span class="symbol">$aufeff</span><span class="operator">-&gt;</span><span class="word">sites</span> <span class="structure">};</span> <span class="comment">## make the first atom after the</span>
<li><span class="keyword">my</span> <span class="symbol">@neighbor</span>&nbsp;&nbsp;&nbsp;<span class="operator">=</span> <span class="cast">@</span><span class="structure">{</span> <span class="symbol">$sites</span><span class="structure">[</span><span class="number">1</span><span class="structure">]</span> <span class="structure">};</span> <span class="comment">## absorber in the sites list an Au</span>
<li><span class="symbol">@neighbor</span><span class="structure">[</span><span class="number">3</span><span class="operator">,</span><span class="number">4</span><span class="structure">]</span> <span class="operator">=</span> <span class="structure">(</span><span class="number">2</span><span class="operator">,</span><span class="single">'Au'</span><span class="structure">);</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">## (this could be easier...)</span>
<li><span class="symbol">$sites</span><span class="structure">[</span><span class="number">1</span><span class="structure">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=</span> <span class="cast">\</span><span class="symbol">@neighbor</span><span class="structure">;</span>
<li><span class="symbol">$aufeff</span> <span class="operator">-&gt;</span> <span class="word">sites</span><span class="structure">(</span><span class="cast">\</span><span class="symbol">@sites</span><span class="structure">);</span>
<li><span class="symbol">$aufeff</span> <span class="operator">-&gt;</span> <span class="word">run</span><span class="structure">;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">## and continue</span>
<li>
<li><span class="comment">## -------- clone the Path object several times, taking care to
<li>##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;correctly map paths to data sets
<li></span><span class="keyword">my</span> <span class="symbol">%map</span> <span class="operator">=</span> <span class="structure">(</span><span class="number">2</span><span class="operator">=&gt;</span><span class="symbol">$data_80</span><span class="operator">,</span> <span class="number">4</span><span class="operator">=&gt;</span><span class="symbol">$data_60</span><span class="operator">,</span> <span class="number">6</span><span class="operator">=&gt;</span><span class="symbol">$data_50</span><span class="operator">,</span> <span class="number">8</span><span class="operator">=&gt;</span><span class="symbol">$data_40</span><span class="structure">);</span>
<li><span class="keyword">my</span> <span class="symbol">%percentage</span> <span class="operator">=</span> <span class="structure">(</span><span class="number">2</span><span class="operator">=&gt;</span><span class="single">'80'</span><span class="operator">,</span> <span class="number">4</span><span class="operator">=&gt;</span><span class="single">'60'</span><span class="operator">,</span> <span class="number">6</span><span class="operator">=&gt;</span><span class="single">'50'</span><span class="operator">,</span> <span class="number">8</span><span class="operator">=&gt;</span><span class="single">'40'</span><span class="structure">);</span>
<li><span class="keyword">foreach</span> <span class="keyword">my</span> <span class="symbol">$i</span> <span class="structure">(</span><span class="number">2</span><span class="operator">,</span><span class="number">4</span><span class="operator">,</span><span class="number">6</span><span class="operator">,</span><span class="number">8</span><span class="structure">)</span> <span class="structure">{</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># clone silver paths</span>
<li>&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$j</span> <span class="operator">=</span> <span class="symbol">$i</span><span class="operator">-</span><span class="number">1</span><span class="structure">;</span>
<li>&nbsp;&nbsp;<span class="symbol">$paths</span><span class="structure">[</span><span class="symbol">$j</span><span class="structure">]</span> <span class="operator">=</span> <span class="symbol">$paths</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">Clone</span><span class="structure">(</span><span class="word">data</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$map</span><span class="structure">{</span><span class="symbol">$i</span><span class="structure">}</span><span class="operator">,</span>
<li><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#s02&nbsp;&nbsp;=&gt; &quot;amp*frac&quot;,&nbsp;&nbsp;&nbsp;# lguess
<li></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">s02</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="double">&quot;amp*[cv]&quot;</span><span class="operator">,</span>&nbsp;&nbsp;&nbsp;<span class="comment"># char. value</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li><span class="structure">};</span>
<li><span class="keyword">foreach</span> <span class="keyword">my</span> <span class="symbol">$i</span> <span class="structure">(</span><span class="number">2</span><span class="operator">,</span><span class="number">4</span><span class="operator">,</span><span class="number">6</span><span class="operator">,</span><span class="number">8</span><span class="structure">)</span> <span class="structure">{</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># clone gold paths</span>
<li>&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$j</span> <span class="operator">=</span> <span class="symbol">$i</span><span class="operator">-</span><span class="number">1</span><span class="structure">;</span>
<li>&nbsp;&nbsp;<span class="symbol">$paths</span><span class="structure">[</span><span class="symbol">$i</span><span class="structure">]</span> <span class="operator">=</span> <span class="symbol">$paths</span><span class="structure">[</span><span class="symbol">$j</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">Clone</span><span class="structure">(</span><span class="word">parent</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$aufeff</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">sp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="symbol">$aufeff</span><span class="operator">-&gt;</span><span class="word">find_path</span><span class="structure">(</span><span class="word">tag</span><span class="operator">=&gt;</span><span class="structure">[</span><span class="single">'Au'</span><span class="structure">])</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="double">&quot;gold&quot;</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="number">12</span><span class="operator">,</span>
<li><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#s02&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &quot;amp*(1-frac)&quot;, # lguess
<li></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">s02</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="double">&quot;amp*(1-[cv])&quot;</span><span class="operator">,</span> <span class="comment"># char. value</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">delr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="double">&quot;dr_au&quot;</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">sigma2</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="double">&quot;ss_au&quot;</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li><span class="structure">};</span>
<li>
<li>
<li><span class="comment">## -------- make a Fit object, which is just a collection of GDS, Data, and Path objects
<li></span><span class="keyword">my</span> <span class="symbol">$fitobject</span> <span class="operator">=</span> <span class="word">Demeter::Fit</span> <span class="operator">-&gt;</span> <span class="word">new</span><span class="structure">;</span>
<li><span class="symbol">$fitobject</span><span class="operator">-&gt;</span><span class="word">set</span><span class="structure">(</span><span class="word">gds</span>&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="cast">\</span><span class="symbol">@gdsobjects</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">data</span>&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="structure">[</span><span class="symbol">$data_100</span><span class="operator">,</span> <span class="symbol">$data_80</span><span class="operator">,</span> <span class="symbol">$data_60</span><span class="operator">,</span> <span class="symbol">$data_50</span><span class="operator">,</span> <span class="symbol">$data_40</span><span class="structure">]</span><span class="operator">,</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">paths</span> <span class="operator">=&gt;</span> <span class="cast">\</span><span class="symbol">@paths</span>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span>
<li>
<li><span class="comment">## -------- do the fit
<li></span><span class="symbol">$fitobject</span> <span class="operator">-&gt;</span> <span class="word">fit</span><span class="structure">;</span>
<li><span class="symbol">$fitobject</span> <span class="operator">-&gt;</span> <span class="word">interview</span><span class="structure">;</span>
</ol>
</pre>

<p>

An <span class=program>ATHENA</span> project file is imported at line 6.  At lines 11
through 24, five of the data sets from the project file are imported
into Data objects.  Each one has its <tt>name</tt>
<tt>cv</tt> attributes set appropriately.  The
<tt>cv</tt> is set to the bulk fradction of silver
in the sample.
</p>

<p>
A set of guess parameters is defined at lines 28-33 for a simple
fitting model that includes overall amplitude and E&#8320; parameters
along with &Delta;R and &sigma;&sup2; parameters for each type of
scatterer. 
</p>

<p>
At line 39-42 an <span class=file>atoms.inp</span> is imported and
a temporary <span class=file>feff.inp</span> is written.  This 
<span class=file>feff.inp</span> is imported, forming a Feff
object at line 45.  Note that the <tt>run</tt>
method at line 48 is a wrapper around the
<tt>potph</tt> and 
<tt>pathfinder</tt> methods.  The first path from
this calculation, the one corresponding to the 12 silver atoms in the
first coordination shell, is made into a Path object at lines 53-63.
Note the idiomatic dereferencing of the first ScatteringPath object
from the <span class=program>FEFF</span> calculation at line 56.  Note that this Path
object points at the Data object for the pure silver data.
</p>

<p>
The <span class=program>FEFF</span> calculation for the contribution from the Au scatterer
is obtained at lines 68-77.  Here's how it works.  First, the Feff
object from the pure silver calculation is cloned at line 68 and a
separate workspace is established at lines 69 and 70.  At line 71, a
new potential type is pushed onto the list of potentials of the cloned
Feff object.  At lines 72-76, an atom from the first coordination
shell is switched from silver to gold.  This modified sites list is
then pushed back into the object.
</p>

<p>
The manipulations at lines 68-77 represent both a weakness and a great
strength of <span class=program>DEMETER</span>'s interactions with <span class=program>FEFF</span>.  On one
hand, <span class=program>DEMETER</span> currently lacks more graceful tools for making
these manipulations.  On the other hand, this example demonstrates the
extent to which a <span class=program>FEFF</span> calculation can be controlled
algorithmically.  Thus complex modeling chores can be programed
directly rather than prepared on disk beforehand.
</p>

<p>
At lines 81-101, paths are set up for the four alloy samples.  First,
at 83-89, the silver path is cloned and assigned to each alloy Data
object.  Note that the 
<a href="../lgcv.html">characteristic value</a>
is used to get the amplitude term set correctly for each alloy Data
object.  In this case, the <tt>cv</tt> is set to
the amount of silver in each sample.  When the 
<tt>[cv]</tt> token is resolved, each silver path
will have its amplitude set properly.
</p>

<p>
At lines 90-101, more paths are cloned, then modified to use the
ScatteringPath object which corresponds to the gold scatterer from the
second <span class=program>FEFF</span> calculation.  Again, care is taken to make sure that
the correct Path object, with the correct <tt>cv</tt>
value, is associated with the correct Data object.  Note the use of
the <tt>find_path</tt> method at line 93.  This
identifies the ScatteringPath object using a
<a href="../paths/semantic.html">semantic path description</a>.
This simplifies the chore of finding the correct ScatteringPath
without needing to keep track of the order of scattering paths in the
<span class=program>FEFF</span> calculation.
</p>

<p>
Finally, the Fit object is created and the fit is run.  Finally, the
<tt>interview</tt> method is called so the fit can
be examined interactively from a command line script.
</p>


<table>
<tr>
<td>
<p>

The lines below replaced the <tt>interview</tt> method 
to produce this plot of the result of the fit.
<ol class=perlsample>
<br />
&nbsp;&nbsp;<span class="symbol">$fitobject</span> <span class="operator">-&gt;</span> <span class="word">po</span> <span class="operator">-&gt;</span> <span class="word">set</span><span class="structure">(</span><span class="word">plot_fit</span> <span class="operator">=&gt;</span>&nbsp;&nbsp;<span class="number">1</span><span class="operator">,</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">r_pl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">=&gt;</span> <span class="single">'m'</span><span class="operator">,</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">kweight</span>&nbsp;&nbsp;<span class="operator">=&gt;</span>&nbsp;&nbsp;<span class="number">2</span><span class="structure">);</span><br />
&nbsp;&nbsp;<span class="symbol">$data_100</span>&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">y_offset</span><span class="structure">(</span><span class="float">2.0</span><span class="structure">);</span><br />
&nbsp;&nbsp;<span class="symbol">$data_100</span>&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">plot</span><span class="structure">(</span><span class="single">'r'</span><span class="structure">);</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="symbol">$data_80</span>&nbsp;&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">y_offset</span><span class="structure">(</span><span class="float">1.5</span><span class="structure">);</span><br />
&nbsp;&nbsp;<span class="symbol">$data_80</span>&nbsp;&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">plot</span><span class="structure">(</span><span class="single">'r'</span><span class="structure">);</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="symbol">$data_60</span>&nbsp;&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">y_offset</span><span class="structure">(</span><span class="float">1.0</span><span class="structure">);</span><br />
&nbsp;&nbsp;<span class="symbol">$data_60</span>&nbsp;&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">plot</span><span class="structure">(</span><span class="single">'r'</span><span class="structure">);</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="symbol">$data_50</span>&nbsp;&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">y_offset</span><span class="structure">(</span><span class="float">0.5</span><span class="structure">);</span><br />
&nbsp;&nbsp;<span class="symbol">$data_50</span>&nbsp;&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">plot</span><span class="structure">(</span><span class="single">'r'</span><span class="structure">);</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="symbol">$data_40</span>&nbsp;&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">y_offset</span><span class="structure">(</span><span class="float">0.0</span><span class="structure">);</span><br />
&nbsp;&nbsp;<span class="symbol">$data_40</span>&nbsp;&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">plot</span><span class="structure">(</span><span class="single">'r'</span><span class="structure">);</span><br />
&nbsp;&nbsp;<span class="symbol">$data_40</span>&nbsp;&nbsp;&nbsp;<span class="operator">-&gt;</span> <span class="word">pause</span><span class="structure">;</span>
</ol>
</p>

</td>
<td width=640>
<a href="../../images/agau_fit.png" target=_blank><img border=0 src="../../images/agau_fit.png" alt="agau_fit.png" width=100%></a>
</td>
</tr>
</table>

<p>

As a final note, the fit presented here assumes that the mixture of
silver and gold in the first coordination shell is of the same ratio
as the nominal bulk mixing ratios.  This assumption can be easily
relaxed.  By uncommenting lines 35, 86, and 96 and commenting out line
87 and 97, the fixed mixing ratios are turned into a guess parameter
for each data set using a
<a href="../lgcv.html">local guess parameter</a>.
In this way, the lguess is expanded into 5 guess parameters, one for
each data set.  Try it!
</p>

</div>

<br />
<hr class=hide />
<hr class=bottomdivider />

<div class=bottombar>
  <div class=copyright>
  <table>
    <tr>
      <td colspan=2>
        <span class=program>DEMETER</span> is copyright &copy; 2009-2014 Bruce Ravel
        &mdash;
        This document is copyright &copy; 2014 Bruce Ravel
        <br />
      </td>
    </tr>
    <tr valign=middle>
      <td> 
           <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../images/somerights20.png" width="88" height="31" alt="" border="0" /></a> &nbsp;&nbsp;&nbsp;
      </td>
      <td>
  	This document is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">
  	The Creative Commons Attribution-ShareAlike License</a>.
  	<br />
  	If <span class=program>DEMETER</span> and this document are useful to you, please consider
  	<a href="http://creativecommons.org/support/">supporting The Creative Commons</a>.
      </td>
    </tr>
  </table>
</div>
</div>
  </body>
</html>